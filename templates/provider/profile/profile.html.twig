{# profile.html.twig - updated design to match dashboard cards #}
{% extends 'provider/base.html.twig' %}

{% block title %}Profile{% endblock %}

{% block provider_body %}
<style>
/* Override container-xl to shift content left and remove left spacing */
.container-xl {
    margin-left: 0 !important;
    padding-left: 0 !important;
    max-width: 100% !important;
    transform: translateX(-80px) !important; /* Shift entire container to the left */
}

/* Override app-content padding from base template to remove left spacing */
.app-content {
    padding-left: 0 !important;
}

/* == Scoped modern card styles (unique class names) == */
.profile-card, .section-card, .profile-right-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(16,24,40,0.06);
  padding: 24px;
  display: flex;
  flex-direction: column;
}

/* Keep inner content spacing consistent */
.profile-card .app-card-body,
.section-card .app-card-body {
  padding: 0;
}

/* Header row */
.card-header-row {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

/* Title */
.card-title {
  font-size: 1.1rem;
  font-weight: 500;
  margin:0;
}

/* Small icon link */
.card-header-link svg { width:28px; height:28px; }

/* Profile avatar box */
.profile-avatar-box {
  width:92px;
  height:92px;
  border-radius:50%;
  overflow:hidden;
  border:2px solid #85BB65;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* Info row items */
.info-item {
    padding: 10px 0;
  border-bottom: none;
    margin: 0;
}
.info-item:last-child { border-bottom: none; }

/* Right column upload buttons */
.upload-list {
  width:100%;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.upload-btn-custom {
  display:flex;
  align-items:center;
  padding:10px 14px;
  border-radius:10px;
  background:#F4F9F1;
  border:1px solid #e6eef6;
  box-shadow: 0 2px 6px rgba(11,22,40,0.03);
  text-decoration:none;
  color:inherit;
}
.upload-btn-custom .cstm-btn-text {
  flex: 1;
}
.upload-btn-custom .cstm-btn-checkmark {
  margin-left: 15px;
  display: flex;
  align-items: center;
  margin-right: 20px;
}

/* Make CV upload visually emphasized */
.upload-btn-custom.upload-cv {
  border: 1px solid #e6eef6;
  background: #F4F9F1;
}

/* Make Documents link visually different - no checkbox, different styling */
.upload-btn-custom.upload-btn-documents {
  background: #E8F4FD;
  border: 2px solid #85BB65;
  font-weight: 600;
}
.upload-btn-custom.upload-btn-documents:hover {
  background: #D1E9F9;
  border-color: #6FA050;
}

/* small badge for ratings etc */
.small-metric {
  text-align:center;
}
.small-metric .big {
  font-size:1.6rem;
  font-weight:700;
}

/* Section cards (Education / License) spacing */
.section-card { margin-top:18px; }

/* In-card toggle style (visual only) */
.section-toggle {
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:10px;
}

/* Make list elements inside sections look like cards */
.section-list {
  display:flex;
  flex-direction:column;
  gap:10px;
  margin-top:12px;
  max-height: calc(4 * 72px + 3 * 10px); /* show 4 items, scroll rest */
  overflow-y:auto;
  padding-right:6px;
}
.section-list .section-list-item {
  background:#F4F9F1;
  border-radius:10px;
  padding:10px 12px;
  box-shadow: 0 1px 6px rgba(11,22,40,0.03);
  display:flex;
  gap:12px;
  align-items:flex-start;
  min-height:72px;
}

/* Scrollbar styling */
.section-list::-webkit-scrollbar { width:6px; }
.section-list::-webkit-scrollbar-thumb { background:#d1d5db; border-radius:4px; }
.section-list::-webkit-scrollbar-track { background:transparent; }

/* Don’t let small-right column push content on small screens */
@media (max-width: 991.98px) {
  .col-lg-10 { flex: 0 0 100%; max-width: 100%; }
  .col-lg-2  { flex: 0 0 100%; max-width: 100%; margin-top: 18px; }
}
.profile-card, .section-card, .profile-right-card {
  padding: 24px; /* increased for better spacing */
}
.profile-right-card {
  height: 100%;
}
.card-header-link svg { width: 25px; height: 25px; }
.profile-avatar-box {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  overflow: visible;
  background: #f1f1f1;
  display: flex;
  align-items: center;
  justify-content: center;
}
.profile-icon-box {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  overflow: hidden;
}
.profile-avatar-box  label {
  background: #e3e3e3;
}
.quick-link-btn {
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  padding: 10px 12px;
  border-radius: 8px;
  font-weight: 500;
  color: #374151;
  text-decoration: none;
  transition: all 0.2s ease-in-out;
}
.quick-link-btn:hover {
  background: white;
  box-shadow: 0 4px 8px rgba(0,0,0,0.08);
  transform: translateY(-2px);
}
.card-title {
  font-size: 1rem;
  color: #252930;
}
.info-item svg {
  flex-shrink: 0;
  width: 24px;
  height: 24px;
  margin-right: 4px;
}
.info-item .d-flex.gap-3 {
  gap: 16px !important;
  padding: 0;
  width: 100%;
}
.info-item .form-control {
  flex: 1;
  min-width: 0;
}
.app-page-title {
    color: #121C0C;
}
a.upload-btn-custom {
    cursor:default;
}
a.upload-btn-custom span {
    padding: 2px;
    height: 28px;
    width: 28px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 100%;
    overflow: hidden;
    color: rgb(93, 103, 120);
    cursor: pointer;
}
.upload-btn-custom span.cstm-btn-icon {
  border-radius: 100px;
  width: 24px;
  height: 24px;
  display: block;
  display: flex;
  align-items: center;
  justify-content: center;
}
.upload-btn-custom:hover span.cstm-btn-icon {
    background: #ccc;
    border: 1px solid #85BB65;
    color: #85BB65;
}
button.upload-btn-custom {
    cursor: default;
}
button.upload-btn-custom span {
    padding: 2px;
    height: 28px;
    width: 28px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 100%;
    overflow: hidden;
    color: rgb(93, 103, 120);
    margin-left: 20px;
    cursor: pointer;
}
button.upload-btn-custom:hover span {
    background: #ccc;
    border: 1px solid #85BB65;
    color: #85BB65;
}
.upload-btn-custom.upload-cv:hover {
  color: #85BB65;
}
.mg-btm-18 {
    margin-bottom: 18px;
}
/* --- To Do List --- */
.todo-list {
    overflow-y: auto;
    max-height: calc(4 * 72px + 3 * 10px); /* 4 visible items */
    padding-right: 6px;
}
.todo-item {
    border-radius: 10px;
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    padding: 2px 14px;
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
}
.card.app-card-settings {
  border: none;
  background: #fff;
  margin-bottom: 0;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(16,24,40,0.06);
  padding: 0;
  height: 100%;
  display: flex;
  flex-direction: column;
}
.card.app-card-settings .card-body {
  padding: 24px;
  flex: 1;
  display: flex;
  flex-direction: column;
}
.list-unstyled label {
  font-style: 400;
}
.share-label {
  font-weight: 500;
  font-size: 16px;
}
.card-header {
  text-align: center;
}
.profile-right-card .card-header {
  text-align: left;
  margin-bottom: 0;
}
.profile-right-card .small-metric {
  text-align: left;
}
.profile-right-card .small-metric .big {
  color: #252930;
}

.upload-dropzone {
  border: 2px dashed #85BB65;
  border-radius: 12px;
  background: #F4F9F1;
  padding: 30px 20px;
  text-align: center;
  position: relative;
  cursor: pointer;
  min-height: 200px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.upload-dropzone:hover {
  background: #f0f5ec;
}
.dropzone-input {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
  z-index: 10;
  pointer-events: auto;
}
.dropzone-content {
  position: relative;
  z-index: 1;
}
.pointer-events-none {
  pointer-events: none;
}
.upload-text {
  font-size: 1rem;
  font-weight: 500;
  margin-top: 12px;
  color: #374151;
}
.upload-subtext {
  font-size: 0.85rem;
  color: #6B7280;
  margin-top: 6px;
}
.file-badge {
  position: absolute;
  top: 10px;
  left: 10px;
  background: #85BB65;
  color: white;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.75rem;
  display: flex;
  align-items: center;
  gap: 8px;
  z-index: 3;
}
.file-remove-btn {
  background: none;
  border: none;
  color: white;
  font-size: 1rem;
  line-height: 1;
  cursor: pointer;
  padding: 0;
}
.profile-right-card.h-fix-auto {
  height: auto;
}

/* Match height of Share via Onelink with Your History card */
.row.mt-4 > .col-lg-8 .row.g-4 > .col-lg-6 {
  display: flex;
  flex-direction: column;
}

.row.mt-4 > .col-lg-4 {
  display: flex;
  flex-direction: column;
}

.row.mt-4 > .col-lg-8 .row.g-4 > .col-lg-6:last-child .profile-right-card,
.row.mt-4 > .col-lg-4 > .profile-right-card:first-child {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* Add spacing between first row (Personal Info/Your History) and second row (CV Upload/Work Preferences) */
.row > .col-12.col-lg-6:first-child .profile-card,
.row > .col-12.col-lg-6:last-child .profile-right-card {
  margin-bottom: 0;
}

/* Ensure proper spacing between rows */
.row > .col-12.mt-5 {
  margin-top: 3rem !important;
}

.cstm-toggle-btn {
  background: transparent;
  border: none;
}
.cstm-toggle-btn:hover svg {
  color: #85BB65;
}
/* Consistent green checkbox styling to match other pages */
input[type="checkbox"],
.education-checkbox {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border: 1px solid #cfd9e3;
  border-radius: 4px;
  background: #fff;
  cursor: pointer;
  position: relative;
  display: inline-block;
  vertical-align: middle;
  margin: 0;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

/* Hover state - green border */
input[type="checkbox"]:hover,
.education-checkbox:hover {
  border-color: #85BB65;
}

/* Checked state - green filled with white checkmark */
input[type="checkbox"]:checked,
.education-checkbox:checked {
  background-color: #85BB65;
  border-color: #85BB65;
}

input[type="checkbox"]:checked::after,
.education-checkbox:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 6px;
  width: 4px;
  height: 8px;
  border: solid #fff;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.action-btn-edit {
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    padding: 4px 12px;
    display: flex;
    gap: 6px;
    align-items: center;
    font-size: 14px;
}
/* Smaller buttons when in edit mode */
#infoEdit .action-btn-edit {
    padding: 3px 10px;
    font-size: 13px;
    border-radius: 8px;
}
#infoEdit .action-btn-edit .icon-image {
    width: 18px;
    height: 18px;
}
/* Smaller form inputs and icons in edit mode */
#infoEdit .form-control {
    font-size: 14px !important;
    padding: 6px 12px;
}
#infoEdit .info-item svg {
    width: 20px;
    height: 20px;
}
#infoEdit .app-card-title {
    font-size: 16px;
}
/* Reduce gap between elements in edit mode */
#infoEdit .d-flex.gap-3 {
    gap: 16px !important;
    padding: 0;
    width: 100%;
}
#infoEdit .info-item {
    padding: 10px 0;
}
#infoEdit .info-item svg {
    width: 24px;
    height: 24px;
    margin-right: 4px;
    flex-shrink: 0;
}
#infoEdit .d-flex.gap-2 {
    gap: 8px !important;
}
.action-btn-edit:hover, .dropdown-cstm:hover {
    color: #85BB65;
    border: 1px solid #85BB65;
    transition: all 0.2s ease;
}
.action-btn-edit:hover svg {
    color: #85BB65;
}
#profileForm ul {
  display: none;
}

.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
}

.popup-content {
  background: white;
  max-width: 100%;
  width: 91%;
  height: 90%;
  overflow-y: scroll;
}

.popup-body {
  margin-top: 10px;
}

.d-none {
  display: none !important;
}

.ed-card {
  border: none;
}
.ed-card .card-body {
  border-radius: 10px;
  background: #F4F9F1;
  border: 1px solid #e6eef6;
  box-shadow: 0 2px 6px rgba(11,22,40,0.03);
}
#educationModal,
#licenseModal,
#insuranceModal,
#editEducationModal {
  z-index: 10001 !important;
}
.modal-backdrop {
  z-index: 10000 !important;
}
.modal.show {
  z-index: 10001 !important;
}
.popup-close {
  border: none;
  background: transparent;
}
.cstm-btn-style {
  background: #F4F9F1;
  border: 1px solid #e6eef6;
  box-shadow: 0 2px 6px rgba(11,22,40,0.03);
  border-radius: 10px;
  padding: 4px 12px;
}
.cstm-btn-style:hover, .dropdown-cstm:hover {
    color: #85BB65;
    border: 1px solid #85BB65;
    transition: all 0.2s ease;
}
</style>

<div class="container-xl">
  <h1 class="app-page-title">Profile</h1>

  <div class="row mt-4">
    <div class="col-12 col-lg-8">
      <div class="row g-4">
        {# Left: profile card #}
          <div class="col-12 col-lg-6 d-flex flex-column">
              <div id="personalSection" class="profile-card" style="position: relative;">
                <div id="infoView" style="position: relative;">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                      <h6 class="app-card-title mb-0">Personal Information</h6>
                      <div id="actionIcons">
                        <a href="javascript:void(0);" id="editToggle" class="link-plain" title="Edit">
                          <!-- Pencil Icon -->
                          <svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                               stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 20h9"></path>
                            <path d="M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
                          </svg>
                        </a>
                      </div>
                  </div>

                  <div class="d-flex gap-4 align-items-center" style="margin-bottom: 8px;">
                    <div class="profile-avatar-box">
                        <div class="profile-icon-box">
                            {% if app.user.profilePictureFilename %}
                                <img src="{{ asset('uploads/' ~ app.user.id ~ '/' ~ app.user.profilePictureFilename) }}"
                                    alt="profile"
                                    style="width:100%;height:100%;object-fit:cover;">
                            {% else %}
                                <img src="{{ asset('assets/icons/user-profile.png') }}"
                                    alt="profile"
                                    style="width:60%;height:60%;object-fit:contain;">
                            {% endif %}
                        </div>
                    </div>
                    <div style="flex:1;">
                        <div class="fw-semibold fs-5">{{ app.user.name }}</div>
                    </div>
                </div>

                  <!-- Removed duplicate name section -->

                  <div style="margin-top:14px; padding: 0 8px;">

                    <div class="info-item">
                      <div class="d-flex gap-3 align-items-center">
                        <svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g id="style=stroke">
                        <g id="email">
                        <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="#121C0C"></path>
                        <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="#121C0C"></path>
                        </g>
                        </g>
                        </svg>
                        <div class="text-muted small"> {{ app.user.email }}</div>
                      </div>
                    </div>

                    <div class="info-item">
                      <div class="d-flex gap-3 align-items-center">
                        <!-- Email Icon -->
                        <svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 20.5H17.5C18.0523 20.5 18.5 20.0523 18.5 19.5V6" stroke="#121C0C" stroke-linecap="round"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M5 4.0749C5 3.48125 5.47736 3 6.0662 3H15.5097C16.0986 3 16.5759 3.48125 16.5759 4.0749V17.4855C16.5759 18.0792 16.0986 18.5604 15.5097 18.5604H6.0662C5.47736 18.5604 5 18.0792 5 17.4855V4.0749ZM8.22161 14.2881C7.8069 13.968 7.8069 13.3524 8.22161 13.0323C8.93304 12.4831 9.8227 12.1568 10.7879 12.1568C11.7532 12.1568 12.6428 12.4831 13.3543 13.0323C13.769 13.3524 13.769 13.968 13.3543 14.2881C12.6428 14.8373 11.7532 15.1636 10.7879 15.1636C9.8227 15.1636 8.93304 14.8373 8.22161 14.2881ZM10.7859 11.4041C11.8824 11.4041 12.7713 10.2832 12.7713 8.90046C12.7713 7.51772 11.8824 6.39679 10.7859 6.39679C9.68945 6.39679 8.80058 7.51772 8.80058 8.90046C8.80058 10.2832 9.68945 11.4041 10.7859 11.4041Z" stroke="#121C0C"/>
                        </svg>
                        <div>
                          {{ app.user.getAddress() ?: 'No address provided' }}
                        </div>
                      </div>
                    </div>

                    <div class="info-item">
                      <div class="d-flex gap-3 align-items-center">
                        <!-- Phone Icon -->
                        <svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.7177 3.0919C5.94388 1.80096 7.9721 2.04283 8.98569 3.47641L10.2467 5.25989C11.0574 6.40656 10.9889 8.00073 10.0214 9.0194L9.7765 9.27719C9.77582 9.27897 9.7751 9.2809 9.77436 9.28299C9.76142 9.31935 9.7287 9.43513 9.7609 9.65489C9.82765 10.1104 10.1793 11.0361 11.607 12.5392C13.0391 14.0469 13.9078 14.4023 14.3103 14.4677C14.484 14.4959 14.5748 14.4714 14.6038 14.4612L15.0124 14.031C15.8862 13.111 17.2485 12.9298 18.347 13.5621L20.2575 14.6617C21.8904 15.6016 22.2705 17.9008 20.9655 19.2747L19.545 20.7703C19.1016 21.2371 18.497 21.6355 17.75 21.7092C15.9261 21.8893 11.701 21.6548 7.27161 16.9915C3.13844 12.64 2.35326 8.85513 2.25401 7.00591L2.92011 6.97016L2.25401 7.00591C2.20497 6.09224 2.61224 5.30855 3.1481 4.7444L4.7177 3.0919ZM7.7609 4.34237C7.24855 3.61773 6.32812 3.57449 5.80528 4.12493L4.23568 5.77743C3.90429 6.12632 3.73042 6.52621 3.75185 6.92552C3.83289 8.43533 4.48307 11.8776 8.35919 15.9584C12.4234 20.2373 16.1676 20.3581 17.6026 20.2165C17.8864 20.1885 18.1783 20.031 18.4574 19.7373L19.8779 18.2417C20.4907 17.5965 20.3301 16.4342 19.5092 15.9618L17.5987 14.8621C17.086 14.567 16.4854 14.6582 16.1 15.064L15.6445 15.5435L15.1174 15.0428C15.6445 15.5435 15.6438 15.5442 15.6432 15.545L15.6417 15.5464L15.6388 15.5495L15.6324 15.556L15.6181 15.5701C15.6078 15.5801 15.5959 15.591 15.5825 15.6028C15.5556 15.6264 15.5223 15.6533 15.4824 15.6816C15.4022 15.7384 15.2955 15.8009 15.1606 15.8541C14.8846 15.963 14.5201 16.0214 14.0699 15.9483C13.1923 15.8058 12.0422 15.1755 10.5194 13.5722C8.99202 11.9642 8.40746 10.7645 8.27675 9.87234C8.21022 9.41827 8.26346 9.05468 8.36116 8.78011C8.40921 8.64508 8.46594 8.53742 8.51826 8.45566C8.54435 8.41489 8.56922 8.38075 8.5912 8.35298C8.60219 8.33909 8.61246 8.32678 8.62182 8.31603L8.63514 8.30104L8.64125 8.29441L8.64415 8.2913L8.64556 8.2898C8.64625 8.28907 8.64694 8.28835 9.17861 8.79333L8.64695 8.28834L8.93376 7.98637C9.3793 7.51731 9.44403 6.72292 9.02189 6.12586L7.7609 4.34237Z" fill="#121C0C"/>
                        <path d="M13.2595 1.87983C13.3257 1.47094 13.7122 1.19357 14.1211 1.25976C14.1464 1.26461 14.2279 1.27983 14.2705 1.28933C14.3559 1.30834 14.4749 1.33759 14.6233 1.38082C14.9201 1.46726 15.3347 1.60967 15.8323 1.8378C16.8286 2.29456 18.1544 3.09356 19.5302 4.46936C20.906 5.84516 21.705 7.17097 22.1617 8.16725C22.3899 8.66487 22.5323 9.07947 22.6187 9.37625C22.6619 9.52466 22.6912 9.64369 22.7102 9.72901C22.7197 9.77168 22.7267 9.80594 22.7315 9.83125L22.7373 9.86245C22.8034 10.2713 22.5286 10.6739 22.1197 10.7401C21.712 10.8061 21.3279 10.53 21.2601 10.1231C21.258 10.1121 21.2522 10.0828 21.2461 10.0551C21.2337 9.9997 21.2124 9.91188 21.1786 9.79572C21.1109 9.56339 20.9934 9.21806 20.7982 8.79238C20.4084 7.94207 19.7074 6.76789 18.4695 5.53002C17.2317 4.29216 16.0575 3.59117 15.2072 3.20134C14.7815 3.00618 14.4362 2.88865 14.2038 2.82097C14.0877 2.78714 13.9417 2.75363 13.8863 2.7413C13.4793 2.67347 13.1935 2.28755 13.2595 1.87983Z" fill="#121C0C"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M13.4861 5.32931C13.5999 4.93103 14.015 4.70041 14.4133 4.81421L14.2072 5.53535C14.4133 4.81421 14.4136 4.81431 14.414 4.81441L14.4147 4.81462L14.4162 4.81506L14.4196 4.81604L14.4273 4.81835L14.4471 4.82451C14.4622 4.82934 14.481 4.83562 14.5035 4.84358C14.5484 4.85952 14.6077 4.88218 14.6805 4.91339C14.8262 4.97582 15.0253 5.07224 15.2698 5.21695C15.7593 5.50664 16.4275 5.98781 17.2124 6.77279C17.9974 7.55776 18.4786 8.22595 18.7683 8.71541C18.913 8.95992 19.0094 9.15899 19.0718 9.30467C19.103 9.37748 19.1257 9.43683 19.1416 9.48175C19.1496 9.5042 19.1559 9.52303 19.1607 9.5381L19.1669 9.55789L19.1692 9.56564L19.1702 9.56898L19.1706 9.57051L19.1708 9.57124C19.1709 9.5716 19.171 9.57195 18.4499 9.77799L19.171 9.57195C19.2848 9.97023 19.0542 10.3853 18.6559 10.4991C18.261 10.612 17.8496 10.3862 17.7317 9.99414L17.728 9.98336C17.7227 9.96833 17.7116 9.93875 17.6931 9.89555C17.6561 9.80921 17.589 9.66798 17.4774 9.47939C17.2544 9.10265 16.8517 8.5334 16.1518 7.83345C15.4518 7.13349 14.8826 6.73079 14.5058 6.50782C14.3172 6.3962 14.176 6.32911 14.0897 6.2921C14.0465 6.27359 14.0169 6.26256 14.0019 6.25722L13.9911 6.25353C13.599 6.13565 13.3733 5.7242 13.4861 5.32931Z" fill="#121C0C"/>
                        </svg>
                        <div>{{ app.user.phone1 }}</div>
                      </div>
                    </div>

                    {#<div class="info-item">
                      <div class="d-flex gap-3 align-items-center">
                        <!-- Gender Icon -->
                        <svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <circle cx="12" cy="12" r="4"></circle>
                          <path d="M20 4v5h-5"></path>
                          <path d="M4 20v-5h5"></path>
                        </svg>
                        <div>{{ app.user.gender }}</div>
                      </div>
                    </div>#}

                    <!-- Proper Toggle Switch (visual only) -->
                    {#<div class="form-check form-switch mt-3">
                      <input class="form-check-input" type="checkbox" id="togglePersonal" checked disabled>
                      <label class="form-check-label" for="togglePersonal">
                        One file: Personal Information
                      </label>
                    </div>#}
                  </div>
                </div>
                <div id="infoEdit" style="display: none; position: absolute; top: 0; left: 0; right: 0; width: 100%;">
                  <div class="d-flex justify-content-between align-items-center mb-3" style="padding: 0 8px;">
                      <h6 class="app-card-title mb-0">Personal Information</h6>
                      <div id="actionIcons" class="d-flex gap-2">
                        <!-- Save Button -->
                        <button type="submit" form="profileForm" id="saveBtn" class="action-btn-edit" title="Save">
                          <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                          <g data-name="Layer 2">
                          <g data-name="checkmark-circle">
                          <rect width="24" height="24" opacity="0"></rect>
                          <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"></path>
                          <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"></path>
                          </g>
                          </g>
                          <use xlink:href="#icon-apply"></use>
                          </svg> Save
                        </button>

                        <!-- Cancel Button -->
                        <button type="button" id="cancelBtn" class="action-btn-edit" title="Cancel">
                          <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg" aria-labelledby="cancelIconTitle" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" color="currentcolor"> <title id="cancelIconTitle">Cancel</title> <path d="M15.5355339 15.5355339L8.46446609 8.46446609M15.5355339 8.46446609L8.46446609 15.5355339"/> <path d="M4.92893219,19.0710678 C1.02368927,15.1658249 1.02368927,8.83417511 4.92893219,4.92893219 C8.83417511,1.02368927 15.1658249,1.02368927 19.0710678,4.92893219 C22.9763107,8.83417511 22.9763107,15.1658249 19.0710678,19.0710678 C15.1658249,22.9763107 8.83417511,22.9763107 4.92893219,19.0710678 Z"/> </svg> Cancel
                        </button>
                      </div>
                  </div>
            {{ form_start(profileForm, {'attr': {'id': 'profileForm', 'class': 'needs-validation', 'novalidate': 'novalidate', 'enctype': 'multipart/form-data'}}) }}
                  {{ form_errors(profileForm) }}
                  <div class="d-flex gap-3 align-items-center mb-3" style="padding: 0 8px;">
                    <div class="position-relative profile-avatar-box">
                      <div class="profile-icon-box">
                          {% if app.user.profilePicture %}
                              <img src="{{ asset('uploads/' ~ app.user.id ~ '/' ~ app.user.profilePicture) }}" alt="profile" style="width:100%;height:100%;object-fit:cover;">
                          {% else %}
                              <img src="{{ asset('assets/icons/user-profile.png') }}" alt="profile" style="width:60%;height:60%;object-fit:contain;">
                          {% endif %}
                      </div>

                      <!-- Camera Icon Overlay -->
                      <label for="profileImageInput" class="position-absolute bottom-0 end-0 bg-light p-1 rounded-circle" style="cursor:pointer;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="13" r="3" stroke="#1C274C" stroke-width="1.5"/>
                        <path d="M2 13.3636C2 10.2994 2 8.76721 2.74902 7.6666C3.07328 7.19014 3.48995 6.78104 3.97524 6.46268C4.69555 5.99013 5.59733 5.82123 6.978 5.76086C7.63685 5.76086 8.20412 5.27068 8.33333 4.63636C8.52715 3.68489 9.37805 3 10.3663 3H13.6337C14.6219 3 15.4728 3.68489 15.6667 4.63636C15.7959 5.27068 16.3631 5.76086 17.022 5.76086C18.4027 5.82123 19.3044 5.99013 20.0248 6.46268C20.51 6.78104 20.9267 7.19014 21.251 7.6666C22 8.76721 22 10.2994 22 13.3636C22 16.4279 22 17.9601 21.251 19.0607C20.9267 19.5371 20.51 19.9462 20.0248 20.2646C18.9038 21 17.3433 21 14.2222 21H9.77778C6.65675 21 5.09624 21 3.97524 20.2646C3.48995 19.9462 3.07328 19.5371 2.74902 19.0607C2.53746 18.7498 2.38566 18.4045 2.27673 18" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M19 10H18" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                      </label>
                      {{ form_widget(profileForm.profilePictureFilename, {'attr': {'id': 'profileImageInput', 'accept': 'image/*', 'class': 'd-none'}}) }}
                    </div>

                    <div style="flex:1;">
                      {{ form_widget(profileForm.name, {'attr': {'class': 'form-control fw-semibold'}}) }}
                      {{ form_errors(profileForm.name) }}
                    </div>
                  </div>

                  <div style="margin-top:14px; padding: 0 8px;">
                    <!-- Email -->
                    <div class="info-item">
                      <div class="d-flex gap-3 align-items-center">
                        <svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <g id="style=stroke">
                            <g id="email">
                              <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="#121C0C"></path>
                              <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="#121C0C"></path>
                            </g>
                          </g>
                        </svg>
                          {{ form_row(profileForm.email, {'attr': {'class': 'form-control'}}) }}
                      </div>
                    </div>

                    <!-- Address -->
                    <div class="info-item mt-2">
                      <div class="d-flex gap-3 align-items-center">
                        <svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M8 20.5H17.5C18.0523 20.5 18.5 20.0523 18.5 19.5V6" stroke="#121C0C" stroke-linecap="round"/>
                          <path fill-rule="evenodd" clip-rule="evenodd" d="M5 4.0749C5 3.48125 5.47736 3 6.0662 3H15.5097C16.0986 3 16.5759 3.48125 16.5759 4.0749V17.4855C16.5759 18.0792 16.0986 18.5604 15.5097 18.5604H6.0662C5.47736 18.5604 5 18.0792 5 17.4855V4.0749ZM8.22161 14.2881C7.8069 13.968 7.8069 13.3524 8.22161 13.0323C8.93304 12.4831 9.8227 12.1568 10.7879 12.1568C11.7532 12.1568 12.6428 12.4831 13.3543 13.0323C13.769 13.3524 13.769 13.968 13.3543 14.2881C12.6428 14.8373 11.7532 15.1636 10.7879 15.1636C9.8227 15.1636 8.93304 14.8373 8.22161 14.2881ZM10.7859 11.4041C11.8824 11.4041 12.7713 10.2832 12.7713 8.90046C12.7713 7.51772 11.8824 6.39679 10.7859 6.39679C9.68945 6.39679 8.80058 7.51772 8.80058 8.90046C8.80058 10.2832 9.68945 11.4041 10.7859 11.4041Z" stroke="#121C0C"/>
                        </svg>
                          {{ form_row(profileForm.address, {'attr': {'class': 'form-control'}}) }}
                      </div>
                    </div>

                    <!-- Phone -->
                    <div class="info-item mt-2">
                      <div class="d-flex gap-3 align-items-center">
                      <!-- Phone Icon -->
                        <svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.7177 3.0919C5.94388 1.80096 7.9721 2.04283 8.98569 3.47641L10.2467 5.25989C11.0574 6.40656 10.9889 8.00073 10.0214 9.0194L9.7765 9.27719C9.77582 9.27897 9.7751 9.2809 9.77436 9.28299C9.76142 9.31935 9.7287 9.43513 9.7609 9.65489C9.82765 10.1104 10.1793 11.0361 11.607 12.5392C13.0391 14.0469 13.9078 14.4023 14.3103 14.4677C14.484 14.4959 14.5748 14.4714 14.6038 14.4612L15.0124 14.031C15.8862 13.111 17.2485 12.9298 18.347 13.5621L20.2575 14.6617C21.8904 15.6016 22.2705 17.9008 20.9655 19.2747L19.545 20.7703C19.1016 21.2371 18.497 21.6355 17.75 21.7092C15.9261 21.8893 11.701 21.6548 7.27161 16.9915C3.13844 12.64 2.35326 8.85513 2.25401 7.00591L2.92011 6.97016L2.25401 7.00591C2.20497 6.09224 2.61224 5.30855 3.1481 4.7444L4.7177 3.0919ZM7.7609 4.34237C7.24855 3.61773 6.32812 3.57449 5.80528 4.12493L4.23568 5.77743C3.90429 6.12632 3.73042 6.52621 3.75185 6.92552C3.83289 8.43533 4.48307 11.8776 8.35919 15.9584C12.4234 20.2373 16.1676 20.3581 17.6026 20.2165C17.8864 20.1885 18.1783 20.031 18.4574 19.7373L19.8779 18.2417C20.4907 17.5965 20.3301 16.4342 19.5092 15.9618L17.5987 14.8621C17.086 14.567 16.4854 14.6582 16.1 15.064L15.6445 15.5435L15.1174 15.0428C15.6445 15.5435 15.6438 15.5442 15.6432 15.545L15.6417 15.5464L15.6388 15.5495L15.6324 15.556L15.6181 15.5701C15.6078 15.5801 15.5959 15.591 15.5825 15.6028C15.5556 15.6264 15.5223 15.6533 15.4824 15.6816C15.4022 15.7384 15.2955 15.8009 15.1606 15.8541C14.8846 15.963 14.5201 16.0214 14.0699 15.9483C13.1923 15.8058 12.0422 15.1755 10.5194 13.5722C8.99202 11.9642 8.40746 10.7645 8.27675 9.87234C8.21022 9.41827 8.26346 9.05468 8.36116 8.78011C8.40921 8.64508 8.46594 8.53742 8.51826 8.45566C8.54435 8.41489 8.56922 8.38075 8.5912 8.35298C8.60219 8.33909 8.61246 8.32678 8.62182 8.31603L8.63514 8.30104L8.64125 8.29441L8.64415 8.2913L8.64556 8.2898C8.64625 8.28907 8.64694 8.28835 9.17861 8.79333L8.64695 8.28834L8.93376 7.98637C9.3793 7.51731 9.44403 6.72292 9.02189 6.12586L7.7609 4.34237Z" fill="#121C0C"/>
                        <path d="M13.2595 1.87983C13.3257 1.47094 13.7122 1.19357 14.1211 1.25976C14.1464 1.26461 14.2279 1.27983 14.2705 1.28933C14.3559 1.30834 14.4749 1.33759 14.6233 1.38082C14.9201 1.46726 15.3347 1.60967 15.8323 1.8378C16.8286 2.29456 18.1544 3.09356 19.5302 4.46936C20.906 5.84516 21.705 7.17097 22.1617 8.16725C22.3899 8.66487 22.5323 9.07947 22.6187 9.37625C22.6619 9.52466 22.6912 9.64369 22.7102 9.72901C22.7197 9.77168 22.7267 9.80594 22.7315 9.83125L22.7373 9.86245C22.8034 10.2713 22.5286 10.6739 22.1197 10.7401C21.712 10.8061 21.3279 10.53 21.2601 10.1231C21.258 10.1121 21.2522 10.0828 21.2461 10.0551C21.2337 9.9997 21.2124 9.91188 21.1786 9.79572C21.1109 9.56339 20.9934 9.21806 20.7982 8.79238C20.4084 7.94207 19.7074 6.76789 18.4695 5.53002C17.2317 4.29216 16.0575 3.59117 15.2072 3.20134C14.7815 3.00618 14.4362 2.88865 14.2038 2.82097C14.0877 2.78714 13.9417 2.75363 13.8863 2.7413C13.4793 2.67347 13.1935 2.28755 13.2595 1.87983Z" fill="#121C0C"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M13.4861 5.32931C13.5999 4.93103 14.015 4.70041 14.4133 4.81421L14.2072 5.53535C14.4133 4.81421 14.4136 4.81431 14.414 4.81441L14.4147 4.81462L14.4162 4.81506L14.4196 4.81604L14.4273 4.81835L14.4471 4.82451C14.4622 4.82934 14.481 4.83562 14.5035 4.84358C14.5484 4.85952 14.6077 4.88218 14.6805 4.91339C14.8262 4.97582 15.0253 5.07224 15.2698 5.21695C15.7593 5.50664 16.4275 5.98781 17.2124 6.77279C17.9974 7.55776 18.4786 8.22595 18.7683 8.71541C18.913 8.95992 19.0094 9.15899 19.0718 9.30467C19.103 9.37748 19.1257 9.43683 19.1416 9.48175C19.1496 9.5042 19.1559 9.52303 19.1607 9.5381L19.1669 9.55789L19.1692 9.56564L19.1702 9.56898L19.1706 9.57051L19.1708 9.57124C19.1709 9.5716 19.171 9.57195 18.4499 9.77799L19.171 9.57195C19.2848 9.97023 19.0542 10.3853 18.6559 10.4991C18.261 10.612 17.8496 10.3862 17.7317 9.99414L17.728 9.98336C17.7227 9.96833 17.7116 9.93875 17.6931 9.89555C17.6561 9.80921 17.589 9.66798 17.4774 9.47939C17.2544 9.10265 16.8517 8.5334 16.1518 7.83345C15.4518 7.13349 14.8826 6.73079 14.5058 6.50782C14.3172 6.3962 14.176 6.32911 14.0897 6.2921C14.0465 6.27359 14.0169 6.26256 14.0019 6.25722L13.9911 6.25353C13.599 6.13565 13.3733 5.7242 13.4861 5.32931Z" fill="#121C0C"/>
                        </svg>
                          {{ form_row(profileForm.phone1, {'attr': {'class': 'form-control'}}) }}
                        </div>
                    </div>
                  </div>
                  {# Do NOT render these fields #}
                  {# form_widget(profileForm.gender) #}
                  {# form_widget(profileForm.phone2) #}
                  {# profilePictureFilename is already rendered above #}

                  {{ form_end(profileForm, {'render_rest': false}) }}
                </div>
              </div>
          </div>

          {# Center: assignment column #}
          <div class="col-12 col-lg-6 d-flex flex-column">
            <div class="profile-right-card h-fix-auto">
              <div class="card-header-row d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Your History</h5>
              </div>
              <div class="card-body" style="padding: 12px 16px;">
                <div class="mb-2" style="text-align: left;">
                  <h6 class="card-title mb-1" style="font-size: 0.875rem; font-weight: 500; color: #252930; margin-bottom: 2px;">Your Average Rating</h6>
                  <div class="d-flex align-items-center" style="margin-top: 2px;">
                    <div class="d-flex align-items-center" style="gap: 2px;">
                      {% set rating = 3.72 %}
                      {% set fullStars = (rating // 1)|number_format(0, '.', '') %}
                      {% set partialStar = rating - fullStars %}
                      {% for i in 1..5 %}
                        {% if i <= fullStars %}
                          {# Filled star (golden yellow) #}
                          <svg width="14" height="14" viewBox="0 0 24 24" fill="#FFD700" stroke="#FFD700" stroke-width="1" style="display: block; flex-shrink: 0;">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                          </svg>
                        {% elseif i == fullStars + 1 and partialStar > 0 %}
                          {# Half-filled star #}
                          <svg width="14" height="14" viewBox="0 0 24 24" style="display: block; flex-shrink: 0; position: relative;">
                            <defs>
                              <clipPath id="half-star-clip-{{ i }}">
                                <rect x="0" y="0" width="12" height="24"/>
                              </clipPath>
                            </defs>
                            {# Empty star outline (full) #}
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="none" stroke="#D1D5DB" stroke-width="1"/>
                            {# Filled portion (clipped to left half) #}
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="#FFD700" stroke="#FFD700" stroke-width="1" clip-path="url(#half-star-clip-{{ i }})"/>
                          </svg>
                        {% else %}
                          {# Empty star (grey outline) #}
                          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#D1D5DB" stroke-width="1" style="display: block; flex-shrink: 0;">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                          </svg>
                        {% endif %}
                      {% endfor %}
              </div>
                  </div>
                </div>
                <div class="mb-2" style="text-align: left;">
                  <h6 class="card-title mb-1" style="font-size: 0.875rem; font-weight: 500; color: #252930; margin-bottom: 2px;">Locum Assignments : </h6>
                  <h4 class="fw-normal mb-0" style="font-size: 1.125rem; font-weight: 600; color: #252930; line-height: 1.2;">10</h4>
                </div>
                <div style="text-align: left;">
                  <h6 class="card-title mb-1" style="font-size: 0.875rem; font-weight: 500; color: #252930; margin-bottom: 2px;">Years Active : </h6>
                  <h4 class="fw-normal mb-0" style="font-size: 1.125rem; font-weight: 600; color: #252930; line-height: 1.2;">15 years</h4>
                </div>
                </div>
            </div>
          </div>

          <div class="col-12 mt-5">
            <div class="row g-4">
              <div class="col-12 col-md-6">
                <div class="card app-card-settings h-100">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title mb-3">{{ editMode is defined ? 'Edit Document' : 'CV Upload' }}</h5>

                    {{ form_start(documentForm, {
                'attr': {
                    'class': 'needs-validation',
                    'novalidate': 'novalidate',
                    'enctype': 'multipart/form-data'
                }
            }) }}
            <div class="upload-dropzone position-relative mb-3 flex-grow-1"
                style="display:flex; align-items:center; justify-content:center; min-height:180px; border:1px dashed #D1D5DB; border-radius:8px; background:#F9FAFB; cursor:pointer;">
              {{ form_widget(documentForm.fileName, {
                'attr': {
                  'class': 'dropzone-input position-absolute top-0 start-0 w-100 h-100',
                  'id': 'dropzoneInput',
                  'accept': '.pdf,.csv,.xls,.xlsx',
                  'style': 'opacity:0; cursor:pointer;',
                  'onchange': 'handleFileChange(this)'
                }
              }) }}

              <!-- Filename badge -->
              <div id="fileBadge" class="file-badge position-absolute top-2 end-2 bg-white px-2 py-1 rounded shadow-sm" style="display:none;">
                <span id="fileNameText" class="small text-muted"></span>
                <button type="button" class="file-remove-btn btn btn-sm btn-light ms-1" onclick="clearFile()">×</button>
              </div>

              <div class="dropzone-content text-center pointer-events-none">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#85BB65" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                  <line x1="16" y1="13" x2="8" y2="13"/>
                  <line x1="16" y1="17" x2="8" y2="17"/>
                  <line x1="10" y1="9" x2="8" y2="9"/>
                </svg>

                <p class="mb-1" style="font-size: 0.95rem; color: #252930; font-weight: 500;">Drag and drop or click to upload</p>
                <p class="mb-0 text-muted" style="font-size: 0.85rem;">Supported formats: PDF, CSV, XLS (Max 25MB)</p>
              </div>
            </div>
            <div class="d-flex justify-content-end gap-2 mt-3">
              <a href="javascript:void(0);" class="upload-btn-custom" onclick="clearFile()" style="padding: 8px 16px; font-size: 0.9rem;">Cancel</a>
              <button type="submit" class="upload-btn-custom upload-cv" style="padding: 8px 16px; font-size: 0.9rem;">
                {{ editMode is defined ? 'Update' : 'Upload CV' }}
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="ms-1">
                  <path d="M5 12h14M12 5l7 7-7 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            {{ form_end(documentForm, {'render_rest': false}) }}
          </div>
        </div>
      </div>
      <!-- Right column -->
      <div class="col-12 col-md-6">
        <div class="card app-card-settings h-100">
          <div class="card-body d-flex flex-column">
            <div class="card-header-row d-flex justify-content-between align-items-center mb-3">
              <h5 class="card-title mb-0">Work Preferences</h5>
            </div>
            <div class="work-preferences flex-grow-1 d-flex align-items-center justify-content-center" style="min-height: 200px; background: #F9FAFB; border-radius: 8px; border: 1px dashed #E5E7EB;">
              <p class="text-muted mb-0" style="font-size: 0.9rem;">Work preferences content will appear here</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

        </div>
      </div>

    {# Right: narrow column for upload buttons and quick links - col-lg-2 #}
    <div class="col-12 col-lg-4 d-flex flex-column" style="align-self: flex-start;">
      <div class="profile-right-card h-fix-auto" style="margin-top: -24px;">
          <div class="card-header-row d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">Share via Onelink</h5>
            <button id="toggle-checkmarks" class="cstm-toggle-btn" title="Toggle Checkmarks">
              <svg icon-image width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g id="Communication / Share_iOS_Export">
              <path id="Vector" d="M9 6L12 3M12 3L15 6M12 3V13M7.00023 10C6.06835 10 5.60241 10 5.23486 10.1522C4.74481 10.3552 4.35523 10.7448 4.15224 11.2349C4 11.6024 4 12.0681 4 13V17.8C4 18.9201 4 19.4798 4.21799 19.9076C4.40973 20.2839 4.71547 20.5905 5.0918 20.7822C5.5192 21 6.07899 21 7.19691 21H16.8036C17.9215 21 18.4805 21 18.9079 20.7822C19.2842 20.5905 19.5905 20.2839 19.7822 19.9076C20 19.4802 20 18.921 20 17.8031V13C20 12.0681 19.9999 11.6024 19.8477 11.2349C19.6447 10.7448 19.2554 10.3552 18.7654 10.1522C18.3978 10 17.9319 10 17 10" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </g>
              </svg>
            </button>
          </div>

          <div class="card-body">
            <div class="mb-3 ">
              <input type="text" id="share-url" class="form-control" placeholder="Enter email address to share with" style="max-width: 300px;">
            </div>

            <div class="d-flex justify-content-end mt-3">
              <button type="button" class="upload-btn-custom">Share</button>
            </div>
          </div>
        </div>
      <div class="profile-right-card mt-4 h-fix-auto">
        <div class="card-header-row d-flex justify-content-between">
            <h5 class="card-title mb-0">Quick Links</h5>
        </div>

        <div class="upload-list mt-2">
          {# Other items as links to specific pages (you can replace '#' with real routes) #}
           <div class="upload-btn-custom"><span class="cstm-btn-text">Education & Training</span>
           <span class="cstm-btn-checkmark">
           <input type="checkbox" class="upload-check d-none ms-2">
           </span>
           <a href="#" class="open-popup" data-popup="education" role="button">
           <span class="cstm-btn-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 6L15 12L9 18" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          </a>
          </div>
          <div class="upload-btn-custom"><span class="cstm-btn-text">License & Certificate</span>
          <span class="cstm-btn-checkmark">
          <input type="checkbox" class="upload-check d-none ms-2">
          </span>
          <a href="#" class="open-popup" data-popup="license" role="button">
          <span class="cstm-btn-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 6L15 12L9 18" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          </a>
          </div>
          {#<a class="upload-btn-custom" href="/provider/profile/work-preferences" role="link">Work Preference<span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 6L15 12L9 18" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span></a>#}
          <div class="upload-btn-custom"><span class="cstm-btn-text">Insurance</span>
          <span class="cstm-btn-checkmark">
          <input type="checkbox" class="upload-check d-none ms-2">
          </span>
          <a href="#" class="open-popup" data-popup="insurance" role="button">
          <span class="cstm-btn-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 6L15 12L9 18" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          </a>
          </div>
          <div class="upload-btn-custom"><span class="cstm-btn-text">Health Assessment</span>
          <span class="cstm-btn-checkmark">
          <input type="checkbox" class="upload-check d-none ms-2">
          </span>
          <a href="#" class="open-popup" data-popup="health" role="button">
          <span class="cstm-btn-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 6L15 12L9 18" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          </a>
          </div>
          <div class="upload-btn-custom"><span class="cstm-btn-text">Risk Assessment</span>
          <span class="cstm-btn-checkmark">
          <input type="checkbox" class="upload-check d-none ms-2">
          </span>
          <a href="#" class="open-popup" data-popup="risk" role="button">
          <span class="cstm-btn-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 6L15 12L9 18" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          </a>
          </div>
          <div class="upload-btn-custom"><span class="cstm-btn-text">References</span>
          <span class="cstm-btn-checkmark">
          <input type="checkbox" class="upload-check d-none ms-2">
          </span>
          <a href="#" role="link">
          <span class="cstm-btn-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 6L15 12L9 18" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          </a>
          </div>
          <div class="upload-btn-custom upload-btn-documents"><span class="cstm-btn-text">Documents</span>
          <a href="/provider/documents" role="link">
          <span class="cstm-btn-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 6L15 12L9 18" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          </a>
          </div>
      </div>
      {#<div class="profile-right-card mg-btm-18">
          <div class="upload-list">
              Only CV Upload triggers modal; others are links (change href to your real routes)
              <button type="button" class="upload-btn-custom upload-cv" data-bs-toggle="modal" data-bs-target="#uploadModal" onclick="setCategory('CV Upload')">
              </button>
          </div>
      </div>#}

        {# Note: the toggles are intentionally inert and were moved inside each card above #}
      </div>
    </div>
  </div>
  </div>
</div>
</div>

<div id="popup-education" class="popup-overlay d-none">
  <div class="popup-content shadow-lg p-3 rounded-3">
    <div class="popup-header d-flex justify-content-between align-items-center">
      <h5>Education & Training</h5>
      <button id="popupClose" class="popup-close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M6 18L18 6M6 6l12 12" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div class="popup-body">
      <section class="content">
        <div class="row">
          <div class="col-12">
            <a href="#" class="cstm-btn-style" id="openAddEducationModal">
              Add New
            </a>

            <div id="educationListContainer" class="row g-3 mt-2">
              <!-- Education entries will be loaded here dynamically -->
                    </div>

            <div class="d-flex justify-content-end mt-4">
              <a href="#" class="cstm-btn-style" onclick="document.getElementById('popup-education').classList.add('d-none'); return false;">
              Continue
            </a>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<div id="popup-license" class="popup-overlay d-none">
  <div class="popup-content shadow-lg p-3 rounded-3">
    <div class="popup-header d-flex justify-content-between align-items-center">
      <h5>License & Certificate</h5>
      <button class="popup-close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M6 18L18 6M6 6l12 12" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div class="popup-body">
      <section class="content">
        <div class="row">
          <div class="col-12">
            <a href="#" class="cstm-btn-style" id="openLicenseModal">
              Add New
            </a>

            <div class="row g-3 mt-2">
              <div class="col-md-6">
                <div class="card ed-card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                      <h5 class="card-title mb-0">Registered Nurse License</h5>
                      <div class="d-flex gap-2">
                        <a href="#" class="edit-experience" title="Edit" style="padding: 4px;">
                          <img src="/assets/icons/compose.png" class="icon-image" style="width: 18px; height: 18px;" />
                        </a>
                        <a href="#" onclick="return confirm('Are you sure? Do you want to remove this item?');" style="padding: 4px;">
                          <img src="/assets/icons/trash-bin.png" class="icon-image" style="width: 18px; height: 18px;" />
                        </a>
                      </div>
                    </div>
                    <p><strong>Employment Type:</strong> Full-Time</p>
                    <p><strong>Company:</strong> HealthCare Nepal</p>
                    <p><i class="fa fa-map-marker-alt"></i> Kathmandu, Nepal</p>
                    <div class="d-flex gap-4 mt-3 pt-3" style="border-top: 1px solid #e6eef6;">
                      <div>
                        <p class="mb-1" style="font-size: 0.85rem; color: #6B7280;">Start Date</p>
                        <p class="mb-0"><strong>01/01/2020</strong></p>
                      </div>
                      <div>
                        <p class="mb-1" style="font-size: 0.85rem; color: #6B7280;">End Date</p>
                        <p class="mb-0"><strong>12/31/2025</strong></p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="card ed-card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                      <h5 class="card-title mb-0">CPR Certification</h5>
                      <div class="d-flex gap-2">
                        <a href="#" class="edit-experience" title="Edit" style="padding: 4px;">
                          <img src="/assets/icons/compose.png" class="icon-image" style="width: 18px; height: 18px;" />
                        </a>
                        <a href="#" onclick="return confirm('Are you sure? Do you want to remove this item?');" style="padding: 4px;">
                          <img src="/assets/icons/trash-bin.png" class="icon-image" style="width: 18px; height: 18px;" />
                        </a>
                      </div>
                    </div>
                    <p><strong>Employment Type:</strong> Part-Time</p>
                    <p><strong>Company:</strong> Red Cross Nepal</p>
                    <p><i class="fa fa-map-marker-alt"></i> Lalitpur, Nepal</p>
                    <div class="d-flex gap-4 mt-3 pt-3" style="border-top: 1px solid #e6eef6;">
                      <div>
                        <p class="mb-1" style="font-size: 0.85rem; color: #6B7280;">Start Date</p>
                        <p class="mb-0"><strong>03/15/2021</strong></p>
                      </div>
                      <div>
                        <p class="mb-1" style="font-size: 0.85rem; color: #6B7280;">End Date</p>
                        <p class="mb-0"><strong>03/15/2024</strong></p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-end mt-4">
              <a href="#" class="cstm-btn-style" onclick="document.getElementById('popup-license').classList.add('d-none'); return false;">
              Continue
            </a>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<div id="popup-insurance" class="popup-overlay d-none">
  <div class="popup-content shadow-lg p-3 rounded-3">
    <div class="popup-header d-flex justify-content-between align-items-center">
      <h5>Insurance</h5>
      <button class="popup-close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M6 18L18 6M6 6l12 12" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div class="popup-body">
      <section class="content">
        <div class="row">
          <div class="col-12">
            <a href="#" class="cstm-btn-style" id="openInsuranceModal">
              Add New
            </a>

            <div class="row g-3 mt-2">
              <div class="col-md-6">
                <div class="card ed-card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                      <h5 class="card-title mb-0">Everest Insurance Co.</h5>
                      <div class="d-flex gap-2">
                        <a href="#" class="edit-insurance" title="Edit" style="padding: 4px;">
                          <img src="/assets/icons/compose.png" class="icon-image" style="width: 18px; height: 18px;" />
                        </a>
                        <a href="#" onclick="return confirm('Are you sure? Do you want to remove this item?');" style="padding: 4px;">
                          <img src="/assets/icons/trash-bin.png" class="icon-image" style="width: 18px; height: 18px;" />
                        </a>
                      </div>
                    </div>
                    <p><strong>Policy Number:</strong> EVR-2023-001</p>
                    <p><strong>Amount (Per Claim/Aggregate):</strong> NPR 500,000 / NPR 2,000,000</p>
                    <p><i class="fa fa-map-marker-alt"></i> Bagmati, Kathmandu</p>
                    <div class="d-flex gap-4 mt-3 pt-3" style="border-top: 1px solid #e6eef6;">
                      <div>
                        <p class="mb-1" style="font-size: 0.85rem; color: #6B7280;">Effective Date</p>
                        <p class="mb-0"><strong>01/01/2023</strong></p>
                      </div>
                      <div>
                        <p class="mb-1" style="font-size: 0.85rem; color: #6B7280;">Expiration Date</p>
                        <p class="mb-0"><strong>12/31/2025</strong></p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="card ed-card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                      <h5 class="card-title mb-0">Himalayan General Insurance</h5>
                      <div class="d-flex gap-2">
                        <a href="#" class="edit-insurance" title="Edit" style="padding: 4px;">
                          <img src="/assets/icons/compose.png" class="icon-image" style="width: 18px; height: 18px;" />
                        </a>
                        <a href="#" onclick="return confirm('Are you sure? Do you want to remove this item?');" style="padding: 4px;">
                          <img src="/assets/icons/trash-bin.png" class="icon-image" style="width: 18px; height: 18px;" />
                        </a>
                      </div>
                    </div>
                    <p><strong>Policy Number:</strong> HGI-2022-045</p>
                    <p><strong>Amount (Per Claim/Aggregate):</strong> NPR 300,000 / NPR 1,000,000</p>
                    <p><i class="fa fa-map-marker-alt"></i> Province 1, Biratnagar</p>
                    <div class="d-flex gap-4 mt-3 pt-3" style="border-top: 1px solid #e6eef6;">
                      <div>
                        <p class="mb-1" style="font-size: 0.85rem; color: #6B7280;">Effective Date</p>
                        <p class="mb-0"><strong>06/15/2022</strong></p>
                      </div>
                      <div>
                        <p class="mb-1" style="font-size: 0.85rem; color: #6B7280;">Expiration Date</p>
                        <p class="mb-0"><strong>06/14/2024</strong></p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="d-flex justify-content-end mt-4">
              <a href="#" class="cstm-btn-style" onclick="document.getElementById('popup-insurance').classList.add('d-none'); return false;">
              Continue
            </a>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<div id="popup-health" class="popup-overlay d-none">
  <div class="popup-content shadow-lg p-3 rounded-3">
    <div class="popup-header d-flex justify-content-between align-items-center">
      <h5 class="mb-4">Health Assessment</h5>
      <button class="popup-close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M6 18L18 6M6 6l12 12" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div class="popup-body">
      <section class="content">
        <div class="row">
          <div class="col-12">
            <form method="post" action="">
              <div class="app-card app-card-notification shadow-sm mb-4" style="padding: 20px;">

                <!-- Substance Abuse Question -->
                <div class="form-group">
                  <label for="substance-abuse">Do you currently have any chemical substance abuse dependency?</label>
                  <div class="radio-group mt-2">
                    <label><input type="radio" name="substance_abuse" value="yes" onchange="toggleTextarea('substance-abuse-explanation', this.value)"> Yes</label>
                    <label><input type="radio" name="substance_abuse" value="no" checked onchange="toggleTextarea('substance-abuse-explanation', this.value)"> No</label>
                  </div>
                  <div class="mt-2">
                    <textarea id="substance-abuse-explanation" class="form-control" placeholder="If yes, please explain..."></textarea>
                  </div>
                </div>

                <!-- Job Related Question -->
                <div class="form-group mt-4">
                  <label for="job-related">Are there any reasons that would prevent you from being able to perform competently the job-related functions of a locum tenens physician?</label>
                  <div class="radio-group mt-2">
                    <label><input type="radio" name="job_related" value="yes" onchange="toggleTextarea('job-related-explanation', this.value)"> Yes</label>
                    <label><input type="radio" name="job_related" value="no" checked onchange="toggleTextarea('job-related-explanation', this.value)"> No</label>
                  </div>
                  <div class="mt-2">
                    <textarea id="job-related-explanation" class="form-control" placeholder="If yes, please explain..."></textarea>
                  </div>
                </div>

                <!-- Travel Question -->
                <div class="form-group mt-4">
                  <label for="travel">Are there any reasons that would prevent you from being able to travel and promptly assume locum tenens physician responsibilities in unfamiliar facilities?</label>
                  <div class="radio-group mt-2">
                    <label><input type="radio" name="travel" value="yes" onchange="toggleTextarea('travel-explanation', this.value)"> Yes</label>
                    <label><input type="radio" name="travel" value="no" checked onchange="toggleTextarea('travel-explanation', this.value)"> No</label>
                  </div>
                  <div class="mt-2">
                    <textarea id="travel-explanation" class="form-control" placeholder="If yes, please explain..."></textarea>
                  </div>
                </div>

              </div>

              <button type="submit" class="cstm-btn-style mr-2">Save</button>
              <button type="submit" name="save_continue" value="1" class="cstm-btn-style">Save and Continue</button>
            </form>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>

<div id="popup-risk" class="popup-overlay d-none">
  <div class="popup-content shadow-lg p-3 rounded-3">
    <div class="popup-header d-flex justify-content-between align-items-center">
      <h5 class="mb-4">Risk Assessment</h5>
      <button class="popup-close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M6 18L18 6M6 6l12 12" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div class="popup-body">
      <section class="content">
        <div class="row">
          <div class="col-12">
            <form method="post" action="">
              <div class="app-card app-card-notification shadow-sm mb-4" style="padding: 20px;">

                <!-- Work Verification -->
                <div class="form-group">
                  <label>Can you submit verification of your legal right to work in the U.S.? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="work_verification" value="yes"> Yes</label>
                    <label><input type="radio" name="work_verification" value="no"> No</label>
                  </div>
                </div>

                <hr/>

                <!-- Degree Group -->
                <div class="form-group">
                  <label for="degree">Degree Group *</label>
                  <select id="degree" name="degree" class="form-control">
                    <option value="">Select Degree Group</option>
                    <option value="MD/DO">MD/DO</option>
                    <option value="CRNA">CRNA</option>
                    <option value="CNS">CNS</option>
                    <option value="DDS">DDS</option>
                    <option value="DMD">DMD</option>
                    <option value="PA">PA</option>
                    <option value="NP">NP</option>
                    <option value="PhD">PhD</option>
                    <option value="PsyD">PsyD</option>
                    <option value="Other">Other</option>
                  </select>
                </div>

                <hr/>

                <!-- Yes/No Questions -->
                <div class="form-group">
                  <label>In the past 24 months, have you had patient contact practicing in the specialty area for which you are applying? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="patient_contact" value="yes"> Yes</label>
                    <label><input type="radio" name="patient_contact" value="no"> No</label>
                  </div>
                </div>

                <hr/>

                <div class="form-group">
                  <label>Have you ever been named in a malpractice claim? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="malpractice_claim" value="yes"> Yes</label>
                    <label><input type="radio" name="malpractice_claim" value="no"> No</label>
                  </div>
                </div>

                <hr/>

                <div class="form-group">
                  <label>Has your license to practice in your profession ever been formally investigated, sanctioned, or revoked? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="license_investigation" value="yes"> Yes</label>
                    <label><input type="radio" name="license_investigation" value="no"> No</label>
                  </div>
                </div>

                <hr/>

                <div class="form-group">
                  <label>Have you ever been denied provider participation in Medicare/Medicaid? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="medicare_denial" value="yes"> Yes</label>
                    <label><input type="radio" name="medicare_denial" value="no"> No</label>
                  </div>
                </div>

                <hr/>

                <div class="form-group">
                  <label>Have you ever resigned from a position in lieu of an investigation, or been terminated from employment? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="resigned_or_terminated" value="yes"> Yes</label>
                    <label><input type="radio" name="resigned_or_terminated" value="no"> No</label>
                  </div>
                </div>

                <hr/>

                <div class="form-group">
                  <label>Have your hospital or clinic privileges ever been revoked, suspended, or restricted? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="clinic_privileges" value="yes"> Yes</label>
                    <label><input type="radio" name="clinic_privileges" value="no"> No</label>
                  </div>
                </div>

                <hr/>

                <div class="form-group">
                  <label>Have you ever been disciplined by a hospital staff or professional education program? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="disciplinary_action" value="yes"> Yes</label>
                    <label><input type="radio" name="disciplinary_action" value="no"> No</label>
                  </div>
                </div>

                <hr/>

                <div class="form-group">
                  <label>Have you ever been convicted of a felony or misdemeanor other than a minor traffic violation? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="felony_conviction" value="yes"> Yes</label>
                    <label><input type="radio" name="felony_conviction" value="no"> No</label>
                  </div>
                </div>

                <hr/>

                <div class="form-group">
                  <label>Have you ever abused alcohol, used illegal drugs, or failed to take legally prescribed drugs? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="substance_abuse" value="yes"> Yes</label>
                    <label><input type="radio" name="substance_abuse" value="no"> No</label>
                  </div>
                </div>

                <hr/>

                <div class="form-group">
                  <label>Have you incurred or become aware of having a condition that impairs your ability to practice your medical specialty? *</label>
                  <div class="radio-group">
                    <label><input type="radio" name="medical_condition" value="yes"> Yes</label>
                    <label><input type="radio" name="medical_condition" value="no"> No</label>
                  </div>
                </div>

              </div>

              <button type="submit" class="cstm-btn-style mr-2">Save</button>
              <button type="submit" name="save_continue" value="1" class="cstm-btn-style">Save and Continue</button>
            </form>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>


<!-- Add Experience Modal -->
    <div class="modal fade" id="experienceModal" tabindex="-1" aria-labelledby="experienceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="experienceModalLabel">Add Work History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Experience Modal -->
    <div class="modal fade" id="editExperienceModal" tabindex="-1" aria-labelledby="editExperienceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editExperienceModalLabel">Edit Work History</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="editExperienceFormContainer">
                        <!-- The form will be loaded here via AJAX -->
                    </div>
                </div>
            </div>
        </div>
    </div>



{# == Upload Modal (kept as-is, using your existing form and JS) == #}
<div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <form method="POST" enctype="multipart/form-data" action="{{ path('app_provider_documents') }}">
        <div class="modal-header">
            <h5 class="modal-title" id="uploadModalLabel">Upload Document</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <label>Category</label>
            <select class="form-select" name="category" id="documentCategory" required>
            <option value="CV">CV</option>
            <option value="Work Preference">Work Preference</option>
            <option value="Insurance">Insurance</option>
            <option value="Health Assessment">Health Assessment</option>
            <option value="Risk Assessment">Risk Assessment</option>
            <option value="References">References</option>
            <option value="Documents">Documents</option>
            </select>
            <div class="mb-3">
                <label for="name" class="form-label">Document Name</label>
                <input type="text" class="form-control" name="name" id="name" required>
            </div>
            <div class="mb-3">
                <label for="fileName" class="form-label">Choose File</label>
                <input type="file" class="form-control" name="fileName" id="fileName" accept=".pdf,.docx" required>
                <small class="text-muted">Max upload size 8MB. Only PDF and DOCX allowed.</small>
            </div>
            <div class="mb-3">
                <label for="issueDate" class="form-label">Issue Date</label>
                <input type="date" class="form-control" name="issueDate" id="issueDate">
            </div>
            <div class="mb-3">
                <label for="expirationDate" class="form-label">Expiration Date</label>
                <input type="date" class="form-control" name="expirationDate" id="expirationDate">
            </div>
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Upload</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Add Education Modal -->
    <div class="modal fade" id="educationModal" tabindex="-1" aria-labelledby="educationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="educationModalLabel">Add Education & Training</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="addEducationFormContainer">
                        <!-- Form will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Education Modal -->
    <div class="modal fade" id="editEducationModal" tabindex="-1" aria-labelledby="editEducationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editEducationModalLabel">Edit Education & Training</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="editEducationFormContainer">
                        <!-- Form will be loaded here via AJAX -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add License Modal -->
    <div class="modal fade" id="licenseModal" tabindex="-1" aria-labelledby="licenseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="licenseModalLabel">Add License & Certificate</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addLicenseForm" action="#" method="POST" class="needs-validation" novalidate>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="license_name" class="form-label">License/Certificate Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="license_name" name="license[name]" required>
                                <div class="invalid-feedback">Please provide license name.</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="license_employmentType" class="form-label">Employment Type <span class="text-danger">*</span></label>
                                <select class="form-control" id="license_employmentType" name="license[employmentType]" required>
                                    <option value="">Select Type</option>
                                    <option value="Full-Time">Full-Time</option>
                                    <option value="Part-Time">Part-Time</option>
                                    <option value="Contract">Contract</option>
                                </select>
                                <div class="invalid-feedback">Please select employment type.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="license_company" class="form-label">Company <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="license_company" name="license[company]" required>
                                <div class="invalid-feedback">Please provide company name.</div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="license_location" class="form-label">Location <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="license_location" name="license[location]" placeholder="City, Country" required>
                            <div class="invalid-feedback">Please provide location.</div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="license_startDate" class="form-label">Start Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control js-datepicker" id="license_startDate" name="license[startDate]" required>
                                <div class="invalid-feedback">Please provide start date.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="license_endDate" class="form-label">End Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control js-datepicker" id="license_endDate" name="license[endDate]" required>
                                <div class="invalid-feedback">Please provide end date.</div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Insurance Modal -->
    <div class="modal fade" id="insuranceModal" tabindex="-1" aria-labelledby="insuranceModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="insuranceModalLabel">Add Insurance</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addInsuranceForm" action="#" method="POST" class="needs-validation" novalidate>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="insurance_company" class="form-label">Insurance Company <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="insurance_company" name="insurance[company]" required>
                                <div class="invalid-feedback">Please provide insurance company name.</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="insurance_policyNumber" class="form-label">Policy Number <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="insurance_policyNumber" name="insurance[policyNumber]" required>
                                <div class="invalid-feedback">Please provide policy number.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="insurance_location" class="form-label">Location <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="insurance_location" name="insurance[location]" placeholder="State, City" required>
                                <div class="invalid-feedback">Please provide location.</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="insurance_perClaim" class="form-label">Amount Per Claim <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="insurance_perClaim" name="insurance[perClaim]" placeholder="NPR 500,000" required>
                                <div class="invalid-feedback">Please provide per claim amount.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="insurance_aggregate" class="form-label">Aggregate Amount <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="insurance_aggregate" name="insurance[aggregate]" placeholder="NPR 2,000,000" required>
                                <div class="invalid-feedback">Please provide aggregate amount.</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="insurance_effectiveDate" class="form-label">Effective Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control js-datepicker" id="insurance_effectiveDate" name="insurance[effectiveDate]" required>
                                <div class="invalid-feedback">Please provide effective date.</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="insurance_expirationDate" class="form-label">Expiration Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control js-datepicker" id="insurance_expirationDate" name="insurance[expirationDate]" required>
                                <div class="invalid-feedback">Please provide expiration date.</div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{{ asset('assets/admin/js/form-validation.js') }}"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
    // Initialize flatpickr for existing date pickers
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof flatpickr !== 'undefined') {
            document.querySelectorAll('.js-datepicker').forEach(function(input) {
                if (!input._flatpickr) {
                    flatpickr(input, {
                        dateFormat: "Y-m-d"
                    });
                }
            });
        } else if (typeof $ !== 'undefined' && $.fn.flatpickr) {
    $(".js-datepicker").flatpickr();
        }
    });
</script>

<script>
    let clickedButton = null;
    // Wait for both DOM and jQuery to be ready
    if (typeof jQuery === 'undefined') {
        console.error('jQuery is not loaded');
    } else {
        jQuery(document).ready(function ($) {
        // Track which submit button was clicked
            const educationModal = $('#educationModal');
            if (educationModal.length === 0) {
                console.warn('Education modal not found');
                return;
            }
            
            educationModal.find('button[type=submit]').on('click', function () {
            clickedButton = $(this);
        });

        // Load education form when modal opens
            educationModal.on('show.bs.modal', function () {
            // Always reload the form to get fresh CSRF token
            fetch('{{ path('app_provider_education_new') }}', {
                headers: { 
                    'X-Requested-With': 'XMLHttpRequest',
                    'Accept': 'text/html'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.status);
                }
                return response.text();
            })
            .then(html => {
                // Check if response contains a form
                if (!html || html.trim().length === 0) {
                    throw new Error('Empty response from server');
                }
                
                console.log('Form HTML received:', html.substring(0, 200)); // Debug log
                
                // The form template already includes form_start and form_end, so it's a complete form
                // We just need to extract it and add the modal footer
                let formHtml = html.trim();
                
                // If the response is wrapped in a form tag, extract the inner content
                if (formHtml.includes('<form')) {
                    // Try to parse and extract form
                    const parser = new DOMParser();
                    // Wrap in a container for parsing
                    const wrappedHtml = '<div>' + formHtml + '</div>';
                    const doc = parser.parseFromString(wrappedHtml, 'text/html');
                    const form = doc.querySelector('form');
                    
                    if (form) {
                        // Get the form's inner HTML (fields) but keep the form tag
                        const formInnerHTML = form.innerHTML;
                        const formAction = form.getAttribute('action') || '{{ path('app_provider_education_new') }}';
                        const formMethod = form.getAttribute('method') || 'POST';
                        const formId = form.getAttribute('id') || 'addEducationForm';
                        const formClass = form.getAttribute('class') || 'needs-validation';
                        
                        // Replace the submit button with modal footer
                        formHtml = formInnerHTML.replace(/<button[^>]*type=["']submit["'][^>]*>[\s\S]*?<\/button>/i, '');
                        
                        $('#addEducationFormContainer').html(`
                            <form id="${formId}" action="${formAction}" method="${formMethod}" class="${formClass}" novalidate>
                                ${formHtml}
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Save</button>
                                </div>
                            </form>
                        `);
                    } else {
                        // If parsing failed, try regex extraction
                        const formMatch = formHtml.match(/<form[^>]*>([\s\S]*?)<\/form>/i);
                        if (formMatch) {
                            const formInnerHTML = formMatch[1].replace(/<button[^>]*type=["']submit["'][^>]*>[\s\S]*?<\/button>/i, '');
                            const actionMatch = formHtml.match(/action=["']([^"']+)["']/i);
                            const methodMatch = formHtml.match(/method=["']([^"']+)["']/i);
                            const idMatch = formHtml.match(/id=["']([^"']+)["']/i);
                            const classMatch = formHtml.match(/class=["']([^"']+)["']/i);
                            
                            $('#addEducationFormContainer').html(`
                                <form id="${idMatch ? idMatch[1] : 'addEducationForm'}" 
                                      action="${actionMatch ? actionMatch[1] : '{{ path('app_provider_education_new') }}'}" 
                                      method="${methodMatch ? methodMatch[1] : 'POST'}" 
                                      class="${classMatch ? classMatch[1] : 'needs-validation'}" 
                                      novalidate>
                                    ${formInnerHTML}
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-primary">Save</button>
                                    </div>
                                </form>
                            `);
                        } else {
                            // Use HTML as-is and wrap in form
                            $('#addEducationFormContainer').html(`
                                <form id="addEducationForm" action="{{ path('app_provider_education_new') }}" method="POST" class="needs-validation" novalidate>
                                    ${formHtml}
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-primary">Save</button>
                                    </div>
                                </form>
                            `);
                        }
                    }
                } else {
                    // No form tag found, wrap the content in a form
                    $('#addEducationFormContainer').html(`
                        <form id="addEducationForm" action="{{ path('app_provider_education_new') }}" method="POST" class="needs-validation" novalidate>
                            ${formHtml}
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary">Save</button>
                            </div>
                        </form>
                    `);
                }
                
                // Re-initialize flatpickr for date fields after a small delay to ensure DOM is ready
                setTimeout(function() {
                    // Check if flatpickr is available
                    if (typeof flatpickr !== 'undefined') {
                        // Use native flatpickr API
                        document.querySelectorAll('#addEducationFormContainer .js-datepicker').forEach(function(input) {
                            if (!input._flatpickr) { // Only initialize if not already initialized
                                flatpickr(input, {
                                    dateFormat: "Y-m-d"
                                });
                            }
                        });
                    } else if (typeof $ !== 'undefined' && $.fn.flatpickr) {
                        // Fallback to jQuery plugin if available
                        $('#addEducationFormContainer .js-datepicker').flatpickr();
                    }
                }, 100);
            })
            .catch(error => {
                console.error('Error loading form:', error);
                $('#addEducationFormContainer').html(`<div class="alert alert-danger">Error loading form: ${error.message}. Please refresh the page and try again.</div>`);
            });
        });

        // Handle form submission with event delegation
        $(document).on('submit', '#educationModal form', function (e) {
                e.preventDefault();
            var formElement = $(this)[0];
            var form = $(this);
            
            // Validate dates
            var startDateVal = $('#education_startDate').val();
            var endDateVal = $('#education_endDate').val();
            if (startDateVal && endDateVal) {
                var startDate = new Date(startDateVal);
                var endDate = new Date(endDateVal);
                if (endDate < startDate) {
                    showErrorAlert('Invalid Date', 'End date must be after start date.');
                    formElement.classList.add('was-validated');
                    return false;
                }
            }
            
            // Client-side validation
            if (!formElement.checkValidity()) {
                e.stopPropagation();
                formElement.classList.add('was-validated');
                return false;
            }

            // Show alert instead of submitting
            showInfoAlert('Notice', 'Backend route implementation pending.');
            return false;

            // Show loading state
            var submitBtn = form.find('button[type="submit"]');
            var originalText = submitBtn.html();
            submitBtn.prop('disabled', true).html('<span class="spinner-border spinner-border-sm me-2"></span>Saving...');

            var formData = form.serialize();
            
            $.ajax({
                type: 'POST',
                url: form.attr('action'),
                data: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function (response) {
                    // Check if response is JSON (success) or HTML (form with errors)
                    if (typeof response === 'object' && response.status === 'success') {
                    $('#educationModal').modal('hide');
                        location.reload();
                    } else if (typeof response === 'string') {
                        // Try to parse as JSON first
                        try {
                            var jsonResponse = JSON.parse(response);
                        if (jsonResponse.status === 'success') {
                            $('#educationModal').modal('hide');
                            // Refresh education list instead of reloading page
                            loadEducationList();
                    } else {
                                // Show form with errors
                                $('#addEducationFormContainer').html(response);
                                setTimeout(function() {
                                    if (typeof flatpickr !== 'undefined') {
                                        document.querySelectorAll('#addEducationFormContainer .js-datepicker').forEach(function(input) {
                                            if (!input._flatpickr) {
                                                flatpickr(input, { dateFormat: "Y-m-d" });
                                            }
                                        });
                                    }
                                }, 100);
                                submitBtn.prop('disabled', false).html(originalText);
                            }
                        } catch (e) {
                            // If it's HTML, it might be a form with errors
                            if (response.includes('<form') || response.includes('form')) {
                                $('#addEducationFormContainer').html(response);
                                setTimeout(function() {
                                    if (typeof flatpickr !== 'undefined') {
                                        document.querySelectorAll('#addEducationFormContainer .js-datepicker').forEach(function(input) {
                                            if (!input._flatpickr) {
                                                flatpickr(input, { dateFormat: "Y-m-d" });
                                            }
                                        });
                                    }
                                }, 100);
                                submitBtn.prop('disabled', false).html(originalText);
                            } else {
                                // Success - refresh education list
                                $('#educationModal').modal('hide');
                                loadEducationList();
                            }
                        }
                    } else {
                        // Success - refresh education list
                        $('#educationModal').modal('hide');
                        loadEducationList();
                    }
                },
                error: function (xhr) {
                    submitBtn.prop('disabled', false).html(originalText);
                    
                    if (xhr.status === 422 || xhr.status === 400) {
                        // Try to extract error message from response
                        try {
                            var errorData = JSON.parse(xhr.responseText);
                            showErrorAlert('Validation Error', errorData.message || "Validation error. Please check all required fields.");
                        } catch (e) {
                            // If response is HTML with form errors, display it
                            if (xhr.responseText && (xhr.responseText.includes('<form') || xhr.responseText.includes('form'))) {
                                $('#addEducationFormContainer').html(xhr.responseText);
                                setTimeout(function() {
                                    if (typeof flatpickr !== 'undefined') {
                                        document.querySelectorAll('#addEducationFormContainer .js-datepicker').forEach(function(input) {
                                            if (!input._flatpickr) {
                                                flatpickr(input, { dateFormat: "Y-m-d" });
                                            }
                                        });
                                    }
                                }, 100);
                            } else {
                                showErrorAlert('Validation Error', "Validation error. Please check all required fields and ensure end date is after start date.");
                            }
                        }
                    } else {
                        showErrorAlert('Save Error', "Error occurred while saving. Please try again.");
                    }
                }
    });

        // License form submission
            const licenseModal = $('#licenseModal');
            if (licenseModal.length > 0) {
                licenseModal.find('form').on('submit', function (e) {
            var formElement = $(this)[0];
            if (!formElement.checkValidity()) {
                e.preventDefault();
                e.stopPropagation();
                formElement.classList.add('was-validated');
                return false;
            }

            e.preventDefault();
            showInfoAlert('Notice', 'License form submission - backend route implementation pending.');
                    licenseModal.modal('hide');
        });
            }

        // Insurance form submission
            const insuranceModal = $('#insuranceModal');
            if (insuranceModal.length > 0) {
                insuranceModal.find('form').on('submit', function (e) {
            var formElement = $(this)[0];
            if (!formElement.checkValidity()) {
                e.preventDefault();
                e.stopPropagation();
                formElement.classList.add('was-validated');
                return false;
            }

            e.preventDefault();
            showInfoAlert('Notice', 'Insurance form submission - backend route implementation pending.');
                    insuranceModal.modal('hide');
        });
            }
    });
    }

    // Handle edit education buttons with event delegation
    if (typeof jQuery !== 'undefined') {
        jQuery(document).ready(function($) {
    $(document).on('click', '.edit-education', function(event) {
        event.preventDefault();
        let educationId = this.dataset.id;
      
      if (!educationId) {
        showErrorAlert('Error', 'Education ID not found. Please refresh the page.');
        return;
      }

        fetch(`/provider/application/education/${educationId}/edit`, {
          headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
          .then(response => response.json())
          .then(data => {
          if (data.form) {
            document.getElementById('editEducationFormContainer').innerHTML = data.form;

            // Re-initialize flatpickr for dynamically added date fields
            setTimeout(function() {
              if (typeof flatpickr !== 'undefined') {
                document.querySelectorAll('#editEducationFormContainer .js-datepicker').forEach(function(input) {
                  if (!input._flatpickr) {
                    flatpickr(input, { dateFormat: "Y-m-d" });
                  }
                });
              }
            }, 100);

            // Show the modal after content is loaded
            const modal = new bootstrap.Modal(document.getElementById('editEducationModal'));
            modal.show();
          } else {
            showErrorAlert('Error', 'Error loading edit form. Please try again.');
          }
        })
        .catch(error => {
          console.error('Error loading form:', error);
          showErrorAlert('Error', 'Error loading edit form. Please try again.');
        });
    });

    // Handle edit form submission to refresh list
    $(document).on('submit', '#editEducationModal form', function(e) {
      e.preventDefault();
      var form = $(this);
      var formData = form.serialize();
      
      $.ajax({
        type: 'POST',
        url: form.attr('action'),
        data: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        },
        success: function(response) {
          try {
            var jsonResponse = typeof response === 'string' ? JSON.parse(response) : response;
            if (jsonResponse.status === 'success') {
              $('#editEducationModal').modal('hide');
              loadEducationList();
            }
          } catch(e) {
            $('#editEducationModal').modal('hide');
            loadEducationList();
          }
        },
        error: function() {
          showErrorAlert('Update Error', 'Error updating education. Please try again.');
        }
      });
    });

    // Handle delete education
    $(document).on('click', '.delete-education', function(e) {
      e.preventDefault();
      if (!confirm('Are you sure? Do you want to remove this item?')) {
        return;
      }
      
      var educationId = $(this).data('id');
      if (!educationId) return;
      
      fetch(`/provider/application/education/${educationId}/delete`, {
        method: 'GET',
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      .then(response => {
        if (response.ok) {
          loadEducationList();
        } else {
          showErrorAlert('Delete Error', 'Error deleting education entry. Please try again.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showErrorAlert('Delete Error', 'Error deleting education entry. Please try again.');
      });
    });
        });
    }
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const openAddEducationModal = document.getElementById('openAddEducationModal');
  if (openAddEducationModal) {
    openAddEducationModal.addEventListener('click', function (e) {
  e.preventDefault();
  const modal = new bootstrap.Modal(document.getElementById('educationModal'));
  modal.show();
});
  }

// License Modal
  const openLicenseModal = document.getElementById('openLicenseModal');
  if (openLicenseModal) {
    openLicenseModal.addEventListener('click', function (e) {
  e.preventDefault();
  const modal = new bootstrap.Modal(document.getElementById('licenseModal'));
  modal.show();
});
  }

// Insurance Modal
  const openInsuranceModal = document.getElementById('openInsuranceModal');
  if (openInsuranceModal) {
    openInsuranceModal.addEventListener('click', function (e) {
  e.preventDefault();
  const modal = new bootstrap.Modal(document.getElementById('insuranceModal'));
  modal.show();
    });
  }
});
</script>

{# == JS: keep setCategory and upload handler; remove previous toggle hide/show code == #}
<script>
function setCategory(label) {
    const map = {
        'CV Upload': 'CV',
        'Work Preference': 'Work Preference',
        'Insurance': 'Insurance',
        'Health Assessment': 'Health Assessment',
        'Risk Assessment': 'Risk Assessment',
        'References': 'References',
        'Documents': 'Documents'
    };
    document.getElementById('documentCategory').value = map[label] || 'Documents';
}

/* Upload handler preserved */
document.addEventListener('DOMContentLoaded', function () {
  const form = document.querySelector('#uploadModal form');

  form.addEventListener('submit', function (e) {
    e.preventDefault();

    if (!confirm('Are you sure you want to upload this document?')) return;

    const formData = new FormData(form);

    fetch(form.action, {
      method: 'POST',
      body: formData,
    })
    .then(response => {
      if (!response.ok) throw new Error('Upload failed');
      return response.text();
    })
    .then(() => {
      showSuccessAlert('Upload Success', 'Document has been successfully uploaded.');
      const modalEl = document.getElementById('uploadModal');
      const modal = bootstrap.Modal.getInstance(modalEl) || bootstrap.Modal.getOrCreateInstance(modalEl);
      modal.hide();
      form.reset();
    })
    .catch(error => {
      showErrorAlert('Upload Error', 'Something went wrong: ' + error.message);
    });
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  // Make all dropzones clickable
  document.querySelectorAll('.upload-dropzone').forEach(function(dropzone) {
    const input = dropzone.querySelector('input[type="file"]') || document.getElementById('dropzoneInput');

  if (dropzone && input) {
      // Remove any existing click handlers
      dropzone.onclick = null;
      
      // Add click handler to open file picker
      dropzone.addEventListener('click', function (e) {
        // Don't trigger if clicking on the remove button or badge
        if (e.target.closest('.file-badge') || e.target.closest('.file-remove-btn')) {
          return;
        }
        e.preventDefault();
        e.stopPropagation();
        if (input) {
      input.click();
        }
      });
      
      // Also handle drag and drop
      dropzone.addEventListener('dragover', function(e) {
        e.preventDefault();
        e.stopPropagation();
        dropzone.style.background = '#e8f4e8';
      });
      
      dropzone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        e.stopPropagation();
        dropzone.style.background = '#F4F9F1';
      });
      
      dropzone.addEventListener('drop', function(e) {
        e.preventDefault();
        e.stopPropagation();
        dropzone.style.background = '#F4F9F1';
        
        if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
          input.files = e.dataTransfer.files;
          handleFileChange(input);
        }
      });
    }
  });
});

function handleFileChange(input) {
  const badge = document.getElementById('fileBadge');
  const nameText = document.getElementById('fileNameText');

  if (input && input.files && input.files.length > 0) {
    if (nameText) nameText.textContent = input.files[0].name;
    if (badge) badge.style.display = 'flex';
  } else {
    if (badge) badge.style.display = 'none';
  }
}

function clearFile() {
  const input = document.getElementById('dropzoneInput');
  const badge = document.getElementById('fileBadge');

  if (input) {
    input.value = '';
    // Trigger change event to update UI
    const event = new Event('change', { bubbles: true });
    input.dispatchEvent(event);
  }
  if (badge) badge.style.display = 'none';
}
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toggleCheckmarks = document.getElementById('toggle-checkmarks');
    if (toggleCheckmarks) {
      toggleCheckmarks.addEventListener('click', function () {
    document.querySelectorAll('.upload-check').forEach(checkbox => {
      checkbox.classList.toggle('d-none');
    });
      });
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
  const infoView = document.getElementById('infoView');
  const infoEdit = document.getElementById('infoEdit');
  const cancelBtn = document.getElementById('cancelBtn');
  const imageInput = document.getElementById('profileImageInput');
  const imagePreview = document.getElementById('editProfileImage');
    const actionIcons = document.getElementById('actionIcons');

    if (!infoView || !infoEdit) {
      console.warn('Profile edit elements not found');
      return;
    }

  let originalData = {};

  // Store original values
  document.querySelectorAll('#infoEdit input, #infoEdit select, #infoEdit textarea').forEach(el => {
    originalData[el.name] = el.value;
  });

    // Edit toggle logic - maintain layout position without moving flexbox
    function switchToEditMode(e) {
      if (e) e.preventDefault();
      if (!infoView || !infoEdit) return;
      // Hide view, show edit in same position
      const viewHeight = infoView.offsetHeight;
      infoView.style.visibility = 'hidden';
      infoView.style.opacity = '0';
      infoView.style.height = viewHeight + 'px';
      infoView.style.overflow = 'hidden';
      
      infoEdit.style.display = 'block';
      infoEdit.style.visibility = 'visible';
      infoEdit.style.opacity = '1';
      infoEdit.style.height = 'auto';
    }

    // Function to switch back to view mode
    function switchToViewMode() {
      if (!infoView || !infoEdit) return;
      // Hide edit, show view
    infoEdit.style.display = 'none';
    infoEdit.style.visibility = 'hidden';
    infoEdit.style.opacity = '0';
    
    infoView.style.display = 'block';
    infoView.style.visibility = 'visible';
    infoView.style.opacity = '1';
    infoView.style.height = 'auto';
    infoView.style.overflow = 'visible';

      // Restore edit button
      if (actionIcons) {
        actionIcons.innerHTML = `
      <a href="javascript:void(0);" id="editToggle" class="link-plain" title="Edit">
        <svg width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentColor"
             stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 20h9"></path>
          <path d="M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
        </svg>
      </a>
    `;
      }
    }

    // Use event delegation on actionIcons container to handle clicks on editToggle
    // This way we don't need to re-attach listeners when HTML is replaced
    if (actionIcons) {
      actionIcons.addEventListener('click', function(e) {
        if (e.target.closest('#editToggle')) {
          switchToEditMode(e);
        }
      });
    }

    // Cancel button logic - maintain layout position
    if (cancelBtn) {
      cancelBtn.addEventListener('click', () => {
        document.querySelectorAll('#infoEdit input, #infoEdit select, #infoEdit textarea').forEach(el => {
          el.value = originalData[el.name] || '';
        });
        
        // Restore view mode
        switchToViewMode();
      });
    }

  // Image preview logic
    if (imageInput) {
      imageInput.addEventListener('change', function () {
    const file = this.files[0];
    if (file && file.type.startsWith('image/')) {
      // Validate file size (8MB max)
      if (file.size > 8 * 1024 * 1024) {
        showErrorAlert('File Size Error', 'Image size must be less than 8MB');
        this.value = '';
        return;
      }
      
      // Validate file type
      const validTypes = ['image/png', 'image/jpg', 'image/jpeg'];
      if (!validTypes.includes(file.type)) {
        showErrorAlert('Invalid File Type', 'Please upload a valid image file (PNG, JPG, or JPEG)');
        this.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function (e) {
        // Update edit mode preview
        if (imagePreview) {
        imagePreview.src = e.target.result;
        }
        // Also update view mode preview if visible
        const viewModeImage = document.querySelector('#infoView .profile-icon-box img');
        if (viewModeImage) {
          viewModeImage.src = e.target.result;
        }
      };
      reader.readAsDataURL(file);
    } else if (file) {
      showErrorAlert('No File Selected', 'Please select a valid image file');
      this.value = '';
    }
  });
  }

  // Handle form submission
  const profileForm = document.getElementById('profileForm');
  if (profileForm) {
    profileForm.addEventListener('submit', function(e) {
      // Validate form
      if (!profileForm.checkValidity()) {
        e.preventDefault();
        profileForm.classList.add('was-validated');
        return false;
      }
      
      // Show loading state
      const saveBtn = document.getElementById('saveBtn');
      if (saveBtn) {
        const originalBtnText = saveBtn.innerHTML;
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<span>Saving...</span>';
      }
      
      // Let the form submit normally - it will redirect after save
      // The page will reload and show updated data
    });
  }
  });
</script>
<script>
  // Function to load education list
  function loadEducationList() {
    const container = document.getElementById('educationListContainer');
    if (!container) return;
    
    fetch('{{ path('app_provider_education_list') }}', {
      headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(response => response.text())
    .then(html => {
      container.innerHTML = html;
    })
    .catch(error => {
      console.error('Error loading education list:', error);
      container.innerHTML = '<div class="col-12"><p class="text-danger">Error loading education entries. Please refresh the page.</p></div>';
    });
  }

  // Open popup based on data-popup attribute
  document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.open-popup').forEach(button => {
    button.addEventListener('click', function (e) {
      e.preventDefault();
      const popupId = this.dataset.popup;
      const popup = document.getElementById(`popup-${popupId}`);
      if (popup) {
        popup.classList.remove('d-none');
        // Load education list when education popup opens
        if (popupId === 'education') {
          loadEducationList();
        }
      }
    });
  });

  // Close popup for any .popup-close button
  document.querySelectorAll('.popup-close').forEach(closeBtn => {
    closeBtn.addEventListener('click', function () {
        const overlay = this.closest('.popup-overlay');
        if (overlay) {
          overlay.classList.add('d-none');
        }
      });
    });
  });
</script>
<script>
  function toggleTextarea(id, value) {
    const textarea = document.getElementById(id);
    if (textarea) {
      textarea.style.display = value === 'yes' ? 'block' : 'none';
      if (value === 'no') textarea.value = '';
    }
  }

  // Initialize all explanation fields as hidden if "No" is selected
  document.addEventListener('DOMContentLoaded', () => {
    ['substance-abuse-explanation', 'job-related-explanation', 'travel-explanation'].forEach(id => {
      const textarea = document.getElementById(id);
      if (textarea) textarea.style.display = 'none';
    });
  });
</script>

<!-- JS Preview for Profile Picture -->
<script>
    const input = document.getElementById('profileImageInput');
    const img = document.getElementById('editProfileImage');

    input.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                img.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    });

    function handleFileChange(input) {
    const file = input.files[0];
    if (!file) return;

    document.getElementById('fileBadge').style.display = 'inline-flex';
    document.getElementById('fileNameText').textContent = file.name;
}

function clearFile() {
    const input = document.getElementById('dropzoneInput');
    input.value = '';
    document.getElementById('fileBadge').style.display = 'none';
}

</script>



{% endblock %}