{% extends 'provider/base.html.twig' %}

{% block title %}Matching Jobs{% endblock %}

{% block provider_body %}
<style>
/* COMPLETE RESET - Remove ALL conflicting styles and apply clean spacing to match dashboard */

/* Reset app-wrapper - remove all custom.css overrides */
body.app .app-wrapper,
.app-wrapper {
    display: block !important;
    justify-content: unset !important;
    align-items: unset !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
}

/* Shift app-wrapper to the left to eliminate gap */
@media (min-width: 1200px) {
    body.app .app-wrapper,
    .app-wrapper {
        margin-left: 250px !important;
        transform: translateX(-150px) !important;
        width: calc(100% - 250px + 150px) !important;
    }
}

/* Reset app-content - remove all custom.css overrides */
body.app .app-wrapper .app-content,
.app-wrapper .app-content,
.app-content {
    padding-left: 0 !important;
    padding-right: 0 !important;
    padding-top: 20px !important;
    padding-bottom: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    position: relative !important;
    box-sizing: border-box !important;
}

/* Override custom.css width constraints at 1200px breakpoint */
@media (min-width: 1200px) {
    body.app .app-wrapper .app-content,
    .app-wrapper .app-content,
    .app-content {
        width: 100% !important;
        max-width: 100% !important;
    }
}

/* Reset container-xl - apply clean spacing matching dashboard */
body.app .app-wrapper .app-content .container-xl,
.app-wrapper .app-content .container-xl,
.app-content .container-xl,
body .app-content .container-xl,
div.container-xl,
[class*="container-xl"],
.container-xl {
    position: relative !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0 !important;
    padding-right: 30px !important;
    max-width: 100% !important;
    width: 100% !important;
    transform: none !important;
    box-sizing: border-box !important;
}

/* Override ALL media queries from custom.css */
@media (min-width: 576px) {
    body.app .app-wrapper .app-content .container-xl,
    .app-wrapper .app-content .container-xl,
    .app-content .container-xl,
    body .app-content .container-xl,
    div.container-xl,
    [class*="container-xl"],
    .container-xl {
        padding-left: 0 !important;
        padding-right: 30px !important;
    }
}

@media (min-width: 992px) {
    body.app .app-wrapper .app-content .container-xl,
    .app-wrapper .app-content .container-xl,
    .app-content .container-xl,
    body .app-content .container-xl,
    div.container-xl,
    [class*="container-xl"],
    .container-xl {
        padding-left: 0 !important;
        padding-right: 30px !important;
    }
}

@media (min-width: 1200px) {
    body.app .app-wrapper {
        position: relative !important;
        margin-left: 250px !important;
        transform: translateX(-150px) !important;
        width: calc(100% - 250px + 150px) !important;
    }
    
    body.app .app-wrapper .app-content,
    .app-wrapper .app-content,
    .app-content {
        position: relative !important;
        max-width: 100% !important;
        width: 100% !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
    }
    
    body.app .app-wrapper .app-content .container-xl,
    .app-wrapper .app-content .container-xl,
    .app-content .container-xl,
    body .app-content .container-xl,
    div.container-xl,
    [class*="container-xl"],
    .container-xl {
        position: relative !important;
        padding-left: 0 !important;
        padding-right: 30px !important;
        max-width: 100% !important;
        width: 100% !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
}

@media (min-width: 1600px) {
    body.app .app-wrapper .app-content,
    .app-wrapper .app-content,
    .app-content {
        max-width: 100% !important;
        width: 100% !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
    
    body.app .app-wrapper .app-content .container-xl,
    .app-wrapper .app-content .container-xl,
    .app-content .container-xl,
    body .app-content .container-xl,
    div.container-xl,
    [class*="container-xl"],
    .container-xl {
        padding-left: 0 !important;
        padding-right: 30px !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
}

.job-header, .job-row {
    display: flex;
    align-items: center;
}

.col-job,
.col-location,
.col-schedule,
.col-expiry,
.col-start,
.col-action {
    flex: 1;
    min-width: 130px;
}
.col-job {
    flex: 2;
}
.job-header {
    padding: 0;
    color: #121C0C;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    border: 1px solid #e6eef6;
    min-height: 48px;
    height: 48px;
    margin-bottom: 2px;
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.01em;
    line-height: 1.5;
    background: #F8FAF9;
    border-bottom: 2px solid #e6eef6;
}

.job-header > div {
    padding: 12px 8px;
    display: flex;
    align-items: center;
    box-sizing: border-box;
    height: 48px;
}

.job-row {
    border: none;
    padding: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 2px 0;
    font-size: 13px;
    font-weight: 400;
    color: #1a1a1a;
    line-height: 1.5;
    border-radius: 10px;
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    transition: background-color 0.2s ease;
}

.job-row:hover {
    background-color: #F8FAF9;
}

.job-row > div {
    padding: 12px 8px;
    display: flex;
    align-items: center;
    box-sizing: border-box;
    height: 48px;
}
.truncate-text {
    display: inline-block;
    max-width: 180px; /* Adjust as needed */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
}
.job-section {
    background-color: #fff;
}
/* Consistent rounded-square style for all job list checkboxes */
.job-list-container input[type="checkbox"].job-check,
.split-job-list input[type="checkbox"].job-checkbox {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border: 1px solid #cfd9e3;
  border-radius: 4px;
  background: #fff;
  cursor: pointer;
  position: relative;
  display: inline-block;
  vertical-align: middle;
  margin: 0;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

/* Hover state - green border */
.job-list-container input[type="checkbox"].job-check:hover,
.split-job-list input[type="checkbox"].job-checkbox:hover {
  border-color: #85BB65;
}

/* Checked state - green filled with white checkmark */
.job-list-container input[type="checkbox"].job-check:checked,
.split-job-list input[type="checkbox"].job-checkbox:checked {
  background-color: #85BB65;
  border-color: #85BB65;
}

.job-list-container input[type="checkbox"].job-check:checked::after,
.split-job-list input[type="checkbox"].job-checkbox:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 6px;
  width: 4px;
  height: 8px;
  border: solid #fff;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

/* Remove previous scale that distorted shape */
.job-check { transform: none; margin-right: 8px; }
#toggleActions {
    padding: 6px 16px;
    border-radius: 18px;
    border: 1px solid #ddd;
    font-size: 16px;
    color: #fff;
}
.job-meta {
    margin-top: 1px;
}
.ml-15-px {
    margin-left: 15px;
}
.mr-15-px {
    margin-right: 15px;
}
.action-btn {
    background: transparent;
    border: none;
    padding: 0 4px;
}

.custom-dropdown {
  position: absolute;
  top: 110%;
  left: 0;
  background: #fff;
  padding: 10px;
  min-width: 150px;
  z-index: 1000;
  border: 1px solid #e6eef6;
  box-shadow: 0 2px 6px rgba(11,22,40,0.03);
  border-radius: 10px;
}

.hidden {
  display: none;
}

.columns-panel label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
  cursor: pointer;
  font-weight: 400;
  color: #121C0C;
}

.menu-panel .menu-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 0;
  cursor: pointer;
  color: #121C0C;
}

.menu-panel svg {
  width: 16px;
  height: 16px;
}

.dropdown-cstm {
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    padding: 4px 12px;
}

.menu-panel {
    min-width: 160px;
}

.columns-panel input[type="checkbox"] {
  appearance: none;
  width: 16px;
  height: 16px;
  border: 1px solid #cfd9e3;
  border-radius: 4px;
  background-color: #fff;
  cursor: pointer;
  position: relative;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.columns-panel input[type="checkbox"]:hover {
  border-color: #85BB65;
}

.columns-panel input[type="checkbox"]:checked {
  background-color: #85BB65;
  border-color: #85BB65;
}

.columns-panel input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 5px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.col-check input[type="checkbox"] {
  appearance: none;
  width: 16px;
  height: 16px;
  border: 1px solid #cfd9e3;
  border-radius: 4px;
  background-color: #fff;
  cursor: pointer;
  position: relative;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.col-check input[type="checkbox"]:hover {
  border-color: #85BB65;
}

.col-check input[type="checkbox"]:checked {
  background-color: #85BB65;
  border-color: #85BB65;
}

.col-check input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 5px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.job-title {
    color: #121C0C;
}

.action-btn {
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    padding: 4px 12px;
    display: flex;
    gap: 6px;
    align-items: center;
}
.action-btn, ..dropdown-cstm {
    transition: all 0.2s ease;
}
.action-btn:hover, .dropdown-cstm:hover {
    color: #85BB65;
    border: 1px solid #85BB65;
    transition: all 0.2s ease;
}
.action-btn:hover svg {
    color: #85BB65;
}
#delete-btn:hover {
    color: #BA1824;
    border: 1px solid #BA1824;
    transition: all 0.2s ease; 
}
#delete-btn:hover svg {
    color: #BA1824;
}
.col-center {
    text-align: center;
}
.actions-container {
    margin-top: 20px;
    margin-bottom: 12px;
    padding-left: 15px;
    padding-right: 15px;
}
.sort-toggle {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  line-height: 1;
  gap: 2px;
  margin-left: 6px;
  vertical-align: middle;
  position: relative;
  top: 1px;
}
.sort-toggle svg { width: 10px; height: 10px; }
.sort-toggle .arrow { opacity: 0.35; transition: opacity 0.15s ease; }
.sort-toggle .arrow.active { opacity: 1; }
</style>
<div class="container-xl">
    <div class="job-section shadow-lg p-3 rounded-3">
        <div class="d-flex justify-content-between align-items-center ml-15-px" style="margin-bottom:30px;">
            <h6 class="app-card-title mb-0">Matching Jobs</h6>
        </div>

        <div class="actions-container d-flex justify-content-between align-items-center ml-15-px mr-15-px">
            <div class="job-actions" style="display: flex; gap: 8px; align-items: center;">
              <div class="position-relative" style="flex-shrink: 0;">
                <button id="filter-btn" class="action-btn" title="Filter">
                  <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 7H21M7 12H17M10 17H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Filter
                </button>
                <div id="filter-panel" class="filter-panel custom-dropdown hidden" style="position: absolute; top: 100%; left: 0; margin-top: 8px; min-width: 280px; z-index: 1000;">
                  <div style="padding: 16px;">
                    <h6 style="margin-bottom: 12px; font-weight: 600; color: #121C0C;">Filter Jobs</h6>
                    
                    <!-- Location Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Location</label>
                      <input type="text" id="filter-location" class="form-control" placeholder="Enter location" style="font-size: 13px; padding: 6px 10px;">
                    </div>
                    
                    <!-- Salary Range Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Salary Range</label>
                      <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" id="filter-salary-min" class="form-control" placeholder="Min" style="font-size: 13px; padding: 6px 10px; flex: 1;">
                        <span style="color: #6b7280;">-</span>
                        <input type="number" id="filter-salary-max" class="form-control" placeholder="Max" style="font-size: 13px; padding: 6px 10px; flex: 1;">
                      </div>
                    </div>
                    
                    <!-- Category Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Category</label>
                      <select id="filter-category" class="form-control" style="font-size: 13px; padding: 6px 10px;">
                        <option value="">All Categories</option>
                        <option value="locums">Locums</option>
                        <option value="parttime">Parttime</option>
                        <option value="fulltime">Full time</option>
                      </select>
                    </div>
                    
                    <!-- Date Posted Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Posted Within</label>
                      <select id="filter-date-posted" class="form-control" style="font-size: 13px; padding: 6px 10px;">
                        <option value="">Any time</option>
                        <option value="1">Last 24 hours</option>
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                        <option value="90">Last 3 months</option>
                      </select>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 8px; margin-top: 16px;">
                      <button id="apply-filter-btn" class="action-btn" style="flex: 1; padding: 8px 12px; font-size: 13px;">Apply</button>
                      <button id="clear-filter-btn" class="action-btn" style="flex: 1; padding: 8px 12px; font-size: 13px; background: #f3f4f6; color: #6b7280;">Clear</button>
                    </div>
                  </div>
                </div>
              </div>
              <button id="apply-btn" class="action-btn" disabled title="Apply" style="display: none;">
                <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <g data-name="Layer 2">
                <g data-name="checkmark-circle">
                <rect width="24" height="24" opacity="0"/>
                <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                </g>
                </g>
                <use xlink:href="#icon-apply"/>
                </svg> Apply
              </button>
              <div class="hidden-buttons d-flex" style="gap:8px; align-items:cneter; visibility: hidden;">
                <button id="save-btn" class="action-btn" title="Save">
                    <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 8C6 5.18536 8 4 12 4C16 4 18 5.18537 18 8V19.0858C18 19.9767 16.9229 20.4229 16.2929 19.7929L12.7071 16.2071C12.3166 15.8166 11.6834 15.8166 11.2929 16.2071L7.70711 19.7929C7.07714 20.4229 6 19.9767 6 19.0858V8Z" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <use xlink:href="#icon-save"/>
                    </svg> Save
                  </button>
                  <button id="email-btn" class="action-btn" title="Email">
                    <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="style=stroke">
                    <g id="email">
                    <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="currentColor"></path>
                    <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="currentcolor"></path>
                    </g>
                    </g>
                    <use xlink:href="#icon-email"/>
                    </svg> Email
                  </button>
                  <button id="delete-btn" class="action-btn" title="Delete">
                    <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9.17065 4C9.58249 2.83481 10.6937 2 11.9999 2C13.3062 2 14.4174 2.83481 14.8292 4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M20.5 6H3.49988" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5M18.8334 8.5L18.6334 11.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M9.5 11L10 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M14.5 11L14 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <use xlink:href="#icon-delete"/>
                    </svg> Delete
                  </button>
              </div>
              {#<a href="{{ path('app_provider_profile_work_preferences') }}" class="action-btn">
                    <svg class="icon-image" fill="currentcolor" height="25" width="25" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                         viewBox="0 0 423.469 423.469" xml:space="preserve">
                    <path d="M422.197,211.735l-38.408-66.526c-1.697-2.939-4.833-4.75-8.228-4.75c-3.394,0-6.53,1.811-8.228,4.75l-38.409,66.526
                        c-1.696,2.939-1.696,6.561,0,9.5c1.697,2.939,4.833,4.75,8.228,4.75h9.465c-3.315,34.18-18.505,65.846-43.376,90.024
                        c-7.246,7.044-15.11,13.238-23.459,18.55v-11.706c0-29.462-16.446-55.151-40.638-68.38c24.193-13.228,40.641-38.919,40.641-68.381
                        c0-42.943-34.937-77.88-77.88-77.88s-77.88,34.937-77.88,77.88c0,29.445,16.428,55.121,40.597,68.356
                        c-6.454,3.529-12.445,7.99-17.787,13.337c-14.711,14.711-22.813,34.268-22.813,55.068v11.619
                        c-40.56-25.828-67.523-71.192-67.523-122.738c0-80.177,65.229-145.406,145.407-145.406c38.84,0,75.354,15.125,102.818,42.589
                        c3.711,3.71,9.725,3.71,13.436,0c3.71-3.71,3.71-9.725,0-13.435c-31.053-31.052-72.34-48.154-116.254-48.154
                        c-90.654,0-164.407,73.752-164.407,164.406s73.752,164.407,164.407,164.407c43.036,0,83.729-16.517,114.58-46.509
                        c30.786-29.928,48.452-70.009,49.744-112.861c0.077-2.568-0.889-5.058-2.678-6.902c-1.789-1.844-4.249-2.885-6.818-2.885h-3.126
                        l21.954-38.026l21.954,38.026h-3.266c-5.157,0-9.372,4.114-9.497,9.27c-1.161,47.899-20.697,92.75-55.009,126.289
                        c-34.369,33.594-79.77,52.095-127.839,52.095C101.051,394.639,19,312.589,19,211.734S101.051,28.83,201.905,28.83
                        c48.855,0,94.787,19.025,129.333,53.572c3.71,3.709,9.724,3.71,13.436,0c3.71-3.71,3.71-9.725,0-13.435
                        C306.539,30.832,255.835,9.83,201.905,9.83C90.574,9.83,0,100.404,0,211.734s90.574,201.905,201.905,201.905
                        c53.063,0,103.18-20.424,141.12-57.508c35.653-34.851,56.854-80.768,60.288-130.146h10.656c3.394,0,6.53-1.811,8.228-4.75
                        C423.893,218.296,423.893,214.675,422.197,211.735z M143.025,186.092c0-32.467,26.414-58.88,58.88-58.88
                        c32.467,0,58.88,26.413,58.88,58.88s-26.413,58.88-58.88,58.88C169.438,244.972,143.025,218.559,143.025,186.092z M143.021,344.672
                        v-21.818c0-15.725,6.125-30.51,17.25-41.635c11.112-11.121,25.896-17.245,41.63-17.245c32.467,0,58.88,26.414,58.88,58.88v21.89
                        c-18.322,8.118-38.294,12.398-58.877,12.398C180.956,357.141,161.032,352.681,143.021,344.672z"/>
                    </svg>
                </a>#}
            </div>
            <div class="col-dropdowns d-flex gap-2">
              <!-- Menu Dropdown -->
              <div class="menu-dropdown position-relative">
                <button type="button" class="menu-dropdown-btn dropdown-cstm"><span>Menu</span></button>
                <div class="dropdown-panel menu-panel custom-dropdown hidden">
                  <a href="{{ path('app_provider_jobs_archived') }}" class="menu-item" style="text-decoration: none; color: inherit;"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path opacity="0.5" d="M20.5 7V13C20.5 16.7712 20.5 18.6569 19.3284 19.8284C18.1569 21 16.2712 21 12.5 21H11.5C7.72876 21 5.84315 21 4.67157 19.8284C3.5 18.6569 3.5 16.7712 3.5 13V7" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M2 5C2 4.05719 2 3.58579 2.29289 3.29289C2.58579 3 3.05719 3 4 3H20C20.9428 3 21.4142 3 21.7071 3.29289C22 3.58579 22 4.05719 22 5C22 5.94281 22 6.41421 21.7071 6.70711C21.4142 7 20.9428 7 20 7H4C3.05719 7 2.58579 7 2.29289 6.70711C2 6.41421 2 5.94281 2 5Z" stroke="#121C0C" stroke-width="1.5"/>
                    <path d="M12 7L12 16M12 16L15 12.6667M12 16L9 12.6667" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg> Archived Jobs</a>
                  <a href="{{ path('app_provider_download_data', {'type': 'matching'}) }}" class="menu-item" style="text-decoration: none; color: inherit;"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16.44 8.8999C20.04 9.2099 21.51 11.0599 21.51 15.1099V15.2399C21.51 19.7099 19.72 21.4999 15.25 21.4999H8.73998C4.26998 21.4999 2.47998 19.7099 2.47998 15.2399V15.1099C2.47998 11.0899 3.92998 9.2399 7.46998 8.9099" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 15.0001V3.62012" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15.35 5.85L12 2.5L8.65002 5.85" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg> Export Report</a>
                </div>
              </div>
            </div>
        </div>
        {#<div class="d-flex justify-content-between align-items-center mb-3" ml-15-px>
            <div class="section-intro">Matching jobs are shown based on your work preferences. <a href="{{ path('app_provider_profile_work_preferences') }}"><u>Update your preferences</u></a> to improve job matching.</div>
            <button id="toggleActions" class="btn btn-light d-flex align-items-center gap-1">
                Actions
            </button>
        </div>

        <hr class="mb-4">#}

        {% if jobs|length > 0 %}
        <div class="job-list-container bg-light p-3 rounded-3">
            <div class="d-flex align-items-center job-lists">
                <div class="d-flex align-items-center flex-grow-1">
                    <div class="job-header d-flex align-items-center fw-semibold py-2 flex-grow-1" style="gap: 0;">
                        <div class="col-job sortable" data-sort="job" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; flex-grow: 2; cursor: pointer;">Job<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                        <div class="col-start col-center sortable" data-sort="location" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; flex-grow: 1; cursor: pointer;">Location<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                        <div class="col-start col-center sortable" data-sort="posted" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; flex-grow: 1; cursor: pointer;">Posted on<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                        <div class="col-expiry col-center sortable" data-sort="expires" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; flex-grow: 1; cursor: pointer;">Expires on<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                        <div class="col-start col-center sortable" data-sort="salary" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; flex-grow: 1; cursor: pointer;">Salary/Hour<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                        <div class="col-start col-center sortable" data-sort="category" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; flex-grow: 1; cursor: pointer;">Category<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                    </div>
                </div>
            </div>

            {% for job in jobs %}
            <div class="d-flex align-items-center job-lists">
            <div class="job-row d-flex align-items-center flex-grow-1" style="gap: 0;">
                <div class="col-check" style="width: 30px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center;">
                    <input type="checkbox" class="job-check" data-job-id="{{ job.id }}" />
                </div>
                <div class="col-job d-flex align-items-center gap-2 flex-grow-2" style="padding: 0 8px; box-sizing: border-box;">
                    <img src="{{ job.companyLogo|default(asset('assets/icons/job.png')) }}"
                         alt="Logo"
                         style="width: 40px; height: 40px; border-radius: 8px; flex-shrink: 0;" />
                    <div class="flex-grow-2" style="min-width: 0; overflow: hidden;">
                        <a class="job-title truncate-text d-block fw-semibold text-decoration-none"
                           href="{{ path('app_provider_jobs_detail', {'id': job.id}) }}"
                           style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            {{ job.title }}
                        </a>
                        {#<div class="job-meta text-muted small">
                            {{ job.schedule }}
                        </div>#}
                    </div>
                </div>
                <div class="col-start col-center flex-grow-1" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.state }}</div>
                <div class="col-start col-center flex-grow-1" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.startDate ? job.startDate|date('m/d/Y') : '' }}</div>
                <div class="col-expiry col-center flex-grow-1" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.expirationDate ? job.expirationDate|date('m/d/Y') : '' }}</div>
                <div class="col-start col-center flex-grow-1" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; font-size: 13px;">{{ job.formattedHourlyRate }}</div>
                <div class="col-start col-center flex-grow-1" style="padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; font-size: 13px; color: #121C0C;">
                    {% if job.workType == 'locums' %}
                        Locums
                    {% elseif job.workType == 'parttime' or job.workType == 'part-time' %}
                        Parttime
                    {% elseif job.workType == 'fulltime' or job.workType == 'full-time' %}
                        Full time
                    {% else %}
                        {{ job.workType|default('â€”')|replace({'_': ' '})|title }}
                    {% endif %}
                </div>
                {#<div class="col-action d-flex gap-2 justify-content-end" style="width: 150px; visibility: hidden;">
                    {% if job.id|striptags not in appliedJobsIds %}
                        <a href="{{ path('app_provider_jobs_apply', {'id': job.id, 'redirect_route':'app_provider_jobs_matching'}) }}"
                           title="Apply"
                           onclick="return confirm('Are you sure? Do you want to apply this matching job?')">
                            <svg width="25px" height="25px" viewBox="0 0 24 24" fill="none">
                                <path d="M5 12L10 17L20 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </a>
                    {% else %}
                        <svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" title="Applied">
                            <path d="M5 12L10 17L20 7" stroke="#85BB65" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                    {% endif %}

                    <a href="#" title="Delete">
                        <svg width="25px" height="25px" viewBox="0 0 24 24" fill="none">
                            <path d="M6 6L18 18M6 18L18 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                    </a>

                    <a href="{{ path('app_provider_jobs_saved', {'id': job.id}) }}" title="Save">
                        <svg width="25px" height="25px" viewBox="0 0 24 24" fill="none">
                            <path d="M6 4H18V20L12 16L6 20V4Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                    </a>
                </div>#}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
            <p class="mb-0">Matching jobs not found.</p>
        {% endif %}
        <div class="job-actions hidden-buttons ml-15-px" style="margin-bottom: 20px; display: flex; gap: 8px; align-items: center; visibility: hidden;">
          <button id="apply-btn" class="action-btn" disabled title="Apply" style="display: none;">
            <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <g data-name="Layer 2">
            <g data-name="checkmark-circle">
            <rect width="24" height="24" opacity="0"/>
            <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
            <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
            </g>
            </g>
            <use xlink:href="#icon-apply"/>
            </svg>
          </button>
          <button id="save-btn" class="action-btn" title="Save">
            <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 8C6 5.18536 8 4 12 4C16 4 18 5.18537 18 8V19.0858C18 19.9767 16.9229 20.4229 16.2929 19.7929L12.7071 16.2071C12.3166 15.8166 11.6834 15.8166 11.2929 16.2071L7.70711 19.7929C7.07714 20.4229 6 19.9767 6 19.0858V8Z" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <use xlink:href="#icon-save"/>
            </svg>
          </button>
          <button id="email-btn" class="action-btn" title="Email">
            <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="style=stroke">
            <g id="email">
            <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="currentColor"></path>
            <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="currentcolor"></path>
            </g>
            </g>
            <use xlink:href="#icon-email"/>
            </svg>
          </button>
          <button id="delete-btn" class="action-btn" title="Delete">
            <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.17065 4C9.58249 2.83481 10.6937 2 11.9999 2C13.3062 2 14.4174 2.83481 14.8292 4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M20.5 6H3.49988" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5M18.8334 8.5L18.6334 11.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M9.5 11L10 16" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M14.5 11L14 16" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round"/>
            <use xlink:href="#icon-delete"/>
            </svg>
          </button>
        </div>
    </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const checkboxes = document.querySelectorAll('.job-check');
    const applyBtn = document.getElementById('apply-btn');
    const saveBtn = document.getElementById('save-btn');
    const deleteBtn = document.getElementById('delete-btn');
    const actionsDivs = document.querySelectorAll('.hidden-buttons');
    const menuBtn = document.querySelector('.menu-dropdown-btn');
    const menuPanel = document.querySelector('.menu-panel');

    function toggleDropdown(panel, btn) {
        const isOpen = !panel.classList.contains('hidden');
        closeAllDropdowns();
        if (!isOpen) panel.classList.remove('hidden');
    }

    function closeAllDropdowns() {
        menuPanel.classList.add('hidden');
    }

    menuBtn.addEventListener('click', e => {
        e.stopPropagation();
        toggleDropdown(menuPanel, menuBtn);
    });

    document.addEventListener('click', e => {
        // Only close if click is outside dropdown and button
        if (
          !menuPanel.contains(e.target) &&
          !menuBtn.contains(e.target)
        ) {
          closeAllDropdowns();
        }
    });


    function toggleActionsVisibility() {
      const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
      actionsDivs.forEach(div => {
        div.style.visibility = anyChecked ? 'visible' : 'hidden';
      });
    }

    // Single-selection feature: prevent multiple checkboxes from being selected
    // Delegated change listener to catch any checkbox state changes reliably
    document.addEventListener('change', (e) => {
      const target = e.target;
      if (!target) return;
      if (target.classList && target.classList.contains('job-check')) {
        // Enforce single selection
        if (target.checked) {
          // Get all checkboxes (including split view ones)
          const allCheckboxes = document.querySelectorAll('.job-check');
          const otherChecked = Array.from(allCheckboxes).find(cb => cb !== target && cb.checked);
          if (otherChecked) {
            // Prevent this checkbox from being checked and show alert
            target.checked = false;
            showWarningAlert('Multiple Selection', 'You cannot select multiple values');
            return;
          }
        }
        toggleActionsVisibility();
      }
    });

    // Initial check in case some boxes are pre-checked
    toggleActionsVisibility();

    function updateActions() {
      const checked = Array.from(checkboxes).filter(cb => cb.checked);
      const applyButtons = document.querySelectorAll('#apply-btn');
      applyButtons.forEach(btn => {
        if (checked.length === 1) {
          btn.style.display = 'flex';
          btn.disabled = false;
        } else {
          btn.style.display = 'none';
          btn.disabled = true;
        }
      });
    }

    checkboxes.forEach(cb => {
      cb.addEventListener('change', updateActions);
    });

    applyBtn.addEventListener('click', () => {
      const selected = Array.from(checkboxes).filter(cb => cb.checked);
      if (selected.length === 1) {
        const jobId = selected[0].dataset.jobId;
        // Trigger apply logic here
        console.log('Applying to job:', jobId);
      }
    });

    saveBtn.addEventListener('click', () => {
      const selectedIds = Array.from(checkboxes)
        .filter(cb => cb.checked)
        .map(cb => cb.dataset.jobId);
      // Trigger batch save logic here
      console.log('Saving jobs:', selectedIds);
    });

    deleteBtn.addEventListener('click', () => {
      const selectedIds = Array.from(checkboxes)
        .filter(cb => cb.checked)
        .map(cb => cb.dataset.jobId);
      // Trigger batch delete logic here
      console.log('Deleting jobs:', selectedIds);
    });
  });
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const headers = document.querySelectorAll('.sortable');
  let currentSort = { key: null, direction: 'asc' };

  headers.forEach(header => {
    header.addEventListener('click', () => {
      const key = header.dataset.sort;
      const direction = (currentSort.key === key && currentSort.direction === 'asc') ? 'desc' : 'asc';
      currentSort = { key, direction };

      // Reset all arrows to inactive
      document.querySelectorAll('.sort-toggle .arrow').forEach(a => a.classList.remove('active'));
      // Activate the appropriate arrow on current header
      const up = header.querySelector('.sort-toggle .sort-up');
      const down = header.querySelector('.sort-toggle .sort-down');
      if (direction === 'asc' && up) up.classList.add('active');
      if (direction === 'desc' && down) down.classList.add('active');

      sortJobs(key, direction);
    });
  });

  function sortJobs(key, direction) {
    const rows = Array.from(document.querySelectorAll('.job-row')).map(row => {
      const cells = Array.from(row.children);
      // Structure: [0]checkbox, [1]job, [2]location, [3]posted, [4]expires, [5]salary, [6]category
      
      return {
        element: row,
        job: {
          job: row.querySelector('.job-title')?.textContent.trim().toLowerCase() || '',
          location: cells[2]?.textContent.trim().toLowerCase() || '',
          posted: cells[3]?.textContent.trim() || '',
          expires: cells[4]?.textContent.trim() || '',
          salary: parseFloat(cells[5]?.textContent.trim().replace(/[^0-9.]/g, '')) || 0,
          category: cells[6]?.textContent.trim().toLowerCase() || ''
        }
      };
    });

    rows.sort((a, b) => {
      const valA = a.job[key];
      const valB = b.job[key];
      if (typeof valA === 'string') {
        return direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
      } else {
        return direction === 'asc' ? valA - valB : valB - valA;
      }
    });

    const container = document.querySelector('.job-list-container');
    if (container) {
      rows.forEach(row => {
        if (row.element && row.element.parentElement) {
          container.appendChild(row.element.parentElement);
        }
      });
    }
  }
});
</script>

<script>
// Filter functionality
document.addEventListener('DOMContentLoaded', function() {
  const filterBtn = document.getElementById('filter-btn');
  const filterPanel = document.getElementById('filter-panel');
  const applyFilterBtn = document.getElementById('apply-filter-btn');
  const clearFilterBtn = document.getElementById('clear-filter-btn');
  
  if (!filterBtn || !filterPanel) return;
  
  // Toggle filter panel
  filterBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    filterPanel.classList.toggle('hidden');
  });
  
  // Close filter panel when clicking outside
  document.addEventListener('click', function(e) {
    if (!filterPanel.contains(e.target) && !filterBtn.contains(e.target)) {
      filterPanel.classList.add('hidden');
    }
  });
  
  // Apply filters
  if (applyFilterBtn) {
    applyFilterBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      applyFilters();
    });
  }
  
  // Clear filters
  if (clearFilterBtn) {
    clearFilterBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      document.getElementById('filter-location').value = '';
      document.getElementById('filter-salary-min').value = '';
      document.getElementById('filter-salary-max').value = '';
      document.getElementById('filter-category').value = '';
      document.getElementById('filter-date-posted').value = '';
      // Reload page to show all jobs
      window.location.href = "{{ path('app_provider_jobs_matching') }}";
    });
  }
  
  function applyFilters() {
    const locationInput = document.getElementById('filter-location');
    const salaryMinInput = document.getElementById('filter-salary-min');
    const salaryMaxInput = document.getElementById('filter-salary-max');
    const categoryInput = document.getElementById('filter-category');
    const datePostedInput = document.getElementById('filter-date-posted');
    const container = document.querySelector('.job-list-container');
    
    if (!container) {
      console.error('Container not found');
      return;
    }
    
    // Build filter parameters
    const params = new URLSearchParams();
    if (locationInput?.value) params.append('location', locationInput.value);
    if (salaryMinInput?.value) params.append('salaryMin', salaryMinInput.value);
    if (salaryMaxInput?.value) params.append('salaryMax', salaryMaxInput.value);
    if (categoryInput?.value) params.append('category', categoryInput.value);
    if (datePostedInput?.value) params.append('days', datePostedInput.value);
    
    // Show loading spinner
    container.innerHTML = `
      <div class="text-center p-4">
        <div class="spinner-border text-success mb-3" role="status"></div>
        <p>Filtering jobs...</p>
      </div>
    `;
    
    // Use Symfony route dynamically
    const matchingJobsUrl = "{{ path('app_provider_jobs_matching') }}";
    
    // Make AJAX request
    fetch(`${matchingJobsUrl}?${params.toString()}`, {
      headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
      .then(res => res.json())
      .then(data => {
        container.outerHTML = data.html;
        filterPanel.classList.add('hidden');
      })
      .catch(err => {
        console.error('Filter error:', err);
        container.innerHTML = `<p class="text-danger p-4">Failed to load filtered jobs.</p>`;
      });
  }
  
  });
</script>

  <!-- Email Template Modal -->
  <div id="email-modal-overlay" class="email-modal-overlay" style="display:none;"></div>
  <div id="email-template-1-modal" class="email-modal" aria-hidden="true" style="display:none;">
    <div class="email-modal-header">
      <h5>Email Template: Intro/Referral</h5>
      <button class="email-modal-close" data-close>&times;</button>
    </div>
    <div class="email-modal-body">
      <label>Subject</label>
      <input id="email-t1-subject" type="text" readonly>
      <label>Message</label>
      <textarea id="email-t1-message" readonly></textarea>
    </div>
    <div class="email-modal-footer">
      <button class="dropdown-cstm" data-copy-subject="#email-t1-subject">Copy Subject</button>
      <button class="dropdown-cstm" data-copy-message="#email-t1-message">Copy Message</button>
      <button class="action-btn" data-open-gmail data-sub="#email-t1-subject" data-body="#email-t1-message">Open in Gmail</button>
    </div>
  </div>

  <style>
  .email-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.3);
    z-index: 999;
  }
  .email-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: min(600px, 90vw);
    max-height: 85vh;
    background: #fff;
    border: 1px solid #e6eef6;
    border-radius: 10px;
    box-shadow: 0 6px 18px rgba(11,22,40,0.15);
    display: flex;
    flex-direction: column;
    z-index: 1000;
    overflow-y: auto;
  }
  .email-modal-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    padding: 12px 14px; 
    border-bottom: 1px solid #e6eef6; 
  }
  .email-modal-body { 
    padding: 14px; 
    display: flex; 
    flex-direction: column; 
    gap: 8px; 
  }
  .email-modal-body label {
    font-size: 13px;
    font-weight: 500;
    color: #121C0C;
  }
  .email-modal-body input, 
  .email-modal-body textarea {
    width: 100%; 
    border: 1px solid #e6eef6; 
    border-radius: 8px; 
    padding: 10px; 
    outline: none;
    font-size: 13px;
  }
  .email-modal-body textarea { 
    min-height: 180px; 
    resize: vertical; 
  }
  .email-modal-footer { 
    display: flex; 
    gap: 8px; 
    padding: 12px 14px; 
    border-top: 1px solid #e6eef6; 
  }
  .email-modal-close { 
    background: transparent; 
    border: none; 
    font-size: 22px; 
    cursor: pointer; 
    color: #666; 
  }
  </style>

  <script>
  function openEmailModal(templateId) {
    const overlay = document.getElementById('email-modal-overlay');
    const modal = document.getElementById(`email-template-${templateId}-modal`);
    if (!overlay || !modal) return;

    // Build dynamic context from selected job
    const selectedCheckbox = document.querySelector('.job-check:checked');
    let jobTitle = 'the role';
    let company = 'your company';
    
    if (selectedCheckbox) {
      const row = selectedCheckbox.closest('.job-row');
      const rowTitle = row?.querySelector('.job-title');
      const rowCompany = row?.querySelector('.job-company-name');
      if (rowTitle && rowTitle.textContent.trim()) {
        jobTitle = rowTitle.textContent.trim();
      }
      if (rowCompany && rowCompany.textContent.trim()) {
        company = rowCompany.textContent.trim();
      }
    }

    const subjectEl = document.getElementById(`email-t${templateId}-subject`);
    const messageEl = document.getElementById(`email-t${templateId}-message`);
    if (!subjectEl || !messageEl) return;

    if (templateId === 1) {
      subjectEl.value = `Introduction and interest in ${jobTitle}`;
      messageEl.value = `Hi there,\n\nI hope you're doing well. I came across ${jobTitle} at ${company} and it looks like a strong match for my background. I'd welcome the chance to connect and share how I can help.\n\nI've attached my resume for your review. Below is a short paragraph you can paste for introductions if helpful.\n\n[INSERT BRIEF PARAGRAPH IN THE 3RD PERSON HERE.]\n\nThanks in advance for your help â€” I'd love to catch up soon.\n\nBest,\n[YOUR NAME]`;
    }

    overlay.style.display = 'block';
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden', 'false');
    
    // Reset modal position to center
    modal.style.top = '50%';
    modal.style.left = '50%';
    modal.style.right = 'auto';
    modal.style.bottom = 'auto';
    modal.style.transform = 'translate(-50%, -50%)';
    
    // Ensure modal is visible in viewport - scroll into view smoothly
    setTimeout(() => {
      modal.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
      
      // After scrolling, check if modal needs position adjustment
      setTimeout(() => {
        const rect = modal.getBoundingClientRect();
        const viewportHeight = window.innerHeight;
        const viewportWidth = window.innerWidth;
        const padding = 20;
        
        // Adjust vertical position if needed
        if (rect.top < padding) {
          modal.style.top = padding + 'px';
          modal.style.transform = 'translate(-50%, 0)';
        } else if (rect.bottom > viewportHeight - padding) {
          modal.style.top = 'auto';
          modal.style.bottom = padding + 'px';
          modal.style.transform = 'translate(-50%, 0)';
        }
        
        // Adjust horizontal position if needed
        if (rect.left < padding) {
          modal.style.left = padding + 'px';
          modal.style.transform = modal.style.transform.replace('translate(-50%', 'translate(0');
        } else if (rect.right > viewportWidth - padding) {
          modal.style.right = padding + 'px';
          modal.style.left = 'auto';
          modal.style.transform = modal.style.transform.replace('translate(-50%', 'translate(0');
        }
      }, 300); // Wait for scroll animation to complete
    }, 10);
  }

  function closeAllEmailModals() {
    const overlay = document.getElementById('email-modal-overlay');
    const modals = document.querySelectorAll('.email-modal');
    modals.forEach(m => { m.style.display = 'none'; m.setAttribute('aria-hidden', 'true'); });
    if (overlay) overlay.style.display = 'none';
  }

  document.addEventListener('DOMContentLoaded', function () {
    const overlay = document.getElementById('email-modal-overlay');
    if (overlay) overlay.addEventListener('click', closeAllEmailModals);

    document.querySelectorAll('.email-modal [data-close]').forEach(btn => {
      btn.addEventListener('click', closeAllEmailModals);
    });

    // Copy handlers
    document.querySelectorAll('[data-copy-subject]').forEach(btn => {
      btn.addEventListener('click', () => {
        const sel = btn.getAttribute('data-copy-subject');
        const input = document.querySelector(sel);
        if (!input) return;
        navigator.clipboard.writeText(input.value || '').then(() => {
          if (typeof showToast === 'function') {
            showToast('Subject copied', 'success');
          }
        }).catch(() => {});
      });
    });
    
    document.querySelectorAll('[data-copy-message]').forEach(btn => {
      btn.addEventListener('click', () => {
        const sel = btn.getAttribute('data-copy-message');
        const input = document.querySelector(sel);
        if (!input) return;
        navigator.clipboard.writeText(input.value || '').then(() => {
          if (typeof showToast === 'function') {
            showToast('Message copied', 'success');
          }
        }).catch(() => {});
      });
    });

    // Open in Gmail
    document.querySelectorAll('[data-open-gmail]').forEach(btn => {
      btn.addEventListener('click', () => {
        const subSel = btn.getAttribute('data-sub');
        const bodySel = btn.getAttribute('data-body');
        const subEl = document.querySelector(subSel);
        const bodyEl = document.querySelector(bodySel);
        const su = encodeURIComponent(subEl ? subEl.value : '');
        const body = encodeURIComponent(bodyEl ? bodyEl.value : '');
        const url = `https://mail.google.com/mail/?view=cm&fs=1&su=${su}&body=${body}`;
        window.open(url, '_blank');
      });
    });

    // Link email button to email modal
    const emailBtn = document.getElementById('email-btn');
    if (emailBtn) {
      emailBtn.addEventListener('click', () => openEmailModal(1));
    }
  });
  </script>

{% endblock %}

{% block footer_scripts %}
<script>
// Force apply styles via JavaScript - COMPLETE OVERRIDE - Run multiple times to ensure it sticks
function applySpacingStyles() {
    // Reset and apply container-xl styles
    const container = document.querySelector('.container-xl');
    if (container) {
        container.style.setProperty('position', 'relative', 'important');
        container.style.setProperty('padding-left', '0', 'important');
        container.style.setProperty('padding-right', '30px', 'important');
        container.style.setProperty('margin-left', '0', 'important');
        container.style.setProperty('margin-right', '0', 'important');
        container.style.setProperty('transform', 'none', 'important');
        container.style.setProperty('max-width', '100%', 'important');
        container.style.setProperty('width', '100%', 'important');
    }
    
    // Reset app-content
    const appContent = document.querySelector('.app-content');
    if (appContent) {
        appContent.style.setProperty('position', 'relative', 'important');
        appContent.style.setProperty('padding-left', '0', 'important');
        appContent.style.setProperty('padding-right', '0', 'important');
        appContent.style.setProperty('margin-left', '0', 'important');
        appContent.style.setProperty('margin-right', '0', 'important');
        appContent.style.setProperty('max-width', '100%', 'important');
        appContent.style.setProperty('width', '100%', 'important');
    }
    
    // Reset app-wrapper
    const appWrapper = document.querySelector('.app-wrapper');
    if (appWrapper) {
        appWrapper.style.setProperty('position', 'relative', 'important');
        appWrapper.style.setProperty('margin-left', '0', 'important');
        appWrapper.style.setProperty('margin-right', '0', 'important');
        appWrapper.style.setProperty('padding-left', '0', 'important');
        appWrapper.style.setProperty('padding-right', '0', 'important');
        appWrapper.style.setProperty('width', '100%', 'important');
        
        // Apply transform at 1200px breakpoint
        if (window.innerWidth >= 1200) {
            appWrapper.style.setProperty('margin-left', '250px', 'important');
            appWrapper.style.setProperty('transform', 'translateX(-150px)', 'important');
            appWrapper.style.setProperty('width', 'calc(100% - 250px + 150px)', 'important');
        } else {
            appWrapper.style.setProperty('transform', 'none', 'important');
        }
    }
}

// Run on load
document.addEventListener('DOMContentLoaded', function() {
    applySpacingStyles();
    // Run multiple times to ensure it sticks
    setTimeout(applySpacingStyles, 100);
    setTimeout(applySpacingStyles, 500);
});

// Run on resize
window.addEventListener('resize', function() {
    applySpacingStyles();
});
</script>
{% endblock %}
