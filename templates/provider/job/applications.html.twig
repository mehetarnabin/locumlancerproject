{% extends 'provider/base.html.twig' %}

{% block title %}My Applications{% endblock %}

{% block provider_body %}

<style>
.job-header, .job-row {
    display: flex;
    align-items: center;
    min-width: 0;
    overflow: hidden;
}

.col-job,
.col-location,
.col-schedule,
.col-expiry,
.col-start,
.col-action {
    flex: 1;
    min-width: 130px;
}
.col-job {
    flex: 2;
}
.job-header {
    padding-left: 8px;
    padding-right: 8px;
    color: #121C0C;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    border: 1px solid #e6eef6;
    height: 40px;
    margin-bottom: 2px;
    font-size: 13px;
    min-width: 0;
    overflow: hidden;
}
.job-row {
    border: none;
    padding: 8px 8px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin: 2px 0;
    align-items: center;
    margin: 2px 0;
    font-size: 13px;
    border-radius: 10px;
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    min-width: 0;
    overflow: hidden;
}
.truncate-text {
    display: inline-block;
    max-width: 180px; /* Adjust as needed */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
}
.job-section {
    background-color: #fff;
}
.job-check {
    margin-right: 8px;
    transform: scale(1.2);
}
#toggleActions {
    padding: 6px 16px;
    border-radius: 18px;
    border: 1px solid #ddd;
    font-size: 16px;
    color: #fff;
}
.job-meta {
    margin-top: 1px;
}
.ml-15-px {
    margin-left: 15px;
}
.mr-15-px {
    margin-right: 15px;
}
.action-btn {
    background: transparent;
    border: none;
    padding: 0 4px;
}

/* Note button visibility - show when job details are viewed */
#note-btn {
    display: none;
}

#note-btn[style*="flex"] {
    display: flex !important;
}

.custom-dropdown {
  position: absolute;
  top: 110%;
  left: 0;
  background: #fff;
  padding: 10px;
  min-width: 150px;
  z-index: 1000;
  border: 1px solid #e6eef6;
  box-shadow: 0 2px 6px rgba(11,22,40,0.03);
  border-radius: 10px;
}

.hidden {
  display: none;
}

.columns-panel label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
  cursor: pointer;
  font-weight: 400;
  color: #121C0C;
}

.menu-panel .menu-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 0;
  cursor: pointer;
  color: #121C0C;
}

.menu-panel svg {
    width: 16px;
    height: 16px;
}

.dropdown-cstm {
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    padding: 4px 12px;
}

.menu-panel {
    min-width: 160px;
}

.columns-panel input[type="checkbox"] {
    appearance: none;
    width: 16px;
    height: 16px;
    border: 1px solid #cfd9e3;
    border-radius: 4px;
    background-color: #fff;
    cursor: pointer;
    position: relative;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

.columns-panel input[type="checkbox"]:hover {
    border-color: #85BB65;
}

.columns-panel input[type="checkbox"]:checked {
    background-color: #85BB65;
    border-color: #85BB65;
}

.columns-panel input[type="checkbox"]:checked::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 5px;
    width: 4px;
    height: 8px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

.col-check input[type="checkbox"] {
    appearance: none;
    width: 16px;
    height: 16px;
    border: 1px solid #cfd9e3;
    border-radius: 4px;
    background-color: #fff;
    cursor: pointer;
    position: relative;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

.col-check input[type="checkbox"]:hover {
    border-color: #85BB65;
}

.col-check input[type="checkbox"]:checked {
    background-color: #85BB65;
    border-color: #85BB65;
}

.col-check input[type="checkbox"]:checked::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 5px;
    width: 4px;
    height: 8px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

/* Consistent rounded rectangle style for all checkboxes on applications table */
.job-list-container input[type="checkbox"],
#select-all-checkbox {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border: 1px solid #cfd9e3;
    border-radius: 4px;
    background: #fff;
    cursor: pointer;
    position: relative;
    display: inline-block;
    vertical-align: middle;
    margin: 0;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

/* Hover state - green border */
.job-list-container input[type="checkbox"]:hover,
#select-all-checkbox:hover {
    border-color: #85BB65;
}

/* Checked state - green filled with white checkmark */
.job-list-container input[type="checkbox"]:checked,
#select-all-checkbox:checked {
    background-color: #85BB65;
    border-color: #85BB65;
}

.job-list-container input[type="checkbox"]:checked::after,
#select-all-checkbox:checked::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 6px;
    width: 4px;
    height: 8px;
    border: solid #fff;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

.job-title {
    color: #121C0C;
    font-size: 16px;
}

.action-btn {
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    padding: 4px 12px;
    display: flex;
    gap: 6px;
    align-items: center;
}
.action-btn, .dropdown-cstm {
    transition: all 0.2s ease;
}
.action-btn:hover, .dropdown-cstm:hover {
    color: #85BB65;
    border: 1px solid #85BB65;
    transition: all 0.2s ease;
}
.action-btn:hover svg {
    color: #85BB65;
}
#delete-btn:hover {
    color: #BA1824;
    border: 1px solid #BA1824;
    transition: all 0.2s ease; 
}
#delete-btn:hover svg {
    color: #BA1824;
}
.col-center {
    text-align: center;
}
.col-rank {
    min-width: 50px;
    max-width: 50px;
}
.application {
    padding-left: 16px;
}
.application .card {
    clip-path: polygon(0% 0%,calc(100% - 15px) 0%,100% 50%,calc(100% - 15px) 100%,0% 100%,15px 50%,0% 0%);
    display: flex;
    justify-content: center;
    align-items: center;
    margin-left: -15px;
    margin-bottom: 0 !important;
    cursor: pointer;
    height: 100%;
    width: 100%;
    flex: 1;
}

/* First card: no left cutout */
.application .col:first-child {
    max-width: 80px;
    display: flex;
}

.application .col:first-child > a {
    display: flex;
    width: 100%;
    flex: 1;
}

.application .col:first-child .card {
    clip-path:none;
    margin-left: 0;
    margin-bottom: 0 !important;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    flex: 1;
}
.application .row .col {
    display: flex;
}

.application .row .col > a {
    display: flex;
    width: 100%;
    flex: 1;
}

.application .col .card-body {
    justify-content: center;
    flex-direction: column-reverse;
    text-align: center;
    align-items: center;
    display: flex;
    height: 100%;
    min-height: 100%;
    padding: 0.5rem 1rem;
}
.application .col .card-body .card-title {
    font-size: 16px;
}
.is-card.is-applied:hover *, .is-card.is-review:hover *, .is-card.is-interview:hover *, .is-card.is-rejected:hover *, .is-card.is-hired:hover *, .is-card.is-offered:hover *, .is-card.is-completed:hover *, .is-card.is-applied.active *, .is-card.is-review.active *, .is-card.is-interview.active *, .is-card.is-rejected.active *, .is-card.is-hired.active *, .is-card.is-offered.active *, .is-card.is-completed.active *, .is-card .card-body p, .is-card .card-body:hover, .application .col .card-body .card-title:hover, .is-card:hover {
    color: rgb(33, 37, 41);
}
.application .col .card-body p {
    font-size: 16px;
    color: #121C0C;
}
.application .col:first-child .card .card-body {
    align-items: center;
}
.application .col:nth-child(2) .card {
    clip-path: polygon(0% 0%,calc(100% - 15px) 0%,100% 50%,calc(100% - 15px) 100%,0% 100%,0% 0%);
    margin-left: 0;
}
.application .col:last-child .card {
    clip-path: polygon(0% 0%,100% 0%,100% 100%,0% 100%,15px 50%,0% 0%);
}
.application .col:first-child .card-body p {
    display: none;
}
.application .col:first-child .card-body .card-title {
    font-size: 16px;
}
.col:nth-child(1) .is-card {
    background-color: #D2E6C6;
}
.col:nth-child(2) .is-card {
    background-color: #C7E0B8;
}
.col:nth-child(3) .is-card {
    background-color: #BBDAAA;
}
.col:nth-child(4) .is-card {
    background-color: #AFD39C;
}
.col:nth-child(5) .is-card {
    background-color: #A4CC8E;
}
.col:nth-child(6) .is-card {
    background-color: #99C680;
}
.col:nth-child(7) .is-card {
    background-color: #8DC072;
}
.col:nth-child(8) .is-card {
    background-color: #82B964;
}

.col:nth-child(1) .is-card:hover {
    background-color: #B9F2FF;
}
.col:nth-child(2) .is-card:hover {
    background-color: #ADF0FF;
}
.col:nth-child(3) .is-card:hover {
    background-color: #99ECFF;
}
.col:nth-child(4) .is-card:hover {
    background-color: #85E9FF;
}
.col:nth-child(5) .is-card:hover {
    background-color: #70E5FF;
}
.col:nth-child(6) .is-card:hover {
    background-color: #5CE1FF;
}
.col:nth-child(7) .is-card:hover {
    background-color: #47DDFF;
}
.col:nth-child(8) .is-card:hover {
    background-color: #33DAFF;
}
.col .is-card.is-applied.active {
    background-color: #99ECFF;
}
.col .is-card.is-interview.active {
    background-color: #85E9FF;
}
.col .is-card.is-offered.active {
    background-color: #70E5FF;
}
.col .is-card.is-hired.active {
    background-color: #5CE1FF;
}
.col .is-card.is-completed.active {
    background-color: #47DDFF;
}
.badge.badge-pill {
    background: none;
    animation: colorChange 1s infinite alternate;
    font-weight: 400 !important;
}
@keyframes colorChange {
    0% {
        color: #0096B8;
    }
    100% {
        color: #33DAFF;
    }
}
.job-actions a {
    color : #000;
}
.job-actions a:hover {
    color : #85BB65;
}

.actions-container {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 16px;
    margin-top: 20px;
    margin-bottom: 12px;
}

/* Enhanced table alignment and typography */
.job-header {
    font-size: 13px;
    font-weight: 600;
    color: #121C0C;
    letter-spacing: 0.01em;
    line-height: 1.5;
    background: #F8FAF9;
    border-bottom: 2px solid #e6eef6;
}

.job-row {
    font-size: 13px;
    font-weight: 400;
    color: #1a1a1a;
    line-height: 1.5;
    transition: background-color 0.2s ease;
}

.job-row:hover {
    background-color: #F8FAF9;
}

/* Perfect alignment between headers and rows */
.job-header > div,
.job-row > div {
    display: flex;
    align-items: center;
    box-sizing: border-box;
    padding: 12px 8px;
    min-width: 0;
    overflow: hidden;
    height: 48px;
}

/* Ensure consistent vertical alignment */
.job-header {
    min-height: 48px;
    height: 48px;
}

/* Center content for numeric/text columns */
.job-header .col-start.col-center,
.job-row .col-start.col-center {
    justify-content: center;
    text-align: center;
}

/* Job column specific styling */
.col-job {
    font-weight: 500;
}

/* Improve text truncation */
.job-title {
    font-size: 13px;
    font-weight: 500;
    color: #121C0C;
    line-height: 1.4;
}

/* Consistent cell content styling */
.job-row > div {
    font-size: 13px;
    color: #1a1a1a;
}

/* Status and badge styling */
.job-row .badge {
    font-size: 11px;
    font-weight: 500;
    padding: 4px 8px;
    border-radius: 6px;
}

.job-actions-left {
    justify-self: start;
}

.job-actions-middle {
    justify-self: center;
}

.col-dropdowns {
    justify-self: end;
}

.table-responsive-wrapper {
    overflow-x: auto;
    overflow-y: visible;
    -webkit-overflow-scrolling: touch;
}

.table-responsive-wrapper::-webkit-scrollbar {
    height: 8px;
}

.table-responsive-wrapper::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.table-responsive-wrapper::-webkit-scrollbar-thumb {
    background: #85BB65;
    border-radius: 10px;
}

.table-responsive-wrapper::-webkit-scrollbar-thumb:hover {
    background: #6fa852;
}

.sort-toggle {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    line-height: 1;
    gap: 2px;
    margin-left: 6px;
    vertical-align: middle;
    position: relative;
    top: 1px;
}
.sort-toggle svg { width: 10px; height: 10px; }
.sort-toggle .arrow { opacity: 0.35; transition: opacity 0.15s ease; }
.sort-toggle .arrow.active { opacity: 1; }

.col-start.col-center {
    box-sizing: border-box;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    min-width: 0;
}

.job-row .col-start.col-center {
    max-width: 100%;
    word-wrap: break-word;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 0;
}

.job-header .col-start.col-center {
    box-sizing: border-box;
}

/* Loading spinner for hire button */
.loading-spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid #85BB65;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Success message styles */
.success-message {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #4CAF50;
    color: white;
    padding: 15px 20px;
    border-radius: 5px;
    z-index: 9999;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.error-message {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #f44336;
    color: white;
    padding: 15px 20px;
    border-radius: 5px;
    z-index: 9999;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
</style>

<!-- Hidden form for delete action -->
<form id="delete-applications-form" method="POST" action="{{ path('app_provider_applications_delete') }}" style="display: none;">
    <input type="hidden" name="_token" value="{{ csrf_token('delete_applications') }}">
    <input type="hidden" name="application_ids" id="application-ids-input">
</form>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the selected applications? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Hire Confirmation Modal -->
<div class="modal fade" id="hireConfirmModal" tabindex="-1" aria-labelledby="hireConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="hireConfirmModalLabel">Confirm Hire</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to mark the selected application as hired? This will:
                <ul>
                    <li>Notify the admin</li>
                    <li>Move the application to "accepted" status</li>
                    <li>Store the hire date</li>
                    <li>Remove it from the current section</li>
                </ul>
                This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="confirm-hire-btn">Confirm Hire</button>
            </div>
        </div>
    </div>
</div>

<!-- Add CSRF token here -->
<meta name="csrf-token" content="{{ csrf_token('archive') }}">
<meta name="csrf-token-hire" content="{{ csrf_token('hire_application') }}">

    {% set statusColors = {
        'saved': 'saved',
        'applied': 'applied',
        'interview': 'interview',
        'negotiating': 'offered',
        'accepted' : 'hired',
        'completed': 'completed',
    } %}

    {% set allStatuses = ['saved', 'applied', 'interview', 'negotiating', 'accepted', 'completed'] %}

    <div class="container-xl">
        <div class="job-section shadow-lg p-3 rounded-3">

            <!-- Flash Messages -->
            {% for message in app.flashes('success') %}
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
            
            {% for message in app.flashes('error') %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}

            <div class="application">
                <div class="row g-2">
                    <div class="col">
                        <a href="{{ path('app_provider_jobs_applications') }}">
                            <div class="card is-card mb-3 is-applied {% if app.request.get('status') and app.request.get('status') == '' %}active{% endif %}">
                                <div class="card-body">
                                    <h6 class="card-title">All</h6>
                                    <p class="card-text">{{ totalApplications|number_format }}</p>
                                </div>
                            </div>
                        </a>
                    </div>

                    {% for status in allStatuses %}
                        {% set count = 0 %}
                        {% for item in statusCounts %}
                            {% if item.status == status %}
                                {% set count = item.count %}
                            {% endif %}
                        {% endfor %}
                        <div class="col">
                            <a href="{% if status == 'saved' %}{{ path('app_provider_jobs_saved') }}{% else %}{{ path('app_provider_jobs_applications', {'status': status}) }}{% endif %}">
                            <div class="card is-card mb-3 is-{{ statusColors[status] }} {% if app.request.get('status') == status or (status == 'saved' and app.request.get('_route') == 'app_provider_jobs_saved') %}active{% endif %}">
                                <div class="card-body">
                                    <h6 class="card-title">{{ status | replace({'_': ' '}) | title }}</h6>
                                    <p class="card-text">{{ count }}</p>
                                </div>
                            </div>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="actions-container ml-15-px mr-15-px">
                <!-- Left Group: Filter, Notify of hire, Say thank you, and conditional buttons -->
                <div class="job-actions-left" style="display: flex; gap: 8px; align-items: center;">
                  <div class="position-relative" style="flex-shrink: 0;">
                    <button id="filter-btn" class="action-btn" title="Filter">
                    <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 7H21M7 12H17M10 17H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    Filter
                  </button>
                    <div id="filter-panel" class="filter-panel custom-dropdown hidden" style="position: absolute; top: 100%; left: 0; margin-top: 8px; min-width: 280px; z-index: 1000;">
                      <div style="padding: 16px;">
                        <h6 style="margin-bottom: 12px; font-weight: 600; color: #121C0C;">Filter Applications</h6>
                        
                        <!-- Location Filter -->
                        <div style="margin-bottom: 16px;">
                          <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Location</label>
                          <input type="text" id="filter-location" class="form-control" placeholder="Enter location" style="font-size: 13px; padding: 6px 10px;">
                        </div>
                        
                        <!-- Salary Range Filter -->
                        <div style="margin-bottom: 16px;">
                          <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Salary Range</label>
                          <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="number" id="filter-salary-min" class="form-control" placeholder="Min" style="font-size: 13px; padding: 6px 10px; flex: 1;">
                            <span style="color: #6b7280;">-</span>
                            <input type="number" id="filter-salary-max" class="form-control" placeholder="Max" style="font-size: 13px; padding: 6px 10px; flex: 1;">
                          </div>
                        </div>
                        
                        <!-- Category Filter -->
                        <div style="margin-bottom: 16px;">
                          <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Category</label>
                          <select id="filter-category" class="form-control" style="font-size: 13px; padding: 6px 10px;">
                            <option value="">All Categories</option>
                            <option value="locums">Locums</option>
                            <option value="parttime">Parttime</option>
                            <option value="fulltime">Full time</option>
                          </select>
                        </div>
                        
                        <!-- Applied Date Filter -->
                        <div style="margin-bottom: 16px;">
                          <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Applied Within</label>
                          <select id="filter-date-applied" class="form-control" style="font-size: 13px; padding: 6px 10px;">
                            <option value="">Any time</option>
                            <option value="1">Last 24 hours</option>
                            <option value="7">Last 7 days</option>
                            <option value="30">Last 30 days</option>
                            <option value="90">Last 3 months</option>
                          </select>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 8px; margin-top: 16px;">
                          <button id="apply-filter-btn" class="action-btn" style="flex: 1; padding: 8px 12px; font-size: 13px;">Apply</button>
                          <button id="clear-filter-btn" class="action-btn" style="flex: 1; padding: 8px 12px; font-size: 13px; background: #f3f4f6; color: #6b7280;">Clear</button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <button id="save-btn" class="action-btn" title="Notify of Hire">
                    <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22 10.5V12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2H13.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <circle cx="19" cy="5" r="3" stroke="#1C274C" stroke-width="1.5"/>
                    <path d="M7 14H16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M7 17.5H13" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg> Notify of hire
                  </button>
                  <button id="email-btn" class="action-btn" title="Email">
                    <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="style=stroke">
                    <g id="email">
                    <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="currentColor"></path>
                    <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="currentcolor"></path>
                    </g>
                    </g>
                    </svg> Email
                  </button>
                {% if app.request.get('status') not in ['saved', 'interview', 'negotiating', 'accepted', 'completed'] %}
                    <button id="request-response-btn" class="action-btn conditional-btn" disabled title="Request Response" style="display: none;">
                    <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <g data-name="Layer 2">
                    <g data-name="checkmark-circle">
                    <rect width="24" height="24" opacity="0"/>
                    <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                    <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                    </g>
                    </g>
                    </svg> Request Response
                  </button>
                {% endif %}
                {% if app.request.get('status') not in ['saved', 'applied', 'negotiating', 'accepted', 'completed'] %}
                  <button id="say-thank-you-btn" class="action-btn conditional-btn" title="Say thank you" style="display: none;">
                    <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="style=stroke">
                    <g id="email">
                    <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="currentColor"></path>
                    <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="currentcolor"></path>
                    </g>
                    </g>
                    </svg> Say thank you
                  </button>
                {% endif %}
                {% if app.request.get('status') not in ['saved', 'applied', 'interview', 'accepted', 'completed'] %}
                  <button id="follow-up-btn" class="action-btn conditional-btn" disabled title="Send Follow Up Note" style="display: none;">
                    <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <g data-name="Layer 2">
                    <g data-name="checkmark-circle">
                    <rect width="24" height="24" opacity="0"/>
                    <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                    <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                    </g>
                    </g>
                    </svg> Send Follow Up Note
                  </button>
                {% endif %}
                {% if app.request.get('status') not in ['saved', 'applied', 'interview', 'negotiating', 'completed'] %}
                  <button id="ask-details-btn" class="action-btn conditional-btn" disabled title="Ask for Details" style="display: none;">
                    <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <g data-name="Layer 2">
                    <g data-name="checkmark-circle">
                    <rect width="24" height="24" opacity="0"/>
                    <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                    <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                    </g>
                    </g>
                    </svg> Ask for Details
                  </button>
                {% endif %}
                {% if app.request.get('status') not in ['saved', 'applied', 'interview', 'negotiating', 'accepted'] %}
                  <button id="write-review-btn" class="action-btn conditional-btn" disabled title="Write Review" style="display: none;">
                    <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <g data-name="Layer 2">
                    <g data-name="checkmark-circle">
                    <rect width="24" height="24" opacity="0"/>
                    <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                    <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                    </g>
                    </g>
                    </svg> Write Review
                  </button>
                {% endif %}
                </div>
                
                <!-- Middle Group: Note, Archive, Delete -->
                <div class="job-actions-middle" style="display: flex; gap: 8px; align-items: center;">
                  <button id="note-btn" class="action-btn d-none" title="Add Note" onclick="handleNoteClick()" style="display: none;">
                    <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <!-- Sticky note with pencil icon -->
                      <path d="M8 3H14C16.7614 3 19 5.23858 19 8V14.5C19 15.0523 18.5523 15.5 18 15.5H14C12.3431 15.5 11 16.8431 11 18.5V20C11 20.5523 10.5523 21 10 21H8C5.23858 21 3 18.7614 3 16V8C3 5.23858 5.23858 3 8 3Z" stroke="currentColor" stroke-width="1.5"/>
                      <path d="M21 7L15 13L14 16L17 15L23 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Note
                  </button>
                  <button id="archive-btn" class="action-btn" title="Archive">
                    <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 21L12 12M12 12L15 15.3333M12 12L9 15.3333" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M20.5 7V13C20.5 16.7712 20.5 18.6569 19.3284 19.8284C18.1569 21 16.2712 21 12.5 21H11.5C7.72876 21 5.84315 21 4.67157 19.8284C3.5 18.6569 3.5 16.7712 3.5 13V7" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M2 5C2 4.05719 2 3.58579 2.29289 3.29289C2.58579 3 3.05719 3 4 3H20C20.9428 3 21.4142 3 21.7071 3.29289C22 3.58579 22 4.05719 22 5C22 5.94281 22 6.41421 21.7071 6.70711C21.4142 7 20.9428 7 20 7H4C3.05719 7 2.58579 7 2.29289 6.70711C2 6.41421 2 5.94281 2 5Z" stroke="currentcolor" stroke-width="1.5"/>
                    </svg> Archive
                  </button>
                  <button id="delete-btn" class="action-btn" title="Delete">
                    <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9.17065 4C9.58249 2.83481 10.6937 2 11.9999 2C13.3062 2 14.4174 2.83481 14.8292 4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M20.5 6H3.49988" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5M18.8334 8.5L18.6334 11.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M9.5 11L10 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M14.5 11L14 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                    </svg> Delete
                  </button>
                </div>
                
                <!-- Right Group: Menu -->
                <div class="col-dropdowns d-flex gap-2">
                  <!-- Columns Dropdown -->
                  <div class="columns-dropdown position-relative" style = "display:none;">
                    <button type="button" class="columns-dropdown-btn dropdown-cstm"><span>Columns</span></button>
                    <div class="dropdown-panel columns-panel custom-dropdown hidden">
                      <label><input type="checkbox" value="salary"> Salary</label>
                      <label><input type="checkbox" value="location"> Location</label>
                      <label><input type="checkbox" value="date-posted"> Date Posted</label>
                      <label><input type="checkbox" value="deadline"> Deadline</label>
                      <label><input type="checkbox" value="date-applied"> Date Applied</label>
                      <label><input type="checkbox" value="excitement"> Score</label>
                    </div>
                  </div>

                  <!-- Menu Dropdown -->
                  <div class="menu-dropdown position-relative">
                    <button type="button" class="menu-dropdown-btn dropdown-cstm"><span>Menu</span></button>
                    <div class="dropdown-panel menu-panel custom-dropdown hidden">
                      <div class="menu-item"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g id="Warning / Info">
                        <path id="Vector" d="M12 11V16M12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21ZM12.0498 8V8.1L11.9502 8.1002V8H12.0498Z" stroke="#121C0C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </g>
                        </svg> Quick Tour</div>
                      <a href="{{ path('app_provider_jobs_archived') }}" class="menu-item" style="text-decoration: none; color: inherit;"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path opacity="0.5" d="M20.5 7V13C20.5 16.7712 20.5 18.6569 19.3284 19.8284C18.1569 21 16.2712 21 12.5 21H11.5C7.72876 21 5.84315 21 4.67157 19.8284C3.5 18.6569 3.5 16.7712 3.5 13V7" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M2 5C2 4.05719 2 3.58579 2.29289 3.29289C2.58579 3 3.05719 3 4 3H20C20.9428 3 21.4142 3 21.7071 3.29289C22 3.58579 22 4.05719 22 5C22 5.94281 22 6.41421 21.7071 6.70711C21.4142 7 20.9428 7 20 7H4C3.05719 7 2.58579 7 2.29289 6.70711C2 6.41421 2 5.94281 2 5Z" stroke="#121C0C" stroke-width="1.5"/>
                        <path d="M12 7L12 16M12 16L15 12.6667M12 16L9 12.6667" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg> Archived Jobs</a>
                      <div class="menu-item"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16.44 8.8999C20.04 9.2099 21.51 11.0599 21.51 15.1099V15.2399C21.51 19.7099 19.72 21.4999 15.25 21.4999H8.73998C4.26998 21.4999 2.47998 19.7099 2.47998 15.2399V15.1099C2.47998 11.0899 3.92998 9.2399 7.46998 8.9099" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 15.0001V3.62012" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M15.35 5.85L12 2.5L8.65002 5.85" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg> Export Report</div>
                      <div class="menu-item" id="download-data-btn" style="cursor: pointer;"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16.44 8.8999C20.04 9.2099 21.51 11.0599 21.51 15.1099V15.2399C21.51 19.7099 19.72 21.4999 15.25 21.4999H8.73998C4.26998 21.4999 2.47998 19.7099 2.47998 15.2399V15.1099C2.47998 11.0899 3.92998 9.2399 7.46998 8.9099" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 15.0001V3.62012" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M15.35 5.85L12 2.5L8.65002 5.85" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg> Download Data</div>
                    </div>
                  </div>
                </div>
            </div>

            {% if applications|length > 0 %}
            <div class="job-list-container bg-light p-3 rounded-3">
            <div class="table-responsive-wrapper" style="overflow-x: auto; width: 100%;">
            <div class="d-flex align-items-center job-lists">
                <div class="d-flex align-items-center flex-grow-1" style="width: 100%; min-width: 0;">
                    <div class="job-header d-flex align-items-center fw-semibold py-2 flex-grow-1" style="width: 100%; min-width: 0; gap: 0;">
                        <div class="col-check" style="width: 30px; flex-shrink: 0; padding: 0 4px; box-sizing: border-box; display: flex; align-items: center; min-width: 0; overflow: hidden;">
                            <input type="checkbox" id="select-all-checkbox" class="job-check" title="Select All" />
                        </div>
                        <div class="col-job sortable" data-sort="job" style="width: 200px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; cursor: pointer;">Job<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                <div class="col-start col-center sortable" data-sort="location" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">Location<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                <div class="col-start col-center sortable" data-sort="salary" style="width: 80px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">Salary<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                <div class="col-start col-center sortable" data-sort="category" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">Category<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                        {% if app.request.get('status') not in ['interview', 'hired', 'completed'] %}
                        <div class="col-start col-center sortable" data-sort="applied" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">Applied on<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                        <div class="col-start col-center col-rank sortable" data-sort="rank" style="width: 70px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; padding: 0 8px; box-sizing: border-box; cursor: pointer;"><span style="font-size: 13px; font-weight: bold; line-height: 1.2;">Score</span><span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                        {% endif %}
                        {% if app.request.get('status') not in ['applied', 'hired', 'completed'] %}
                        <div class="col-start col-center sortable" data-sort="todo" style="width: 80px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">To Do<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                        <div class="col-start col-center sortable" data-sort="interview" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; white-space: nowrap; cursor: pointer;">Interview date<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                        {% endif %}            
                        <div class="col-start col-center sortable" data-sort="status" style="width: 140px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">Status<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
                    </div>
                </div>
            </div>

            {% for application in applications %}
            {% set job = application.job %}
              <div class="d-flex align-items-center job-lists">
                <div class="job-row d-flex align-items-center flex-grow-1" style="gap: 0; min-width: 0; width: 100%;">
                  <div class="col-check" style="width: 30px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center;">
                      <input type="checkbox" class="job-check job-checkbox" data-application-id="{{ application.id }}" />
                  </div>
                  <div class="col-job d-flex align-items-center gap-2" style="width: 200px; flex-shrink: 0; padding: 0 4px; box-sizing: border-box; min-width: 0; overflow: hidden;">
                      <img src="{{ job.companyLogo|default(asset('assets/icons/job.png')) }}"
                          alt="Logo"
                          style="width: 40px; height: 40px; border-radius: 8px;" />
                      <div style="min-width: 0; overflow: hidden;">
                          <a class="job-title truncate-text d-block fw-semibold text-decoration-none"
                            href="{{ path('app_provider_jobs_application_detail', {'id': application.id}) }}"
                            style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px;">
                              {{ job.title }}
                          </a>
                      </div>
                  </div>
                  <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.state }}</div>
                  <div class="col-start col-center" style="width: 80px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
                      {# UPDATED: Use formattedSalary instead of payRateHourly #}
                      {{ job.formattedSalary }}
                  </div>
                  <div class="col-start col-center" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
                      <select class="category-select" style="width: 100%; padding: 4px 8px; border: 1px solid #e6eef6; border-radius: 6px; background-color: #fff; cursor: pointer; font-size: 11px; color: #121C0C;">
                          <option value="locums">Locums</option>
                          <option value="parttime">Parttime</option>
                          <option value="fulltime">Full time</option>
                      </select>
                  </div>
                  {% if app.request.get('status') not in ['interview', 'hired', 'completed'] %}
                  <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ application.createdAt|date('m/d/Y') }}</div>
                  {% endif %}
                  {% if app.request.get('status') not in ['interview', 'hired', 'completed'] %}
                  <div class="col-start col-center col-rank" style="width: 70px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
                      <span class="rank-display" data-application-id="{{ application.id }}">
                        {{ application.rank is not null ? application.rank ~ '/10' : '' }}
                      </span>
                      <input type="number"
                            class="rank-input hidden"
                            value="{{ application.rank is not null ? application.rank : '' }}"
                            min="1"
                            max="10"
                            step="0.5"
                            data-application-id="{{ application.id }}"
                            data-original-value="{{ application.rank is not null ? application.rank : '' }}"
                            style="width: 60px; text-align:center; border: 1px solid #ccc; border-radius: 6px; padding: 2px 4px;"
                            oninput="if(this.value>10) this.value=10; if(this.value<1)this.value=1;" />
                    </div>
                  {% endif %}
                  {% if app.request.get('status') not in ['applied', 'hired', 'completed'] %}
                  <div class="col-start col-center" style="width: 80px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
                      {% if application.status == 'interview' %}
                      <span class="badge badge-pill">
                      To Do Actions
                      </span>
                      {% else %}
                      
                      {% endif %}
                  </div>
                  <div class="col-start col-center" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
                      {% if application.status == 'interview' %}
                      06/14/2025
                      {% else %}
                      
                      {% endif %}
                  </div>
                  {% endif %}
                  <div class="col-start col-center" style="width: 140px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
                      {{ application.status | replace({'_': ' '}) | title }}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
            </div>
        </div>
        {% else %}
            <p>Applications not found.</p>
        {% endif %}
        <div class="job-actions hidden-buttons ml-15-px" style="margin-bottom: 20px; display: flex; gap: 8px; align-items: center; visibility: hidden;">
          <button id="save-btn-bottom" class="action-btn" title="Save">
            <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 10.5V12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2H13.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="19" cy="5" r="3" stroke="#1C274C" stroke-width="1.5"/>
            <path d="M7 14H16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M7 17.5H13" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </button>
        {% if app.request.get('status') not in ['saved', 'interview', 'negotiating', 'accepted', 'completed'] %}
            <button id="apply-btn" class="action-btn" disabled title="Apply">
            <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <g data-name="Layer 2">
            <g data-name="checkmark-circle">
            <rect width="24" height="24" opacity="0"/>
            <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
            <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
            </g>
            </g>
            </svg>
          </button>
        {% endif %}
        {% if app.request.get('status') not in ['saved', 'applied', 'negotiating', 'accepted', 'completed'] %}
          <button id="email-btn" class="action-btn" title="Email">
            <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="style=stroke">
            <g id="email">
            <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="currentColor"></path>
            <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="currentcolor"></path>
            </g>
            </g>
            </svg>
          </button>
        {% endif %}
        {% if app.request.get('status') not in ['saved', 'applied', 'interview', 'accepted', 'completed'] %}
          <button id="apply-btn" class="action-btn" disabled title="Apply">
            <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <g data-name="Layer 2">
            <g data-name="checkmark-circle">
            <rect width="24" height="24" opacity="0"/>
            <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
            <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
            </g>
            </g>
            </svg>
          </button>
        {% endif %}
        {% if app.request.get('status') not in ['saved', 'applied', 'interview', 'negotiating', 'completed'] %}
          <button id="apply-btn" class="action-btn" disabled title="Apply">
            <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <g data-name="Layer 2">
            <g data-name="checkmark-circle">
            <rect width="24" height="24" opacity="0"/>
            <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
            <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
            </g>
            </g>
            </svg>
          </button>
        {% endif %}
        {% if app.request.get('status') not in ['saved', 'applied', 'interview', 'negotiating', 'accepted'] %}
          <button id="apply-btn" class="action-btn" disabled title="Apply">
            <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <g data-name="Layer 2">
            <g data-name="checkmark-circle">
            <rect width="24" height="24" opacity="0"/>
            <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
            <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
            </g>
            </g>
            </svg>
          </button>
        {% endif %}
          <button id="email-btn" class="action-btn" title="Email">
            <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g id="style=stroke">
            <g id="email">
            <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="currentColor"></path>
            <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="currentcolor"></path>
            </g>
            </g>
            </svg>
          </button>
          <button id="delete-btn-bottom" class="action-btn" title="Delete">
            <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9.17065 4C9.58249 2.83481 10.6937 2 11.9999 2C13.3062 2 14.4174 2.83481 14.8292 4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M20.5 6H3.49988" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5M18.8334 8.5L18.6334 11.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M9.5 11L10 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M14.5 11L14 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </button>
          <button id="archive-btn" class="action-btn" title="Archive">
            <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 21L12 12M12 12L15 15.3333M12 12L9 15.3333" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M20.5 7V13C20.5 16.7712 20.5 18.6569 19.3284 19.8284C18.1569 21 16.2712 21 12.5 21H11.5C7.72876 21 5.84315 21 4.67157 19.8284C3.5 18.6569 3.5 16.7712 3.5 13V7" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M2 5C2 4.05719 2 3.58579 2.29289 3.29289C2.58579 3 3.05719 3 4 3H20C20.9428 3 21.4142 3 21.7071 3.29289C22 3.58579 22 4.05719 22 5C22 5.94281 22 6.41421 21.7071 6.70711C21.4142 7 20.9428 7 20 7H4C3.05719 7 2.58579 7 2.29289 6.70711C2 6.41421 2 5.94281 2 5Z" stroke="currentcolor" stroke-width="1.5"/>
            </svg>
          </button>
        </div>
    </div>
</div>

    <!-- Send Contract Modal -->
    <div class="modal fade" id="contractModal" tabindex="-1" role="dialog" aria-labelledby="contractModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contractModalLabel">Send Contract</h5>
                </div>
                <form method="post" action="" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="form-group">
                            <input type="file" name="contractFile" required />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Send</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block footer_scripts %}
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function() {
            $('#contractModal').on('show.bs.modal', function(event) {
                var button = $(event.relatedTarget); // Button that triggered the modal
                var applicationId = button.data('application_id'); // Get application ID
                var form = $(this).find('form'); // Find the form inside the modal
                var actionUrl = "{{ path('app_provider_application_sendcontract', {'id': 'APPLICATION_ID'}) }}".replace('APPLICATION_ID', applicationId);
                form.attr('action', actionUrl); // Set the form action
            });
        });
    </script>
    <script>
document.addEventListener('DOMContentLoaded', function () {
    const checkboxes = document.querySelectorAll('.job-checkbox');
    const saveBtn = document.getElementById('save-btn');
    const saveBtnBottom = document.getElementById('save-btn-bottom');
    const deleteBtn = document.getElementById('delete-btn');
    const deleteBtnBottom = document.getElementById('delete-btn-bottom');
    const actionsDivs = document.querySelectorAll('.hidden-buttons');
    const selectAllCheckbox = document.getElementById('select-all-checkbox');
    const columnsBtn = document.querySelector('.columns-dropdown-btn');
    const menuBtn = document.querySelector('.menu-dropdown-btn');
    const columnsPanel = document.querySelector('.columns-panel');
    const menuPanel = document.querySelector('.menu-panel');
    const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
    const confirmHireBtn = document.getElementById('confirm-hire-btn');
    const deleteForm = document.getElementById('delete-applications-form');
    const applicationIdsInput = document.getElementById('application-ids-input');

    let selectedApplicationId = null;

    // Notify Hire functionality
    if (saveBtn) {
        saveBtn.addEventListener('click', function() {
            const selectedApplications = Array.from(checkboxes)
                .filter(cb => cb.checked)
                .map(cb => cb.dataset.applicationId);

            if (selectedApplications.length === 0) {
                showMessage('Please select at least one application to mark as hired.', 'error');
                return;
            }

            if (selectedApplications.length > 1) {
                showMessage('Please select only one application to mark as hired at a time.', 'error');
                return;
            }

            selectedApplicationId = selectedApplications[0];
            
            // Show hire confirmation modal
            const hireModal = new bootstrap.Modal(document.getElementById('hireConfirmModal'));
            hireModal.show();
        });
    }

    if (saveBtnBottom) {
        saveBtnBottom.addEventListener('click', function() {
            const selectedApplications = Array.from(checkboxes)
                .filter(cb => cb.checked)
                .map(cb => cb.dataset.applicationId);

            if (selectedApplications.length === 0) {
                showMessage('Please select at least one application to mark as hired.', 'error');
                return;
            }

            if (selectedApplications.length > 1) {
                showMessage('Please select only one application to mark as hired at a time.', 'error');
                return;
            }

            selectedApplicationId = selectedApplications[0];
            
            const hireModal = new bootstrap.Modal(document.getElementById('hireConfirmModal'));
            hireModal.show();
        });
    }

    // Confirm hire button handler
    if (confirmHireBtn) {
        confirmHireBtn.addEventListener('click', function() {
            if (!selectedApplicationId) return;

            // Show loading state
            const originalText = confirmHireBtn.innerHTML;
            confirmHireBtn.disabled = true;
            confirmHireBtn.innerHTML = '<span class="loading-spinner"></span> Processing...';

            // Use AJAX instead of form submission
            fetch(`/provider/applications/${selectedApplicationId}/hire`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token-hire"]').getAttribute('content')
                },
                body: JSON.stringify({})
            })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url;
                    return;
                }
                return response.json();
            })
            .then(data => {
                // Close modal first
                const hireModal = bootstrap.Modal.getInstance(document.getElementById('hireConfirmModal'));
                hireModal.hide();

                // Reset button state
                confirmHireBtn.disabled = false;
                confirmHireBtn.innerHTML = originalText;

                if (data && data.success) {
                    showMessage(data.message || 'Application marked as hired successfully!', 'success');
                    
                    // Remove the hired application from the current view
                    removeApplicationFromView(selectedApplicationId);
                    
                    // Update the counts in the status cards
                    updateStatusCounts();
                    
                    // Uncheck all checkboxes
                    checkboxes.forEach(cb => cb.checked = false);
                    toggleActionsVisibility();
                    
                } else if (data && !data.success) {
                    showMessage(data.message || 'Failed to mark application as hired.', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                
                const hireModal = bootstrap.Modal.getInstance(document.getElementById('hireConfirmModal'));
                hireModal.hide();
                
                confirmHireBtn.disabled = false;
                confirmHireBtn.innerHTML = originalText;
                
                showMessage('Error marking application as hired. Please try again.', 'error');
            });
        });
    }

    // Delete functionality
    function handleDelete() {
        const selectedApplications = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.dataset.applicationId);

        if (selectedApplications.length === 0) {
            showMessage('Please select at least one application to delete.', 'error');
            return;
        }

        applicationIdsInput.value = JSON.stringify(selectedApplications);
        
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
        deleteModal.show();
    }

    // Delete button click handlers
    if (deleteBtn) deleteBtn.addEventListener('click', handleDelete);
    if (deleteBtnBottom) deleteBtnBottom.addEventListener('click', handleDelete);

    // Confirm delete button in modal
    if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', () => {
            deleteForm.submit();
        });
    }

    // Dropdown functionality
    function toggleDropdown(panel, btn) {
        const isOpen = !panel.classList.contains('hidden');
        closeAllDropdowns();
        if (!isOpen) panel.classList.remove('hidden');
    }

    function closeAllDropdowns() {
        columnsPanel.classList.add('hidden');
        menuPanel.classList.add('hidden');
    }

    if (columnsBtn) {
        columnsBtn.addEventListener('click', e => {
            e.stopPropagation();
            toggleDropdown(columnsPanel, columnsBtn);
        });
    }

    if (menuBtn) {
        menuBtn.addEventListener('click', e => {
            e.stopPropagation();
            toggleDropdown(menuPanel, menuBtn);
        });
    }

    document.addEventListener('click', e => {
        if (!columnsPanel.contains(e.target) && !columnsBtn.contains(e.target) && !menuPanel.contains(e.target) && !menuBtn.contains(e.target)) {
            closeAllDropdowns();
        }
    });

    // Checkbox functionality
    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function () {
            checkboxes.forEach(cb => {
                cb.checked = selectAllCheckbox.checked;
            });
            toggleActionsVisibility();
            updateActions();
        });

        checkboxes.forEach(cb => {
            cb.addEventListener('change', function () {
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                selectAllCheckbox.checked = allChecked;
                toggleActionsVisibility();
                updateActions();
            });
        });
    }

    function toggleActionsVisibility() {
        const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
        const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
        actionsDivs.forEach(div => {
            div.style.visibility = anyChecked ? 'visible' : 'hidden';
        });
        
        // Show/hide conditional buttons based on selection
        const conditionalButtons = document.querySelectorAll('.conditional-btn');
        conditionalButtons.forEach(btn => {
            btn.style.display = anyChecked ? 'flex' : 'none';
        });
        
        // Show/hide Note button (show when job details are viewed)
        const noteBtn = document.getElementById('note-btn');
        if (noteBtn) {
            const hasJobDetailsOpen = window.selectedJobId !== null && window.selectedJobId !== undefined;
            const activeCard = document.querySelector('.split-job-card.active');
            const hasActiveCard = activeCard !== null;
            const jobDetailContent = document.getElementById('job-detail-content');
            const hasJobDetailContent = jobDetailContent && jobDetailContent.style.display !== 'none' && jobDetailContent.innerHTML.trim() !== '';
            
            noteBtn.style.display = (hasJobDetailsOpen || hasActiveCard || hasJobDetailContent) ? 'flex' : 'none';
        }
    }

    checkboxes.forEach(cb => {
        cb.addEventListener('change', toggleActionsVisibility);
    });

    function updateActions() {
        const checked = Array.from(checkboxes).filter(cb => cb.checked);
        const anyChecked = checked.length > 0;
        
        // Enable/disable conditional buttons
        const conditionalButtons = document.querySelectorAll('.conditional-btn');
        conditionalButtons.forEach(btn => {
            btn.disabled = !anyChecked;
        });
    }

    checkboxes.forEach(cb => {
        cb.addEventListener('change', updateActions);
    });

    // Initial check in case some boxes are pre-checked
    toggleActionsVisibility();
    updateActions();
});

// Function to show success/error message
function showMessage(message, type = 'success') {
    const messageId = type === 'success' ? 'success-message' : 'error-message';
    let messageEl = document.getElementById(messageId);
    
    if (!messageEl) {
        messageEl = document.createElement('div');
        messageEl.id = messageId;
        messageEl.className = type === 'success' ? 'success-message' : 'error-message';
        document.body.appendChild(messageEl);
    }
    
    messageEl.textContent = message;
    messageEl.style.display = 'block';
    
    setTimeout(() => {
        messageEl.style.display = 'none';
    }, 3000);
}

// Function to remove application from current view
function removeApplicationFromView(applicationId) {
    const applicationRow = document.querySelector(`.job-checkbox[data-application-id="${applicationId}"]`)?.closest('.job-lists');
    if (applicationRow) {
        applicationRow.remove();
    }
    
    // If no applications left, show "not found" message
    const remainingApplications = document.querySelectorAll('.job-lists .job-checkbox');
    const notFoundMessage = document.querySelector('.job-list-container p');
    if (remainingApplications.length === 0 && !notFoundMessage) {
        const jobListContainer = document.querySelector('.job-list-container');
        jobListContainer.innerHTML = '<p>Applications not found.</p>';
    }
}

// Function to update status counts
function updateStatusCounts() {
    // This would ideally make an AJAX call to get updated counts
    console.log('Status counts should be updated here');
}

// Handle Note button click
function handleNoteClick() {
    let jobId = null;
    
    if (window.selectedJobId) {
        jobId = window.selectedJobId;
    } else {
        const activeCard = document.querySelector('.split-job-card.active');
        if (activeCard) {
            jobId = activeCard.dataset.jobId;
        }
    }
    
    if (!jobId) {
        const jobDetailContent = document.querySelector('.job-detail-content');
        if (jobDetailContent) {
            const jobIdAttr = jobDetailContent.getAttribute('data-job-id');
            if (jobIdAttr) {
                jobId = jobIdAttr;
            }
        }
    }
    
    if (!jobId) {
        const single = Array.from(document.querySelectorAll('.job-checkbox')).filter(cb => cb.checked);
        if (single.length === 1) {
            jobId = single[0].dataset.applicationId;
        }
    }
    
    if (jobId) {
        if (typeof openNotesPanel === 'function') {
            openNotesPanel(jobId);
        } else {
            console.log('Opening notes for job:', jobId);
        }
    }
}

// Add event listener for detail-note-btn when job details are loaded
document.addEventListener('DOMContentLoaded', function() {
    document.addEventListener('click', function(e) {
        if (e.target.closest('#detail-note-btn')) {
            handleNoteClick();
        }
    });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const rankDisplays = document.querySelectorAll('.rank-display');
    const rankInputs = document.querySelectorAll('.rank-input');

    function saveRank(input) {
        let value = parseFloat(input.value);
        const applicationId = input.dataset.applicationId;

        if (isNaN(value)) {
            showMessage('Score must be a number between 1 and 10.', 'error');
            input.value = input.dataset.originalValue || '';
            return;
        }

        // Clamp and round to nearest 0.5
        if (value < 1) value = 1;
        if (value > 10) value = 10;
        value = Math.round(value * 2) / 2;

        if (value === parseFloat(input.dataset.originalValue)) {
            input.classList.add('hidden');
            input.previousElementSibling.classList.remove('hidden');
            return;
        }

        // AJAX request
        fetch('{{ path("app_update_application_rank") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({ applicationId, rank: value })
        })
        .then(res => res.json())
        .then(data => {
            const display = input.previousElementSibling;
            if (data.success) {
                display.textContent = value + '/10';
                input.dataset.originalValue = value;
                input.classList.add('hidden');
                display.classList.remove('hidden');
                showMessage('Score updated successfully!', 'success');
            } else {
                showMessage('Failed to update score: ' + (data.message || 'Unknown error'), 'error');
                input.value = input.dataset.originalValue || '';
            }
        })
        .catch(err => {
            console.error('Fetch error:', err);
            showMessage('Server error while updating score.', 'error');
            input.value = input.dataset.originalValue || '';
        });
    }

    // Initialize original values
    rankInputs.forEach(input => input.dataset.originalValue = input.value || '');

    // Click to edit
    rankDisplays.forEach(display => {
        display.addEventListener('click', function () {
            const input = this.nextElementSibling;
            input.classList.remove('hidden');
            this.classList.add('hidden');
            input.focus();
            input.select();
        });
    });

    // Blur & key events
    rankInputs.forEach(input => {
        input.addEventListener('blur', () => saveRank(input));
        input.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                saveRank(input);
            }
            if (e.key === 'Escape') {
                const display = input.previousElementSibling;
                input.value = input.dataset.originalValue || '';
                input.classList.add('hidden');
                display.classList.remove('hidden');
            }
        });
    });
});

// Download Data button handler
document.addEventListener('DOMContentLoaded', function() {
    const downloadDataBtn = document.getElementById('download-data-btn');
    if (downloadDataBtn) {
        downloadDataBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // Show loading state
            const originalText = downloadDataBtn.innerHTML;
            downloadDataBtn.innerHTML = '<span>Downloading...</span>';
            downloadDataBtn.style.opacity = '0.6';
            downloadDataBtn.style.pointerEvents = 'none';
            
            // Get current status filter from URL
            const urlParams = new URLSearchParams(window.location.search);
            const status = urlParams.get('status') || '';
            
            // Build download URL with type and status
            let downloadUrl = '{{ path("app_provider_download_data", {"type": "applications"}) }}';
            if (status) {
                downloadUrl += '&status=' + encodeURIComponent(status);
            }
            
            // Trigger download with page type and status
            window.location.href = downloadUrl;
            
            // Reset button after a delay
            setTimeout(function() {
                downloadDataBtn.innerHTML = originalText;
                downloadDataBtn.style.opacity = '1';
                downloadDataBtn.style.pointerEvents = 'auto';
            }, 2000);
        });
    }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const archiveBtn = document.getElementById("archive-btn");

    archiveBtn.addEventListener("click", async function () {
        // 1 Collect selected application IDs
        const selectedIds = Array.from(document.querySelectorAll(".job-check.job-checkbox:checked"))
                                 .map(cb => cb.dataset.applicationId);

        if (selectedIds.length === 0) {
            showMessage("Please select at least one application to archive.", "error");
            return;
        }

        if (!confirm(`Are you sure you want to archive ${selectedIds.length} application(s)?`)) return;

        try {
            // 2 Send archive request
            const response = await fetch("/provider/application/archive/bulk", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ ids: selectedIds })
            });

            const result = await response.json();

            if (result.success) {
                showMessage(result.message, "success");

                // 3 Remove archived rows from DOM
                selectedIds.forEach(id => {
                    const checkbox = document.querySelector(`.job-check.job-checkbox[data-application-id="${id}"]`);
                    if (checkbox) {
                        const row = checkbox.closest(".job-lists");
                        if (row) row.remove();
                    }
                });

                //  Optional: reset "Select All" checkbox if you have one
                const selectAll = document.getElementById('select-all-checkbox');
                if (selectAll) selectAll.checked = false;

            } else {
                showMessage(result.message || "Something went wrong.", "error");
            }
        } catch (error) {
            console.error("Error archiving applications:", error);
            showMessage("An error occurred while archiving applications.", "error");
        }
    });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const headers = document.querySelectorAll('.sortable');
  let currentSort = { key: null, direction: 'asc' };

  headers.forEach(header => {
    header.addEventListener('click', () => {
      const key = header.dataset.sort;
      const direction = (currentSort.key === key && currentSort.direction === 'asc') ? 'desc' : 'asc';
      currentSort = { key, direction };

      // Reset all arrows to inactive
      document.querySelectorAll('.sort-toggle .arrow').forEach(a => a.classList.remove('active'));
      // Activate the appropriate arrow on current header
      const up = header.querySelector('.sort-toggle .sort-up');
      const down = header.querySelector('.sort-toggle .sort-down');
      if (direction === 'asc' && up) up.classList.add('active');
      if (direction === 'desc' && down) down.classList.add('active');

      sortApplications(key, direction);
    });
  });

  function sortApplications(key, direction) {
    const rows = Array.from(document.querySelectorAll('.job-row')).map(row => {
      const cells = Array.from(row.children);
      // Structure: [0]checkbox, [1]job, [2]location, [3]salary, [4]category, [5]applied(cond), [6]rank(cond), [7]todo(cond), [8]interview(cond), [9]status
      
      // Find cells by their content/class rather than index since columns are conditional
      const locationCell = cells.find(c => c.classList.contains('col-start') && c.classList.contains('col-center') && c.textContent.trim() && !c.querySelector('select') && c !== cells[1]);
      const salaryCell = cells.find(c => c.classList.contains('col-start') && c.classList.contains('col-center') && c !== locationCell && !c.querySelector('select') && c !== cells[1]);
      const categoryCell = row.querySelector('.category-select')?.parentElement;
      const appliedCell = cells.find(c => c.textContent.trim().match(/\d{2}\/\d{2}\/\d{4}/) && c !== salaryCell && c !== locationCell);
      const rankCell = row.querySelector('.col-rank');
      const todoCell = cells.find(c => c.textContent.trim() && c !== locationCell && c !== salaryCell && c !== appliedCell && c !== rankCell && !c.querySelector('select') && !c.classList.contains('col-job'));
      const interviewCell = cells.find(c => c.textContent.trim() && c !== locationCell && c !== salaryCell && c !== appliedCell && c !== rankCell && c !== todoCell && !c.querySelector('select') && !c.classList.contains('col-job'));
      // Status is the last cell with text content that's not a checkbox, select, or other special cell
      const statusCell = Array.from(cells).reverse().find(c => {
        const text = c.textContent.trim();
        const hasStatusText = text && 
               (text.match(/^(Applied|Interview|Hired|Rejected|Saved|In Review|Offered|Completed)$/i) ||
                (text.length > 0 && !text.match(/^\d+$/) && !text.match(/^\d+\/\d+\/\d+$/) && text !== '' && text !== 'To Do Actions'));
        return hasStatusText &&
               !c.querySelector('select') && 
               !c.querySelector('input[type="checkbox"]') && 
               !c.querySelector('.job-title') &&
               !c.querySelector('.rank-display') &&
               !c.querySelector('.rank-input') &&
               c !== locationCell && 
               c !== salaryCell && 
               c !== appliedCell && 
               c !== rankCell && 
               c !== todoCell && 
               c !== interviewCell;
      });
      
      return {
        element: row,
        job: {
          job: row.querySelector('.job-title')?.textContent.trim().toLowerCase() || '',
          location: locationCell?.textContent.trim().toLowerCase() || '',
          salary: parseFloat(salaryCell?.textContent.trim().replace(/[^0-9.]/g, '')) || 0,
          category: row.querySelector('.category-select')?.value?.toLowerCase() || categoryCell?.textContent.trim().toLowerCase() || '',
          applied: appliedCell?.textContent.trim() || '',
          rank: parseInt(rankCell?.textContent.trim()) || 0,
          todo: todoCell?.textContent.trim() || '',
          interview: interviewCell?.textContent.trim() || '',
          status: statusCell?.textContent.trim().toLowerCase() || ''
        }
      };
    });

    rows.sort((a, b) => {
      const valA = a.job[key];
      const valB = b.job[key];
      if (typeof valA === 'string') {
        return direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
      } else {
        return direction === 'asc' ? valA - valB : valB - valA;
      }
    });

    const container = document.querySelector('.job-list-container');
    if (container) {
      rows.forEach(row => {
        if (row.element && row.element.parentElement) {
          container.appendChild(row.element.parentElement);
        }
      });
    }
  }
});
</script>

<script>
// Filter functionality
document.addEventListener('DOMContentLoaded', function() {
  const filterBtn = document.getElementById('filter-btn');
  const filterPanel = document.getElementById('filter-panel');
  const applyFilterBtn = document.getElementById('apply-filter-btn');
  const clearFilterBtn = document.getElementById('clear-filter-btn');
  
  if (!filterBtn || !filterPanel) return;
  
  // Toggle filter panel
  filterBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    filterPanel.classList.toggle('hidden');
  });
  
  // Close filter panel when clicking outside
  document.addEventListener('click', function(e) {
    if (!filterPanel.contains(e.target) && !filterBtn.contains(e.target)) {
      filterPanel.classList.add('hidden');
    }
  });
  
  // Apply filters
  applyFilterBtn.addEventListener('click', function() {
    applyFilters();
    filterPanel.classList.add('hidden');
  });
  
  // Clear filters
  clearFilterBtn.addEventListener('click', function() {
    document.getElementById('filter-location').value = '';
    document.getElementById('filter-salary-min').value = '';
    document.getElementById('filter-salary-max').value = '';
    document.getElementById('filter-category').value = '';
    const dateApplied = document.getElementById('filter-date-applied');
    if (dateApplied) dateApplied.value = '';
    applyFilters();
    filterPanel.classList.add('hidden');
  });
  
  function applyFilters() {
    const locationFilter = document.getElementById('filter-location').value.toLowerCase().trim();
    const salaryMin = parseFloat(document.getElementById('filter-salary-min').value) || 0;
    const salaryMax = parseFloat(document.getElementById('filter-salary-max').value) || Infinity;
    const categoryFilter = document.getElementById('filter-category').value.toLowerCase();
    const dateAppliedFilter = document.getElementById('filter-date-applied')?.value || '';
    
    const rows = document.querySelectorAll('.job-row');
    const now = new Date();
    
    rows.forEach(row => {
      let show = true;
      const cells = Array.from(row.children);
      
      // Location filter
      if (locationFilter && show) {
        const locationCell = cells.find(c => c.classList.contains('col-start') && c.classList.contains('col-center') && c.textContent.trim() && !c.querySelector('select') && c !== cells[1]);
        const location = locationCell?.textContent.trim().toLowerCase() || '';
        if (!location.includes(locationFilter)) {
          show = false;
        }
      }
      
      // Salary filter
      if (show && (salaryMin > 0 || salaryMax < Infinity)) {
        const salaryCell = cells.find(c => c.classList.contains('col-start') && c.classList.contains('col-center') && c !== cells[1] && !c.querySelector('select'));
        const salaryText = salaryCell?.textContent.trim() || '';
        const salary = parseFloat(salaryText.replace(/[^0-9.]/g, '')) || 0;
        if (salary < salaryMin || salary > salaryMax) {
          show = false;
        }
      }
      
      // Category filter
      if (show && categoryFilter) {
        const categorySelect = row.querySelector('.category-select');
        const category = categorySelect ? categorySelect.value.toLowerCase() : '';
        if (category !== categoryFilter) {
          show = false;
        }
      }
      
      // Date applied filter
      if (show && dateAppliedFilter) {
        const appliedCell = cells.find(c => c.textContent.trim().match(/\d{2}\/\d{2}\/\d{4}/) && c !== cells[1]);
        if (appliedCell) {
          const appliedText = appliedCell.textContent.trim();
          const appliedDate = parseDate(appliedText);
          if (appliedDate) {
            const daysDiff = Math.floor((now - appliedDate) / (1000 * 60 * 60 * 24));
            if (daysDiff > parseInt(dateAppliedFilter)) {
              show = false;
            }
          }
        }
      }
      
      // Show/hide row
      const rowWrapper = row.closest('.job-lists') || row.parentElement;
      if (rowWrapper) {
        rowWrapper.style.display = show ? '' : 'none';
      }
    });
  }
  
  function parseDate(dateStr) {
    // Parse MM/DD/YYYY format
    const parts = dateStr.match(/(\d{2})\/(\d{2})\/(\d{4})/);
    if (parts) {
      return new Date(parseInt(parts[3]), parseInt(parts[1]) - 1, parseInt(parts[2]));
    }
    return null;
  }
});
</script>
{% endblock %}