{% extends 'provider/base.html.twig' %}

{% block title %}Saved Jobs{% endblock %}

{% block provider_body %}
{# Intro.js CSS & JS for Quick Tour #}
<link rel="stylesheet" href="https://unpkg.com/intro.js/minified/introjs.min.css">
<script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>
<style>
/* COMPLETE RESET - Remove ALL conflicting styles and apply clean spacing to match dashboard */

/* Reset app-wrapper - remove all custom.css overrides */
body.app .app-wrapper,
.app-wrapper {
    display: block !important;
    justify-content: unset !important;
    align-items: unset !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
}

/* Shift app-wrapper to the left to eliminate gap */
@media (min-width: 1200px) {
    body.app .app-wrapper,
    .app-wrapper {
        margin-left: 250px !important;
        transform: translateX(-150px) !important;
        width: calc(100% - 250px + 150px) !important;
    }
}

/* Reset app-content - remove all custom.css overrides */
body.app .app-wrapper .app-content,
.app-wrapper .app-content,
.app-content {
    padding-left: 0 !important;
    padding-right: 0 !important;
    padding-top: 20px !important;
    padding-bottom: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    position: relative !important;
    box-sizing: border-box !important;
    overflow: visible; /* Allow dropdowns to extend beyond content */
}

/* Override custom.css width constraints at 1200px breakpoint */
@media (min-width: 1200px) {
    body.app .app-wrapper .app-content,
    .app-wrapper .app-content,
    .app-content {
        width: 100% !important;
        max-width: 100% !important;
    }
}

/* Reset container-xl - apply clean spacing matching dashboard */
body.app .app-wrapper .app-content .container-xl,
.app-wrapper .app-content .container-xl,
.app-content .container-xl,
body .app-content .container-xl,
div.container-xl,
[class*="container-xl"],
.container-xl {
    position: relative !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0 !important;
    padding-right: 30px !important;
    max-width: 100% !important;
    width: 100% !important;
    transform: none !important;
    box-sizing: border-box !important;
    overflow: visible; /* Allow dropdowns to extend beyond container */
}

/* Override ALL media queries from custom.css */
@media (min-width: 576px) {
    body.app .app-wrapper .app-content .container-xl,
    .app-wrapper .app-content .container-xl,
    .app-content .container-xl,
    body .app-content .container-xl,
    div.container-xl,
    [class*="container-xl"],
    .container-xl {
        padding-left: 0 !important;
        padding-right: 30px !important;
    }
}

@media (min-width: 992px) {
    body.app .app-wrapper .app-content .container-xl,
    .app-wrapper .app-content .container-xl,
    .app-content .container-xl,
    body .app-content .container-xl,
    div.container-xl,
    [class*="container-xl"],
    .container-xl {
        padding-left: 0 !important;
        padding-right: 30px !important;
    }
}

@media (min-width: 1200px) {
    body.app .app-wrapper {
        position: relative !important;
        margin-left: 250px !important;
        transform: translateX(-150px) !important;
        width: calc(100% - 250px + 150px) !important;
    }
    
    body.app .app-wrapper .app-content,
    .app-wrapper .app-content,
.app-content {
        position: relative !important;
        max-width: 100% !important;
        width: 100% !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    padding-left: 0 !important;
        padding-right: 0 !important;
    }
    
    body.app .app-wrapper .app-content .container-xl,
    .app-wrapper .app-content .container-xl,
    .app-content .container-xl,
    body .app-content .container-xl,
    div.container-xl,
    [class*="container-xl"],
    .container-xl {
        position: relative !important;
        padding-left: 0 !important;
        padding-right: 30px !important;
        max-width: 100% !important;
        width: 100% !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
}

@media (min-width: 1600px) {
    body.app .app-wrapper .app-content,
    .app-wrapper .app-content,
    .app-content {
        max-width: 100% !important;
        width: 100% !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
    
    body.app .app-wrapper .app-content .container-xl,
    .app-wrapper .app-content .container-xl,
    .app-content .container-xl,
    body .app-content .container-xl,
    div.container-xl,
    [class*="container-xl"],
    .container-xl {
        padding-left: 0 !important;
        padding-right: 30px !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
}

.job-header, .job-row {
    display: flex;
    align-items: center;
    min-width: 0;
    overflow: hidden;
}

.col-job,
.col-location,
.col-schedule,
.col-expiry,
.col-start,
.col-action {
    flex: 1;
    min-width: 130px;
}
.col-job {
    flex: 2;
}
.job-header {
    padding-left: 10px;
    padding-right: 10px;
    color: #121C0C;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    border: 1px solid #e6eef6;
    height: 40px;
    margin-bottom: 2px;
    font-size: 13px;
}
.job-row {
    border: none;
    padding: 10px 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 2px 0;
    font-size: 13px;
    border-radius: 10px;
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
}
.truncate-text {
    display: inline-block;
    max-width: 180px; /* Adjust as needed */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
}
.job-section {
    background-color: #fff;
    position: relative !important;
    z-index: 1;
    top: auto !important;
    bottom: auto !important;
    left: auto !important;
    right: auto !important;
    transform: none !important;
    /* Allow dropdowns to overflow */
    overflow: visible !important;
}
.job-check {
    margin-right: 8px;
    transform: scale(1.2);
}
#toggleActions {
    padding: 6px 16px;
    border-radius: 18px;
    border: 1px solid #ddd;
    font-size: 16px;
    color: #fff;
}
.job-meta {
    margin-top: 1px;
}
.ml-15-px {
    margin-left: 0 !important; /* Remove left margin to shift content left */
}
.mr-15-px {
    margin-right: 15px;
}
.action-btn {
    background: transparent;
    border: none;
    padding: 0 4px;
    min-width: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    white-space: nowrap;
    flex-shrink: 0;
    transition: opacity 0.2s ease, visibility 0.2s ease;
}

/* Fixed width for specific buttons to prevent layout shift */
#apply-btn,
#note-btn {
    min-width: 80px;
    visibility: visible;
    opacity: 1;
}

/* Fixed widths for Archive and Delete buttons */
#archive-btn,
#delete-btn {
    min-width: 90px;
    flex-shrink: 0;
}

/* Hidden state - maintain space but make invisible */
.action-btn.hidden-btn {
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
    display: flex !important; /* Keep flex to maintain space */
}

/* Ensure dropdown panels are positioned absolutely and not clipped */
.menu-panel,
.dropdown-panel,
.position-relative .filter-panel,
.position-relative .custom-dropdown,
.actions-container .filter-panel,
.actions-container .custom-dropdown,
.job-actions-left .filter-panel,
.job-actions-left .custom-dropdown {
    position: absolute !important;
    /* Don't override top/left/right - let inline styles or .custom-dropdown class handle it */
    /* Ensure these are not affected by parent positioning rules */
}

/* Override any external sticky classes */
.application-sticky,
.job-section.application-sticky,
.application.application-sticky,
.actions-container.application-sticky {
    position: relative !important;
    top: auto !important;
    bottom: auto !important;
}

.custom-dropdown {
  position: absolute !important;
  top: 110% !important;
  left: 0 !important;
  background: #fff;
  padding: 10px;
  min-width: 150px;
  z-index: 10000 !important;
  border: 1px solid #e6eef6;
  box-shadow: 0 2px 6px rgba(11,22,40,0.03);
  border-radius: 10px;
  overflow: visible !important;
  max-height: none !important;
}

/* Ensure filter panel specifically works as overlay */
#filter-panel.filter-panel.custom-dropdown {
  position: absolute !important;
  top: 100% !important;
  left: 0 !important;
  margin-top: 8px !important;
  z-index: 9999 !important;
  /* Ensure it's not clipped by parent containers */
  overflow: visible !important;
  /* Make sure it appears above everything */
  background: #fff !important;
  border: 1px solid #e6eef6 !important;
  box-shadow: 0 2px 6px rgba(11,22,40,0.03) !important;
  border-radius: 10px !important;
  padding: 0 !important;
  min-width: 280px !important;
}

/* Ensure filter panel content has proper spacing */
#filter-panel.filter-panel.custom-dropdown > div {
  padding: 16px !important;
}

/* Style form controls in filter panel */
#filter-panel .form-control {
  border: 1px solid #e6eef6;
  border-radius: 6px;
  width: 100%;
  box-sizing: border-box;
}

#filter-panel .form-control:focus {
  border-color: #85BB65;
  outline: none;
  box-shadow: 0 0 0 2px rgba(133, 187, 101, 0.1);
}

.hidden {
  display: none !important;
}

/* Ensure filter panel is visible when not hidden */
#filter-panel.filter-panel.custom-dropdown:not(.hidden) {
  display: block !important;
}

.columns-panel label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
  cursor: pointer;
  font-weight: 400;
  color: #121C0C;
}

.menu-panel .menu-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 0;
  cursor: pointer;
  color: #121C0C;
}

.menu-panel svg {
  width: 16px;
  height: 16px;
}

.dropdown-cstm {
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    padding: 4px 12px;
}

.menu-dropdown {
    overflow: visible !important;
    position: relative !important;
}

.menu-panel {
    min-width: 160px;
    z-index: 10000 !important;
    overflow: visible !important;
    max-height: none !important;
}

.dropdown-panel {
    overflow: visible !important;
    max-height: none !important;
}

.columns-panel input[type="checkbox"] {
  appearance: none;
  width: 16px;
  height: 16px;
  border: 1px solid #cfd9e3;
  border-radius: 4px;
  background-color: #fff;
  cursor: pointer;
  position: relative;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.columns-panel input[type="checkbox"]:hover {
  border-color: #85BB65;
}

.columns-panel input[type="checkbox"]:checked {
  background-color: #85BB65;
  border-color: #85BB65;
}

.columns-panel input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 5px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.col-check input[type="checkbox"] {
  appearance: none;
  width: 16px;
  height: 16px;
  border: 1px solid #cfd9e3;
  border-radius: 4px;
  background-color: #fff;
  cursor: pointer;
  position: relative;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.col-check input[type="checkbox"]:hover {
  border-color: #85BB65;
}

.col-check input[type="checkbox"]:checked {
  background-color: #85BB65;
  border-color: #85BB65;
}

.col-check input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 5px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

/* Consistent rounded rectangle style for all job list checkboxes */
.job-list-container input[type="checkbox"].job-check,
.split-job-list input[type="checkbox"].job-checkbox,
#select-all-checkbox {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border: 1px solid #cfd9e3;
  border-radius: 4px;
  background: #fff;
  cursor: pointer;
  position: relative;
  display: inline-block;
  vertical-align: middle;
  margin: 0;
  transition: background-color 0.3s ease, border-color 0.3s ease;
  box-sizing: border-box;
  line-height: 1;
  padding: 0;
}

/* Hover state - green border */
.job-list-container input[type="checkbox"].job-check:hover,
.split-job-list input[type="checkbox"].job-checkbox:hover,
#select-all-checkbox:hover {
  border-color: #85BB65;
}

/* Checked state - green filled with white checkmark */
.job-list-container input[type="checkbox"].job-check:checked,
.split-job-list input[type="checkbox"].job-checkbox:checked,
#select-all-checkbox:checked {
  background-color: #85BB65;
  border-color: #85BB65;
}

.job-list-container input[type="checkbox"].job-check:checked::after,
.split-job-list input[type="checkbox"].job-checkbox:checked::after,
#select-all-checkbox:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 6px;
  width: 4px;
  height: 8px;
  border: solid #fff;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

/* Remove previous scale that distorted shape */
.job-check { transform: none; margin-right: 8px; }

.job-title {
    color: #121C0C;
    font-size: 18px;
}

.action-btn {
    // background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    padding: 4px 12px;
    display: flex;
    gap: 6px;
    align-items: center;
}
.action-btn, .dropdown-cstm {
    transition: all 0.2s ease;
}
.action-btn:hover, .dropdown-cstm:hover {
    color: #85BB65;
    border: 1px solid #85BB65;
    transition: all 0.2s ease;
}
.action-btn:hover svg {
    color: #85BB65;
}
#delete-btn:hover {
    color: #BA1824;
    border: 1px solid #BA1824;
    transition: all 0.2s ease; 
}
#delete-btn:hover svg {
    color: #BA1824;
}
.col-center {
    text-align: center;
}
.col-rank {
    min-width: 100px !important;
    max-width: none !important;
    width: 100px !important;
}
/* Make score field look editable with highlighting */
/* Todo Icon Styles */
.todo-icon {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #85BB65;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: relative;
    box-shadow: 0 0 10px rgba(133, 187, 101, 0.6), 0 0 20px rgba(133, 187, 101, 0.4);
    animation: pulse-glow 2s ease-in-out infinite;
    pointer-events: auto;
}

.todo-icon * {
    pointer-events: none;
}

.todo-icon:hover {
    box-shadow: 0 0 15px rgba(133, 187, 101, 0.8), 0 0 30px rgba(133, 187, 101, 0.6);
    animation: none;
}

@keyframes pulse-glow {
    0%, 100% {
        box-shadow: 0 0 10px rgba(133, 187, 101, 0.6), 0 0 20px rgba(133, 187, 101, 0.4);
    }
    50% {
        box-shadow: 0 0 15px rgba(133, 187, 101, 0.8), 0 0 30px rgba(133, 187, 101, 0.6);
    }
}

.todo-icon svg {
    width: 12px;
    height: 12px;
    fill: white;
}

.todo-popup {
    position: fixed;
    background: #121C0C;
    color: white;
    border-radius: 8px;
    padding: 12px 16px;
    font-size: 13px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: 99999;
    max-width: 250px;
    display: none;
    pointer-events: none;
}

.todo-popup.show {
    display: block;
    pointer-events: auto;
}

.todo-popup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.todo-popup-title {
    font-weight: 600;
    font-size: 14px;
}

.todo-popup-close {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 18px;
    line-height: 1;
    padding: 0;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.7;
    transition: opacity 0.2s ease;
}

.todo-popup-close:hover {
    opacity: 1;
}

.todo-popup-content {
    line-height: 1.5;
}

.todo-icon-wrapper {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.rank-display {
    cursor: pointer !important;
    padding: 4px 8px !important;
    border-radius: 6px !important;
    transition: all 0.2s ease !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-width: 45px !important;
    text-align: center !important;
    background-color: #f0f9f0 !important;
    border: 1px solid #b3e6b3 !important;
    color: #2d7a2d !important;
    font-weight: 500 !important;
    margin: 0 auto !important;
}

.rank-display:hover {
    background-color: #e0f5e0 !important;
    border-color: #80d980 !important;
    box-shadow: 0 2px 4px rgba(45, 122, 45, 0.2) !important;
    transform: translateY(-1px) !important;
}

.rank-display:active {
    background-color: #ccefcc !important;
    transform: translateY(0) !important;
}

.rank-input {
    background-color: #fff !important;
    border: 2px solid #85BB65 !important;
    border-radius: 6px !important;
    padding: 4px 6px !important;
    font-weight: 500 !important;
    color: #2d7a2d !important;
    box-shadow: 0 2px 8px rgba(133, 187, 101, 0.3) !important;
    text-align: center !important;
    width: 50px !important;
    min-width: 50px !important;
    max-width: 50px !important;
    box-sizing: border-box !important;
    flex-shrink: 0 !important;
}

.rank-input:focus {
    outline: none !important;
    border-color: #6fa852 !important;
    box-shadow: 0 0 0 3px rgba(133, 187, 101, 0.2) !important;
}

.application {
    padding-left: 16px;
    position: relative !important;
    top: auto !important;
    bottom: auto !important;
    left: auto !important;
    right: auto !important;
    transform: none !important;
    /* Allow dropdowns to overflow */
    overflow: visible !important;
}
.application .card {
  clip-path: polygon(0% 0%,calc(100% - 15px) 0%,100% 50%,calc(100% - 15px) 100%,0% 100%,15px 50%,0% 0%);
  display: flex;
  justify-content: center;
  align-items: center;
  margin-left: -15px;
  margin-bottom: 0 !important;
  cursor: pointer;
  height: 100%;
  width: 100%;
  flex: 1;
}

/* First card: no left cutout */
.application .col:first-child {
    max-width: 80px;
    display: flex;
}

.application .col:first-child > a {
    display: flex;
    width: 100%;
    flex: 1;
}

.application .col:first-child .card {
    clip-path:none;
    margin-left: 0;
    margin-bottom: 0 !important;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    flex: 1;
}
.application .row .col {
    display: flex;
}

.application .row .col > a {
    display: flex;
    width: 100%;
    flex: 1;
}

.application .col .card-body {
    justify-content: center;
    flex-direction: column-reverse;
    text-align: center;
    align-items: center;
    display: flex;
    height: 100%;
    min-height: 100%;
    padding: 0.5rem 1rem;
}
.application .col .card-body .card-title {
    font-size: 16px;
}
.is-card.is-applied:hover *, .is-card.is-review:hover *, .is-card.is-interview:hover *, .is-card.is-rejected:hover *, .is-card.is-hired:hover *, .is-card.is-offered:hover *, .is-card.is-completed:hover *, .is-card.is-applied.active *, .is-card.is-review.active *, .is-card.is-interview.active *, .is-card.is-rejected.active *, .is-card.is-hired.active *, .is-card.is-offered.active *, .is-card.is-completed.active *, .is-card .card-body p, .is-card .card-body:hover, .application .col .card-body .card-title:hover, .is-card:hover {
    color: rgb(33, 37, 41);
}
.application .col .card-body p {
    font-size: 16px;
    color: #121C0C;
}
.application .col:first-child .card .card-body {
    align-items: center;
}
.application .col:nth-child(2) .card {
  clip-path: polygon(0% 0%,calc(100% - 15px) 0%,100% 50%,calc(100% - 15px) 100%,0% 100%,0% 0%);
  margin-left: 0;
}
.application .col:last-child .card {
    clip-path: polygon(0% 0%,100% 0%,100% 100%,0% 100%,15px 50%,0% 0%);
}
.application .col:first-child .card-body p {
    display: none;
}
.application .col:first-child .card-body .card-title {
    font-size: 16px;
}
.col:nth-child(1) .is-card {
  background-color: #D2E6C6;
}
.col:nth-child(2) .is-card {
  background-color: #C7E0B8;
}
.col:nth-child(3) .is-card {
  background-color: #BBDAAA;
}
.col:nth-child(4) .is-card {
  background-color: #AFD39C;
}
.col:nth-child(5) .is-card {
  background-color: #A4CC8E;
}
.col:nth-child(6) .is-card {
  background-color: #99C680;
}
.col:nth-child(7) .is-card {
  background-color: #8DC072;
}
.col:nth-child(8) .is-card {
  background-color: #82B964;
}

.col:nth-child(1) .is-card:hover {
  background-color: #B9F2FF;
}
.col:nth-child(2) .is-card:hover {
  background-color: #ADF0FF;
}
.col:nth-child(3) .is-card:hover {
  background-color: #99ECFF;
}
.col:nth-child(4) .is-card:hover {
  background-color: #85E9FF;
}
.col:nth-child(5) .is-card:hover {
  background-color: #70E5FF;
}
.col:nth-child(6) .is-card:hover {
  background-color: #5CE1FF;
}
.col:nth-child(7) .is-card:hover {
  background-color: #47DDFF;
}
.col:nth-child(8) .is-card:hover {
  background-color: #33DAFF;
}
.col .is-card.is-saved.active {
    background-color: #ADF0FF;
}
.sort-toggle {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  line-height: 1;
  gap: 2px;
  margin-left: 6px;
  vertical-align: middle;
  position: relative;
  top: 1px; /* nudges to visually center with text */
}
.sort-toggle svg { width: 10px; height: 10px; }
.sort-toggle .arrow { opacity: 0.35; transition: opacity 0.15s ease; }
.sort-toggle .arrow.active { opacity: 1; }

.actions-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  margin-top: 20px;
  margin-bottom: 12px;
  padding-left: 15px;
  padding-right: 15px;
  white-space: nowrap;
  overflow-y: visible !important;
  overflow-x: visible;
  position: relative;
  z-index: 1;
}

/* Scrollable only in split view */
.actions-container.scrollable {
  display: flex;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
}

.actions-container.scrollable::-webkit-scrollbar {
  height: 6px;
}

.actions-container.scrollable::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.actions-container.scrollable::-webkit-scrollbar-thumb {
  background: #85BB65;
  border-radius: 3px;
}

.actions-container.scrollable::-webkit-scrollbar-thumb:hover {
  background: #6FA050;
}

.actions-container > * {
  flex-shrink: 0;
}

.job-actions-left {
  display: flex;
  gap: 8px;
  align-items: center;
  flex: 1;
  justify-content: flex-start;
}

.job-actions-middle {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-shrink: 0;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  z-index: 2;
}

.job-actions-left,
.col-dropdowns {
  display: flex;
  gap: 8px;
  align-items: center;
  overflow: visible !important;
  position: relative;
  flex-wrap: nowrap;
  white-space: nowrap;
}

/* Ensure parent containers don't clip the dropdown */
.job-actions-left {
  overflow: visible !important;
  position: relative;
}

.position-relative {
  overflow: visible !important;
}

/* Enhanced table alignment and typography */
.job-header {
  font-size: 13px;
  font-weight: 600;
  color: #121C0C;
  letter-spacing: 0.01em;
  line-height: 1.5;
  background: #F8FAF9;
  border-bottom: 2px solid #e6eef6;
}

.job-row {
  font-size: 13px;
  font-weight: 400;
  color: #1a1a1a;
  line-height: 1.5;
  transition: background-color 0.2s ease;
}

.job-row:hover {
  background-color: #F8FAF9;
}

/* Perfect alignment between headers and rows */
.job-header > div,
.job-row > div {
  display: flex;
  align-items: center;
  box-sizing: border-box;
  padding: 12px 8px;
  min-width: 0;
  overflow: hidden;
  height: 48px;
}

/* Ensure consistent vertical alignment */
.job-header {
  min-height: 48px;
  height: 48px;
}

/* Center content for numeric/text columns */
.job-header .col-start.col-center,
.job-row .col-start.col-center {
  justify-content: center;
  text-align: center;
}

/* Job column specific styling */
.col-job {
  font-weight: 500;
}

/* Improve text truncation */
.job-title {
  font-size: 13px;
  font-weight: 500;
  color: #121C0C;
  line-height: 1.4;
}

/* Consistent cell content styling */
.job-row > div {
  font-size: 13px;
  color: #1a1a1a;
}

/* Status and badge styling */
.job-row .badge {
  font-size: 11px;
  font-weight: 500;
  padding: 4px 8px;
  border-radius: 6px;
}

/* NEW badge - change from blue to green */
/* Target common blue color codes used in badges */
span[style*="#0d6efd"],
span[style*="#007bff"],
span[style*="#06b6d4"],
span[style*="background-color: #0d6efd"],
span[style*="background-color: #007bff"],
span[style*="background-color: #06b6d4"],
span[style*="background: #0d6efd"],
span[style*="background: #007bff"],
span[style*="background: #06b6d4"],
.badge[style*="#0d6efd"],
.badge[style*="#007bff"],
.badge[style*="#06b6d4"] {
  background-color: #85BB65 !important;
  color: #fff !important;
}

/* Target badge-pill class with blue colors */
.badge-pill[style*="background"],
.badge.badge-pill[style*="background"] {
  background-color: #85BB65 !important;
  color: #fff !important;
}

/* Target any span or badge with inline blue background styles */
span[style*="background"][style*="#0"],
span[style*="background-color"][style*="#0"],
.badge[style*="background"][style*="#0"] {
  background-color: #85BB65 !important;
  color: #fff !important;
}

.job-actions-left {
  justify-self: start;
}

.job-actions-middle {
  justify-self: center;
}

.col-dropdowns {
  justify-self: end;
}

.table-responsive-wrapper {
  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
}

.table-responsive-wrapper::-webkit-scrollbar {
  height: 8px;
}

.table-responsive-wrapper::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.table-responsive-wrapper::-webkit-scrollbar-thumb {
  background: #85BB65;
  border-radius: 10px;
}

.table-responsive-wrapper::-webkit-scrollbar-thumb:hover {
  background: #6fa852;
}

/* Toast notifications */
.toast-container {
    z-index: 9999;
}

.toast {
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

/* Button states */
.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.action-btn:disabled:hover {
    color: inherit;
    border-color: #e6eef6;
}
</style>

<script>
// Force apply styles via JavaScript - COMPLETE OVERRIDE - Run multiple times to ensure it sticks
function applySpacingStyles() {
    // Reset and apply container-xl styles
    const container = document.querySelector('.container-xl');
    if (container) {
        container.style.setProperty('position', 'relative', 'important');
        container.style.setProperty('padding-left', '0', 'important');
        container.style.setProperty('padding-right', '30px', 'important');
        container.style.setProperty('margin-left', '0', 'important');
        container.style.setProperty('margin-right', '0', 'important');
        container.style.setProperty('transform', 'none', 'important');
        container.style.setProperty('max-width', '100%', 'important');
        container.style.setProperty('width', '100%', 'important');
    }
    
    // Reset app-content
    const appContent = document.querySelector('.app-content');
    if (appContent) {
        appContent.style.setProperty('position', 'relative', 'important');
        appContent.style.setProperty('padding-left', '0', 'important');
        appContent.style.setProperty('padding-right', '0', 'important');
        appContent.style.setProperty('margin-left', '0', 'important');
        appContent.style.setProperty('margin-right', '0', 'important');
        appContent.style.setProperty('max-width', '100%', 'important');
        appContent.style.setProperty('width', '100%', 'important');
    }
    
    // Reset app-wrapper
    const appWrapper = document.querySelector('.app-wrapper');
    if (appWrapper) {
        appWrapper.style.setProperty('position', 'relative', 'important');
        if (window.innerWidth >= 1200) {
            appWrapper.style.setProperty('margin-left', '250px', 'important');
            appWrapper.style.setProperty('transform', 'translateX(-150px)', 'important');
            appWrapper.style.setProperty('width', 'calc(100% - 250px + 150px)', 'important');
        } else {
            appWrapper.style.setProperty('margin-left', '0', 'important');
            appWrapper.style.setProperty('transform', 'none', 'important');
            appWrapper.style.setProperty('width', '100%', 'important');
        }
        appWrapper.style.setProperty('margin-right', '0', 'important');
        appWrapper.style.setProperty('padding-left', '0', 'important');
        appWrapper.style.setProperty('padding-right', '0', 'important');
    }
    
    // Remove padding from all rows and first columns
    const rows = document.querySelectorAll('.container-xl .row');
    rows.forEach(row => {
        row.style.setProperty('margin-left', '0', 'important');
        row.style.setProperty('padding-left', '0', 'important');
    });
    
    const firstCols = document.querySelectorAll('.container-xl .row > [class*="col-"]:first-child');
    firstCols.forEach(col => {
        col.style.setProperty('padding-left', '0', 'important');
        col.style.setProperty('margin-left', '0', 'important');
    });
}

// Run immediately
document.addEventListener('DOMContentLoaded', applySpacingStyles);

// Run after a short delay to override any late-loading styles
setTimeout(applySpacingStyles, 100);
setTimeout(applySpacingStyles, 500);

// Re-apply on window resize to override any responsive changes
window.addEventListener('resize', function() {
    setTimeout(applySpacingStyles, 50);
});
</script>

<!-- Hidden form for delete action -->
<form id="delete-bookmarks-form" method="POST" action="{{ path('app_provider_bookmarks_delete') }}" style="display: none;">
    <input type="hidden" name="_token" value="{{ csrf_token('delete_bookmarks') }}">
    <input type="hidden" name="bookmark_ids" id="bookmark-ids-input">
</form>

<!-- Hidden form for apply action -->
<form id="apply-jobs-form" method="POST" action="{{ path('app_provider_saved_jobs_apply') }}" style="display: none;">
    <input type="hidden" name="_token" value="{{ csrf_token('apply_jobs') }}">
    <input type="hidden" name="job_ids" id="job-ids-input">
    <input type="hidden" name="_redirect" value="{{ path('app_provider_jobs_saved') }}">
</form>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the selected saved jobs? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Apply Confirmation Modal -->
<div class="modal fade" id="applyConfirmModal" tabindex="-1" aria-labelledby="applyConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="applyConfirmModalLabel">Apply to Jobs</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to apply to the selected jobs? This will:
                <ul>
                    <li>Submit applications for the selected jobs</li>
                    <li>Remove them from your saved jobs</li>
                    <li>Move them to your applications</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="confirm-apply-btn">Apply to Jobs</button>
            </div>
        </div>
    </div>
</div>

    {% set statusColors = {
        'saved': 'saved',
        'applied': 'applied',
        'interview': 'interview',
        'negotiating': 'offered',
        'accepted' : 'hired',
        'completed': 'completed',
    } %}

    {% set allStatuses = ['saved', 'applied', 'interview', 'negotiating', 'accepted', 'completed'] %}

<div class="container-xl">
    <div class="job-section shadow-lg p-3 rounded-3">

        <div class="application">
            <div class="row g-2">
                <div class="col">
                    <a href="{{ path('app_provider_jobs_applications') }}">
                        <div class="card is-card mb-3 is-applied {% if app.request.get('status') and app.request.get('status') == '' %}active{% endif %}">
                            <div class="card-body">
                                <h6 class="card-title">All</h6>
                                <p class="card-text">{{ totalApplications|number_format }}</p>
                            </div>
                </div>
            </a>
                </div>

            {% for status in allStatuses %}
                {% set count = 0 %}
                {% for item in statusCounts %}
                    {% if item.status == status %}
                        {% set count = item.count %}
                    {% endif %}
                {% endfor %}
                    <div class="col">
                        <a href="{% if status == 'saved' %}{{ path('app_provider_jobs_saved') }}{% else %}{{ path('app_provider_jobs_applications', {'status': status}) }}{% endif %}">
                        <div class="card is-card mb-3 is-{{ statusColors[status] }} {% if app.request.get('status') == status or (status == 'saved' and app.request.get('_route') == 'app_provider_jobs_saved') %}active{% endif %}">
                            <div class="card-body">
                                <h6 class="card-title">{{ status | replace({'_': ' '}) | title }}</h6>
                                <p class="card-text">{{ count }}</p>
                                {#   {% if status == 'applied' %}
                                    <img src="{{ asset('assets/icons/submit.png') }}" class="icon-image" alt="">
                                {% elseif status == 'in_review' %}
                                    <img src="{{ asset('assets/icons/magnifying-glass.png') }}" class="icon-image" alt="">
                                {% elseif status == 'interview' %}
                                    <img src="{{ asset('assets/icons/hired.png') }}" class="icon-image" alt="">
                                {% elseif status == 'offered' %}
                                    <img src="{{ asset('assets/icons/invitation-letter.png') }}" class="icon-image" alt="">
                                {% elseif status == 'rejected' %}
                                    <img src="{{ asset('assets/icons/no-internet.png') }}" class="icon-image" alt="">
                                {% elseif status == 'hired' %}
                                    <img src="{{ asset('assets/icons/campus.png') }}" class="icon-image" alt="">
                                {% elseif status == 'completed' %}
                                    <img src="{{ asset('assets/icons/flag.png') }}" class="icon-image" alt="">
                                {% endif %} #}
                            </div>
                    </div>
                </a>
                    </div>
            {% endfor %}
            </div>
        </div>

        <div class="actions-container ml-15-px mr-15-px">
            <!-- Left Group: Filter, Notify of hire, Email, Apply -->
            <div class="job-actions-left">
              <div class="position-relative" style="flex-shrink: 0;">
                <button id="filter-btn" class="action-btn" title="Filter">
                  <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 7H21M7 12H17M10 17H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Filter
                </button>
                <div id="filter-panel" class="filter-panel custom-dropdown hidden"
                    style="position: absolute; top: 100%; left: 0; margin-top: 8px; min-width: 280px; z-index: 9999; background: #fff; border: 1px solid #e6eef6; box-shadow: 0 2px 6px rgba(11,22,40,0.03); border-radius: 10px; padding: 0;">
                  <div style="padding: 16px;">
                    <h6 style="margin-bottom: 12px; font-weight: 600; color: #121C0C;">Filter Jobs</h6>
                    <!-- Location Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Location</label>
                      <input type="text" id="filter-location" class="form-control"
                            placeholder="Enter location" style="font-size: 13px; padding: 6px 10px;">
                    </div>
                    <!-- Salary Range Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Salary Range</label>
                      <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" id="filter-salary-min" class="form-control"
                              placeholder="Min" style="font-size: 13px; padding: 6px 10px; flex: 1;">
                        <span style="color: #6b7280;">-</span>
                        <input type="number" id="filter-salary-max" class="form-control"
                              placeholder="Max" style="font-size: 13px; padding: 6px 10px; flex: 1;">
                      </div>
                    </div>
                    <!-- Category Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Category</label>
                      <select id="filter-category" class="form-control"
                              style="font-size: 13px; padding: 6px 10px;">
                        <option value="">All Categories</option>
                        <option value="locums">Locums</option>
                        <option value="parttime">Parttime</option>
                        <option value="fulltime">Full time</option>
                      </select>
                    </div>
                    
                    <!-- Date Posted Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Posted Within</label>
                      <select id="filter-date-posted" class="form-control"
                              style="font-size: 13px; padding: 6px 10px;">
                        <option value="">Any time</option>
                        <option value="1">Last 24 hours</option>
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                        <option value="90">Last 3 months</option>
                      </select>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 8px; margin-top: 16px;">
                      <button id="apply-filter-btn" class="action-btn"
                              style="flex: 1; padding: 8px 12px; font-size: 13px;">Apply</button>
                      <button id="clear-filter-btn" class="action-btn"
                              style="flex: 1; padding: 8px 12px; font-size: 13px; background: #f3f4f6; color: #6b7280;">Clear</button>
                    </div>
                  </div>
                  </div>
                </div>
              <button id="save-btn" class="action-btn" title="Save" style="display: none;">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 10.5V12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2H13.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <circle cx="19" cy="5" r="3" stroke="#1C274C" stroke-width="1.5"/>
                <path d="M7 14H16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M7 17.5H13" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                </svg> Notify of hire
              </button>
              <button id="email-btn" class="action-btn" title="Email" style="margin-left: 8px;">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="style=stroke">
                <g id="email">
                <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="currentColor"></path>
                <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="currentcolor"></path>
                </g>
                </g>
                <use xlink:href="#icon-email"/>
                </svg> Email
              </button>
              
              <button id="apply-btn" class="action-btn hidden-btn" disabled title="Apply">
                <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <g data-name="Layer 2">
                <g data-name="checkmark-circle">
                <rect width="24" height="24" opacity="0"/>
                <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                </g>
                </g>
                <use xlink:href="#icon-apply"/>
                </svg> Apply
              </button>
            </div>
            
            <!-- Middle Group: Archive, Delete -->
            <div class="job-actions-middle">
              <button id="archive-btn" class="action-btn" title="Archive">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21L12 12M12 12L15 15.3333M12 12L9 15.3333" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20.5 7V13C20.5 16.7712 20.5 18.6569 19.3284 19.8284C18.1569 21 16.2712 21 12.5 21H11.5C7.72876 21 5.84315 21 4.67157 19.8284C3.5 18.6569 3.5 16.7712 3.5 13V7" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M2 5C2 4.05719 2 3.58579 2.29289 3.29289C2.58579 3 3.05719 3 4 3H20C20.9428 3 21.4142 3 21.7071 3.29289C22 3.58579 22 4.05719 22 5C22 5.94281 22 6.41421 21.7071 6.70711C21.4142 7 20.9428 7 20 7H4C3.05719 7 2.58579 7 2.29289 6.70711C2 6.41421 2 5.94281 2 5Z" stroke="currentcolor" stroke-width="1.5"/>
                <use xlink:href="#icon-archive"/>
                </svg> Archive
              </button>
              <button id="delete-btn" class="action-btn" title="Delete">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.17065 4C9.58249 2.83481 10.6937 2 11.9999 2C13.3062 2 14.4174 2.83481 14.8292 4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M20.5 6H3.49988" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5M18.8334 8.5L18.6334 11.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M9.5 11L10 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M14.5 11L14 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <use xlink:href="#icon-delete"/>
                </svg> Delete
              </button>
            </div>
            
            <!-- Right Group: Note, Grid View, New Window, Menu -->
            <div class="col-dropdowns d-flex gap-2" style="flex: 1; justify-content: flex-end;">
              <button id="note-btn" class="action-btn hidden-btn d-none" title="Add Note" onclick="handleNoteClick()">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <!-- Sticky note with pencil icon -->
                  <path d="M8 3H14C16.7614 3 19 5.23858 19 8V14.5C19 15.0523 18.5523 15.5 18 15.5H14C12.3431 15.5 11 16.8431 11 18.5V20C11 20.5523 10.5523 21 10 21H8C5.23858 21 3 18.7614 3 16V8C3 5.23858 5.23858 3 8 3Z" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M21 7L15 13L14 16L17 15L23 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Note
              </button>
              <button id="grid-view-btn" class="action-btn" title="Split View">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 3H10V10H3V3Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 3H21V10H14V3Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 14H10V21H3V14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 14H21V21H14V14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Split View
              </button>
              <button id="float-view-btn" class="action-btn" title="Open in New Window">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13 3H21V11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M13 21H3V3H21V11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M13 11L21 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                New Window
              </button>
              <!-- Columns Dropdown -->
              <div class="columns-dropdown position-relative" style = "display: none;">
                <button type="button" class="columns-dropdown-btn dropdown-cstm"><span>Columns</span></button>
                <div class="dropdown-panel columns-panel custom-dropdown hidden">
                  <label><input type="checkbox" value="salary"> Salary</label>
                  <label><input type="checkbox" value="location"> Location</label>
                  <label><input type="checkbox" value="date-posted"> Date Posted</label>
                  <label><input type="checkbox" value="deadline"> Deadline</label>
                  <label><input type="checkbox" value="date-applied"> Date Applied</label>
                  <label><input type="checkbox" value="excitement"> Score</label>
                </div>
              </div>

              <!-- Menu Dropdown -->
              <div class="menu-dropdown position-relative">
                <button type="button" class="menu-dropdown-btn dropdown-cstm"><span>Menu</span></button>
                <div class="dropdown-panel menu-panel custom-dropdown hidden">
                  <a href="{{ path('app_provider_jobs_archived') }}" class="menu-item" style="text-decoration: none; color: inherit;"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path opacity="0.5" d="M20.5 7V13C20.5 16.7712 20.5 18.6569 19.3284 19.8284C18.1569 21 16.2712 21 12.5 21H11.5C7.72876 21 5.84315 21 4.67157 19.8284C3.5 18.6569 3.5 16.7712 3.5 13V7" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M2 5C2 4.05719 2 3.58579 2.29289 3.29289C2.58579 3 3.05719 3 4 3H20C20.9428 3 21.4142 3 21.7071 3.29289C22 3.58579 22 4.05719 22 5C22 5.94281 22 6.41421 21.7071 6.70711C21.4142 7 20.9428 7 20 7H4C3.05719 7 2.58579 7 2.29289 6.70711C2 6.41421 2 5.94281 2 5Z" stroke="#121C0C" stroke-width="1.5"/>
                    <path d="M12 7L12 16M12 16L15 12.6667M12 16L9 12.6667" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg> Archived Jobs</a>
                  <a href="{{ path('app_provider_download_data', {'type': 'saved'}) }}" class="menu-item" style="text-decoration: none; color: inherit;"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16.44 8.8999C20.04 9.2099 21.51 11.0599 21.51 15.1099V15.2399C21.51 19.7099 19.72 21.4999 15.25 21.4999H8.73998C4.26998 21.4999 2.47998 19.7099 2.47998 15.2399V15.1099C2.47998 11.0899 3.92998 9.2399 7.46998 8.9099" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 15.0001V3.62012" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15.35 5.85L12 2.5L8.65002 5.85" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg> Export Report</a>
                </div>
              </div>
            </div>
        </div>

        {% if bookmarks|length > 0 %}
        <div class="job-list-container bg-light p-3 rounded-3">
          <div class="table-responsive-wrapper" style="overflow-x: auto; width: 100%;">
          <div class="d-flex align-items-center job-lists">
            <div class="d-flex align-items-center flex-grow-1" style="width: 100%; min-width: 0;">
              <div class="job-header d-flex align-items-center fw-semibold py-2 flex-grow-1" style="width: 100%; min-width: 0; gap: 0;">
                <div class="col-check" style="width: 30px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
                  <input type="checkbox" id="select-all-checkbox" title="Select All" />
                </div>
                <div class="col-job sortable" data-sort="job" style="width: 200px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: flex-start; gap: 4px;">Job Title<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
                <div class="col-start col-center sortable" data-sort="location" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Location<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
                <div class="col-start col-center sortable" data-sort="salary" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Salary<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
                <div class="col-start col-center sortable" data-sort="employer" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Employer</div>
                <div class="col-start col-center sortable" data-sort="applied" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Date Applied</div>
                <div class="col-start col-center sortable" data-sort="category" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Category</div>
                <div class="col-start col-center" style="width: 80px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">To Do</div>
                <div class="col-start col-center col-rank sortable" data-sort="rank" style="width: 100px; min-width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; gap: 4px; overflow: visible; position: relative;">Score<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
                <div class="col-start col-center sortable" data-sort="status" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Status</div>
              </div>
            </div>
          </div>

          {% for bookmark in bookmarks %}
            {% set job = bookmark.job %}
            <div class="d-flex align-items-center job-lists">
              <div class="job-row d-flex align-items-center flex-grow-1" style="width: 100%; min-width: 0; gap: 0;">
                <div class="col-check" style="width: 30px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center;">
                  <input type="checkbox" class="job-check job-checkbox" data-job-id="{{ job.id }}" data-bookmark-id="{{ bookmark.id }}" />
                </div>
                <div class="col-job d-flex align-items-center gap-2" style="width: 200px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box;">
                  <img src="{{ job.companyLogo|default(asset('assets/icons/job.png')) }}"
                    alt="Logo"
                    style="width: 40px; height: 40px; border-radius: 8px; flex-shrink: 0;" />
                  <div style="min-width: 0; overflow: hidden;">
                    <a class="job-title truncate-text d-block fw-semibold text-decoration-none"
                      href="{{ path('app_provider_jobs_detail', {'id': job.id}) }}"
                      style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px;">
                        {{ job.title }}
                    </a>
                  </div>
                </div>
                <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.state }}</div>
                <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; font-size: 13px;">{{ job.formattedHourlyRate }}</div>
                <div class="col-start col-center" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; font-size: 13px;">{{ job.employer|default(job.companyName|default('')) }}</div>
                <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ bookmark.createdAt ? bookmark.createdAt|date('m/d/Y') : '' }}</div>
                <div class="col-start col-center" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; font-size: 13px; color: #121C0C;">
                  {% if job.workType == 'locums' %}
                      Locums
                  {% elseif job.workType == 'parttime' or job.workType == 'part-time' %}
                      Parttime
                  {% elseif job.workType == 'fulltime' or job.workType == 'full-time' %}
                      Full time
                  {% else %}
                      {{ job.workType|default('')|replace({'_': ' '})|title }}
                  {% endif %}
                </div>
                <div class="col-start col-center" style="width: 80px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; overflow: visible; position: relative;">
                  <div class="todo-icon-wrapper">
                    <div class="todo-icon" data-todo-action="Apply for the job" data-todo-type="saved">
                      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 11L12 14L22 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M21 12V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                  </div>
                </div>
                <div class="col-start col-center col-rank" style="width: 100px; min-width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; overflow: visible; position: relative;">
                  <span class="rank-display" data-job-id="{{ job.id }}" style="font-size: 13px;">
                    {{ bookmark.rank is not null ? bookmark.rank : '' }}
                  </span>
                  <div class="rank-input-wrapper hidden">
                  <input
                    type="number"
                      class="rank-input"
                    value="{{ bookmark.rank is not null ? bookmark.rank : '' }}"
                    min="1"
                    max="10"
                    step="0.5"
                    data-job-id="{{ job.id }}"
                    data-original-value="{{ bookmark.rank is not null ? bookmark.rank : '' }}"
                    oninput="if (this.value > 10) this.value = 10; if (this.value < 1) this.value = 1;"
                  />
                    <button type="button" class="rank-save-btn" data-job-id="{{ job.id }}" title="Save">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="col-start col-center" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; color: #000;">
                  Saved
                </div>
              </div>
            </div>
          {% endfor %}
          </div>
        </div>
        {% else %}
            <p class="mb-0">Saved jobs not found.</p>
        {% endif %}
        <div class="job-actions hidden-buttons ml-15-px" style="margin-bottom: 20px; display: flex; gap: 8px; align-items: center; visibility: hidden;">
          <button id="save-btn" class="action-btn" title="Save">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 10.5V12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2H13.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <circle cx="19" cy="5" r="3" stroke="#1C274C" stroke-width="1.5"/>
                <path d="M7 14H16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M7 17.5H13" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </button>
              <button id="apply-btn" class="action-btn hidden-btn" disabled title="Apply">
                <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <g data-name="Layer 2">
                <g data-name="checkmark-circle">
                <rect width="24" height="24" opacity="0"/>
                <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                </g>
                </g>
                <use xlink:href="#icon-apply"/>
                </svg>
              </button>
              <button id="email-btn" class="action-btn" title="Email">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="style=stroke">
                <g id="email">
                <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="currentColor"></path>
                <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="currentcolor"></path>
                </g>
                </g>
                <use xlink:href="#icon-email"/>
                </svg>
              </button>
              
              <button id="delete-btn" class="action-btn" title="Delete">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.17065 4C9.58249 2.83481 10.6937 2 11.9999 2C13.3062 2 14.4174 2.83481 14.8292 4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M20.5 6H3.49988" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5M18.8334 8.5L18.6334 11.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M9.5 11L10 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M14.5 11L14 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <use xlink:href="#icon-delete"/>
                </svg>
              </button>
              <button id="archive-btn" class="action-btn" title="Archive">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21L12 12M12 12L15 15.3333M12 12L9 15.3333" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20.5 7V13C20.5 16.7712 20.5 18.6569 19.3284 19.8284C18.1569 21 16.2712 21 12.5 21H11.5C7.72876 21 5.84315 21 4.67157 19.8284C3.5 18.6569 3.5 16.7712 3.5 13V7" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M2 5C2 4.05719 2 3.58579 2.29289 3.29289C2.58579 3 3.05719 3 4 3H20C20.9428 3 21.4142 3 21.7071 3.29289C22 3.58579 22 4.05719 22 5C22 5.94281 22 6.41421 21.7071 6.70711C21.4142 7 20.9428 7 20 7H4C3.05719 7 2.58579 7 2.29289 6.70711C2 6.41421 2 5.94281 2 5Z" stroke="currentcolor" stroke-width="1.5"/>
                <use xlink:href="#icon-archive"/>
                </svg> Archive
              </button>
        </div>

        <!-- Split View Container -->
        <div class="split-view-container" id="split-view-container">
            <button class="list-toggle-btn" id="list-toggle-btn" style="display: none;" title="Toggle job list">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 6L9 12L15 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <!-- Left Side: Job List -->
            <div class="split-job-list" id="split-job-list">
                {% for bookmark in bookmarks %}
                    {% set job = bookmark.job %}
                    <div class="split-job-card" data-job-id="{{ job.id }}">
                        <div class="split-job-card-header">
                            <input type="checkbox" class="job-checkbox" data-job-id="{{ job.id }}" data-bookmark-id="{{ bookmark.id }}" style="margin-top: 2px;">
                            <img src="{{ job.companyLogo|default(asset('assets/icons/job.png')) }}" 
                                alt="Logo" class="split-job-card-logo">
                            <div class="flex-grow-1">
                                <div class="split-job-card-title">{{ job.title }}</div>
                                <div class="split-job-card-company">{{ job.companyName|default('Company') }}</div>
                            </div>
                        </div>
                        <div class="split-job-summary">
                            <div class="split-job-summary-item">
                                <span class="split-job-meta-label">Match:</span>
                                <span class="split-job-meta-value">50%</span>
                            </div>
                            <div class="split-job-summary-item">
                                <span class="split-job-meta-label">Score:</span>
                                <span class="split-job-meta-value">{{ bookmark.rank is not null ? bookmark.rank : loop.index }}</span>
                            </div>
                        </div>
                        
                        <div class="split-job-card-meta">
                            {# Category removed from left card per request #}
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Right Side: Job Details -->
            <div class="split-job-details" id="split-job-details">
                <button id="detail-note-btn" class="action-btn" title="Add Note" style="position: absolute; top: 10px; right: 10px; display: none; cursor: pointer;">
                  <svg class="icon-image" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 3H14C16.7614 3 19 5.23858 19 8V14.5C19 15.0523 18.5523 15.5 18 15.5H14C12.3431 15.5 11 16.8431 11 18.5V20C11 20.5523 10.5523 21 10 21H8C5.23858 21 3 18.7614 3 16V8C3 5.23858 5.23858 3 8 3Z" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M21 7L15 13L14 16L17 15L23 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Note
                </button>
                <div class="no-job-selected">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H16M8 16H16M8 8H12M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <h4>Select a job to view details</h4>
                    <p>Click on any job from the list to see its full details here.</p>
                </div>
                
                <!-- Job details will be dynamically loaded here -->
                <div id="job-detail-content" style="display: none;"></div>
                
                <!-- Notes Drawer -->
                <aside id="notes-panel" class="notes-panel" aria-hidden="true">
                  <div class="notes-panel-header">
                    <span>Notes</span>
                    <button type="button" class="notes-panel-close" onclick="closeNotesPanel()"></button>
                  </div>
                  <div class="notes-panel-body">
                    <div class="notes-title">
                      <h6>Add notes for this job</h6>
                      <p class="text-muted">Your notes are saved automatically and only visible to you.</p>
                    </div>
                    <textarea id="notes-textarea" class="notes-textarea" placeholder="Write your notes here..."></textarea>
                    <div class="notes-footer">
                      <div class="last-saved" style="display: none;">
                        Last saved <span class="last-saved-time"></span>
                      </div>
                    </div>
                  </div>
                </aside>
            </div>
        </div>
    </div>
  </div>
  
  <!-- Email Template Modals -->
  <div id="email-modal-overlay" class="email-modal-overlay" style="display:none;"></div>
  <div id="email-template-1-modal" class="email-modal" aria-hidden="true" style="display:none;">
    <div class="email-modal-header">
      <h5>Email Template: Intro/Referral</h5>
      <button class="email-modal-close" data-close>&times;</button>
    </div>
    <div class="email-modal-body">
      <label>Subject</label>
      <input id="email-t1-subject" type="text" readonly>
      <label>Message</label>
      <textarea id="email-t1-message" readonly></textarea>
    </div>
    <div class="email-modal-footer">
      <button class="dropdown-cstm" data-copy-subject="#email-t1-subject">Copy Subject</button>
      <button class="dropdown-cstm" data-copy-message="#email-t1-message">Copy Message</button>
      <button class="action-btn" data-open-gmail data-sub="#email-t1-subject" data-body="#email-t1-message">Open in Gmail</button>
    </div>
  </div>
  <div id="email-template-2-modal" class="email-modal" aria-hidden="true" style="display:none;">
    <div class="email-modal-header">
      <h5>Email Template: Follow-up</h5>
      <button class="email-modal-close" data-close>&times;</button>
    </div>
    <div class="email-modal-body">
      <label>Subject</label>
      <input id="email-t2-subject" type="text" readonly>
      <label>Message</label>
      <textarea id="email-t2-message" readonly></textarea>
    </div>
    <div class="email-modal-footer">
      <button class="dropdown-cstm" data-copy-subject="#email-t2-subject">Copy Subject</button>
      <button class="dropdown-cstm" data-copy-message="#email-t2-message">Copy Message</button>
      <button class="action-btn" data-open-gmail data-sub="#email-t2-subject" data-body="#email-t2-message">Open in Gmail</button>
    </div>
  </div>
  <style>
  /* Split View Styles */
  .split-view-container {
      display: none;
      grid-template-columns: minmax(350px, 1fr) 1.5fr;
      gap: 20px;
      margin-top: 20px;
      height: 70vh;
      position: relative;
      transition: grid-template-columns 0.3s ease, gap 0.3s ease;
  }

  /* When collapsed, ensure single column layout */
  .split-view-container.list-collapsed {
      grid-template-columns: 1fr !important;
      gap: 0 !important;
  }
  
  /* Force the job list to be completely removed from layout */
  .split-view-container.list-collapsed > .split-job-list {
      display: none !important;
      grid-column: none !important;
      width: 0 !important;
      min-width: 0 !important;
      max-width: 0 !important;
      padding: 0 !important;
      margin: 0 !important;
      overflow: hidden !important;
      opacity: 0 !important;
      visibility: hidden !important;
      position: absolute !important;
      left: -9999px !important;
  }
  
  /* Force the job details to span full width */
  .split-view-container.list-collapsed > .split-job-details {
      grid-column: 1 / -1 !important;
      width: 100% !important;
      max-width: 100% !important;
  }

  .split-view-container .split-job-list {
      width: 100%;
      opacity: 1;
      transition: all 0.3s ease;
      position: relative;
      display: block;
  }

  .list-toggle-btn {
      display: none;
      position: fixed;
      background: #fff;
      border: 1px solid #e6eef6;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      padding: 0;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(11,22,40,0.15);
      transition: all 0.3s ease;
      align-items: center;
      justify-content: center;
  }

  .list-toggle-btn:hover {
      background: #F4F9F1;
      border-color: #85BB65;
      box-shadow: 0 4px 12px rgba(133, 187, 101, 0.3);
      transform: scale(1.1);
  }
  
  .list-toggle-btn:hover svg {
      transform: scale(1.1);
  }
  
  .split-view-container.list-collapsed .list-toggle-btn:hover svg {
      transform: rotate(180deg) scale(1.1);
  }

  .list-toggle-btn svg {
      width: 18px;
      height: 18px;
      transition: transform 0.3s ease;
  }

  /* Rotate arrow when collapsed */
  .split-view-container.list-collapsed .list-toggle-btn svg {
      transform: rotate(180deg);
  }
  

  .split-job-list {
      background: #F4F9F1;
      border: 1px solid #e6eef6;
      border-radius: 10px;
      padding: 16px;
      overflow-y: auto;
      box-shadow: 0 2px 6px rgba(11,22,40,0.03);
      position: relative; /* for collapse arrow positioning */
  }

  .split-job-details {
      background: #fff;
      border: 1px solid #e6eef6;
      border-radius: 10px;
      padding: 20px;
      overflow-y: auto;
      overflow-x: hidden;
      box-shadow: 0 2px 6px rgba(11,22,40,0.03);
      position: relative; /* anchor absolute buttons inside the details box */
  }
  
  /* Ensure job details content remains visible when notes panel is open */
  .split-job-details {
      transition: padding-right 0.2s ease;
      position: relative;
  }
  
  .split-job-details.notes-open {
      padding-right: 380px;
  }
  
  /* Ensure content inside job details is visible */
  .split-job-details #job-detail-content,
  .split-job-details .no-job-selected {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
  }
  
  /* When notes are open, content should be visible on the left side */
  .split-job-details.notes-open #job-detail-content,
  .split-job-details.notes-open .no-job-selected {
      overflow: visible;
  }

  .split-job-card {
      background: white;
      border: 1px solid #e6eef6;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
  }

  .split-job-card:hover {
      border-color: #85BB65;
      transform: translateX(2px);
  }

  .split-job-card.active {
      border-color: #85BB65;
      background-color: #F4F9F1;
  }

  .split-job-card-header {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 8px;
      position: relative;
  }

  .split-job-card-logo {
      width: 40px;
      height: 40px;
      border-radius: 6px;
      flex-shrink: 0;
  }

  .split-job-card-title {
      font-weight: 600;
      color: #121C0C;
      font-size: 16px;
      margin-bottom: 2px;
  }

  .split-job-card-company {
      color: #666;
      font-size: 13px;
  }

  .split-job-card-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
      font-size: 13px;
  }

  .split-job-summary {
      display: flex;
      align-items: center;
      gap: 14px;
      margin: 6px 0 4px 56px; /* indent to align under logo/title */
      font-size: 13px;
  }
  .split-job-summary-item {
      display: flex;
      gap: 6px;
  }

  .split-job-meta-item {
      display: flex;
      justify-content: space-between;
  }

  .split-job-meta-label {
      color: #666;
  }

  .split-job-meta-value {
      color: #121C0C;
      font-weight: 500;
  }

  /* Job Details Styles */
  .job-detail-header {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e6eef6;
  }

  .job-detail-logo {
      width: 60px;
      height: 60px;
      border-radius: 8px;
  }

  .job-detail-title {
      font-size: 24px;
      font-weight: 700;
      color: #121C0C;
      margin-bottom: 4px;
  }

  .job-detail-company {
      font-size: 16px;
      color: #666;
      margin-bottom: 8px;
  }

  .job-detail-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
  }

  .job-detail-meta-item {
      background: #F4F9F1;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #e6eef6;
  }

  .job-detail-meta-label {
      font-size: 13px;
      color: #666;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 4px;
  }

  .job-detail-meta-value {
      font-size: 16px;
      color: #121C0C;
      font-weight: 600;
  }

  .job-detail-section {
      margin-bottom: 24px;
  }

  .job-detail-section-title {
      font-size: 16px;
      font-weight: 600;
      color: #121C0C;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid #85BB65;
  }

  .job-detail-description {
      line-height: 1.6;
      color: #333;
  }

  .job-detail-requirements {
      list-style: none;
      padding: 0;
  }

  .job-detail-requirements li {
      padding: 4px 0;
      padding-left: 20px;
      position: relative;
  }

  .job-detail-requirements li:before {
      content: "";
      color: #47ddff;
      font-weight: bold;
      position: absolute;
      left: 0;
  }

  .job-detail-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid #e6eef6;
  }

  /* Active state for grid view button */
  #grid-view-btn.active {
      //background-color: #85BB65;
    
      border-color: #85BB65;
  }

  .no-job-selected {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #666;
      text-align: center;
  }

  .no-job-selected svg {
      margin-bottom: 16px;
      opacity: 0.5;
  }

  #float-view-btn.active {
    background-color: #85BB65 !important;
    color: white !important;
    border-color: #85BB65 !important;
}

#float-view-btn.active:hover {
    background-color: #85BB65 !important;
    border-color: #85BB65 !important;
}

  /* Note button styles removed */

  /* Notes side panel */
  .notes-panel {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    width: 360px;
    max-width: 90vw;
    background: #fff;
    border-left: 1px solid #e6eef6;
    box-shadow: -2px 0 8px rgba(11,22,40,0.06);
    transform: translateX(100%);
    transition: transform 0.2s ease;
    display: flex;
    flex-direction: column;
    z-index: 10;
    visibility: hidden;
    overflow-y: auto;
    pointer-events: none;
  }
  .notes-panel.open { 
    transform: translateX(0); 
    visibility: visible;
    pointer-events: auto;
  }
  
  .notes-panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 14px;
    border-bottom: 1px solid #e6eef6;
    font-weight: 600;
  }
  .notes-panel-close { 
    background: transparent; 
    border: none; 
    font-size: 22px; 
    cursor: pointer;
    color: #666;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
  }
  .notes-panel-close:hover {
    background: #f5f5f5;
    color: #333;
  }
  .notes-panel-body { 
    padding: 16px; 
    display: flex; 
    flex-direction: column; 
    height: 100%; 
  }
  .notes-title {
    margin-bottom: 16px;
  }
  .notes-title h6 {
    font-size: 14px;
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
  }
  .notes-title p {
    font-size: 12px;
    margin: 0;
  }
  .notes-textarea {
    width: 100%;
    flex: 1;
    resize: none;
    border: 1px solid #e6eef6;
    border-radius: 8px;
    padding: 12px;
    outline: none;
    font-size: 14px;
    line-height: 1.5;
    min-height: 200px;
  }
  .notes-textarea:focus {
    border-color: #85BB65;
    box-shadow: 0 0 0 2px rgba(133, 187, 101, 0.1);
  }
  .notes-footer {
    margin-top: 12px;
    color: #666;
    font-size: 12px;
  }
  .notes-footer .last-saved {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .notes-footer .last-saved::before {
    content: "";
    color: #85BB65;
  }
  
  /* Email modal styles */
  .email-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.3);
    z-index: 999;
  }
  .email-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: min(700px, 95vw);
    max-height: 80vh;
    background: #fff;
    border: 1px solid #e6eef6;
    border-radius: 10px;
    box-shadow: 0 6px 18px rgba(11,22,40,0.15);
    display: flex;
    flex-direction: column;
    z-index: 1000;
    overflow-y: auto;
  }
  .email-modal-header { 
    display: flex; justify-content: space-between; align-items: center; 
    padding: 12px 14px; border-bottom: 1px solid #e6eef6; 
  }
  .email-modal-body { padding: 14px; display: flex; flex-direction: column; gap: 8px; }
  .email-modal-body input, .email-modal-body textarea {
    width: 100%; border: 1px solid #e6eef6; border-radius: 8px; padding: 10px; outline: none;
  }
  .email-modal-body textarea { min-height: 180px; resize: vertical; }
  .email-modal-footer { display: flex; gap: 8px; padding: 12px 14px; border-top: 1px solid #e6eef6; }
  .email-modal-close { background: transparent; border: none; font-size: 22px; cursor: pointer; color: #666; }
  </style>
    <script>
  document.addEventListener('DOMContentLoaded', function () {
    const checkboxes = document.querySelectorAll('.job-checkbox');
    const applyBtn = document.getElementById('apply-btn');
    const saveBtn = document.getElementById('save-btn');
    const deleteBtn = document.getElementById('delete-btn');
    const emailBtn = document.getElementById('email-btn');
    const actionsDivs = document.querySelectorAll('.hidden-buttons');
    const columnsBtn = document.querySelector('.columns-dropdown-btn');
    const menuBtn = document.querySelector('.menu-dropdown-btn');
    const columnsPanel = document.querySelector('.columns-panel');
    const menuPanel = document.querySelector('.menu-panel');

    function toggleDropdown(panel, btn) {
        const isOpen = !panel.classList.contains('hidden');
        closeAllDropdowns();
        if (!isOpen) panel.classList.remove('hidden');
    }

    function closeAllDropdowns() {
        columnsPanel.classList.add('hidden');
        menuPanel.classList.add('hidden');
    }

    columnsBtn.addEventListener('click', e => {
        e.stopPropagation();
        toggleDropdown(columnsPanel, columnsBtn);
    });

    menuBtn.addEventListener('click', e => {
        e.stopPropagation();
        toggleDropdown(menuPanel, menuBtn);
    });

    document.addEventListener('click', e => {
        // Only close if click is outside both dropdowns and buttons
        if (
          !columnsPanel.contains(e.target) &&
          !columnsBtn.contains(e.target) &&
          !menuPanel.contains(e.target) &&
          !menuBtn.contains(e.target)
        ) {
            closeAllDropdowns();
        }
  });

    // Link email button to email modal
    if (emailBtn) {
      emailBtn.addEventListener('click', () => openEmailModal(1));
    }
    // Note: save-btn is now handled by the notify hire functionality below

    // Select all checkbox has been removed from the UI

    // Update the toggleActionsVisibility function
    function toggleActionsVisibility() {
        const listCheckboxes = document.querySelectorAll('.job-list-container .job-checkbox');
        const splitCheckboxes = document.querySelectorAll('#split-job-list .job-checkbox');
        const allCheckboxes = [...listCheckboxes, ...splitCheckboxes];
        let checkedCount = Array.from(allCheckboxes).filter(cb => cb.checked).length;
        const anyChecked = checkedCount > 0;
        const splitViewContainer = document.getElementById('split-view-container');
        const isSplitActive = splitViewContainer && splitViewContainer.style.display === 'grid';
        // Buttons visibility panel (compact row) still toggles by selection in list view only
        actionsDivs.forEach(div => {
            if (isSplitActive) {
                // Hide duplicate compact buttons in split view
                div.style.display = 'none';
            } else {
                div.style.display = 'flex';
                div.style.visibility = anyChecked ? 'visible' : 'hidden';
            }
        });
        
        // Show/hide Apply and Note - use visibility to maintain layout
        const applyButtons = document.querySelectorAll('#apply-btn');
        const noteButtons = document.querySelectorAll('#note-btn');
        const showApply = checkedCount === 1;
        // Show Note only when exactly one job is selected
        const showNote = checkedCount === 1;
        applyButtons.forEach(btn => { 
            if (showApply) {
                btn.classList.remove('hidden-btn');
                btn.style.visibility = 'visible';
                btn.style.opacity = '1';
                btn.style.pointerEvents = 'auto';
            } else {
                btn.classList.add('hidden-btn');
                btn.style.visibility = 'hidden';
                btn.style.opacity = '0';
                btn.style.pointerEvents = 'none';
            }
        });
        noteButtons.forEach(btn => { 
            if (showNote) {
                btn.classList.remove('hidden-btn');
                btn.style.visibility = 'visible';
                btn.style.opacity = '1';
                btn.style.pointerEvents = 'auto';
            } else {
                btn.classList.add('hidden-btn');
                btn.style.visibility = 'hidden';
                btn.style.opacity = '0';
                btn.style.pointerEvents = 'none';
            }
        });
        
        // Leave Email button behavior unchanged
    }

    // Update the updateButtonStates function
    function updateButtonStates() {
        const listCheckboxes = document.querySelectorAll('.job-list-container .job-checkbox');
        const splitCheckboxes = document.querySelectorAll('#split-job-list .job-checkbox');
        const allCheckboxes = [...listCheckboxes, ...splitCheckboxes];
        
        let checkedCount = Array.from(allCheckboxes).filter(cb => cb.checked).length;
        const splitViewContainer = document.getElementById('split-view-container');
        const isSplitActive = splitViewContainer && splitViewContainer.style.display === 'grid';
        const showApply = checkedCount === 1;
        const showNote = checkedCount === 1;

        // Show/hide and enable/disable Apply and Note - use visibility to maintain layout
        const applyButtons = document.querySelectorAll('#apply-btn');
        const noteButtons = document.querySelectorAll('#note-btn');
        applyButtons.forEach(btn => { 
            btn.disabled = !showApply;
            if (showApply) {
                btn.classList.remove('hidden-btn');
                btn.style.visibility = 'visible';
                btn.style.opacity = '1';
                btn.style.pointerEvents = 'auto';
            } else {
                btn.classList.add('hidden-btn');
                btn.style.visibility = 'hidden';
                btn.style.opacity = '0';
                btn.style.pointerEvents = 'none';
            }
        });
        noteButtons.forEach(btn => { 
            if (showNote) {
                btn.classList.remove('hidden-btn');
                btn.style.visibility = 'visible';
                btn.style.opacity = '1';
                btn.style.pointerEvents = 'auto';
            } else {
                btn.classList.add('hidden-btn');
                btn.style.visibility = 'hidden';
                btn.style.opacity = '0';
                btn.style.pointerEvents = 'none';
            }
        });
        
        // Leave Email button behavior unchanged
    }

      checkboxes.forEach(cb => {
        cb.addEventListener('change', toggleActionsVisibility);
      });

    // Initial check in case some boxes are pre-checked
    toggleActionsVisibility();

    function updateActions() {
      const checked = Array.from(checkboxes).filter(cb => cb.checked);
      const applyButtons = document.querySelectorAll('#apply-btn');
      const noteButtons = document.querySelectorAll('#note-btn');
      const splitViewContainer = document.getElementById('split-view-container');
      const isSplitActive = splitViewContainer && splitViewContainer.style.display === 'grid';
      const showApply = (checked.length === 1);
      const showNote = (checked.length === 1);
      applyButtons.forEach(btn => { 
          btn.disabled = !showApply;
          if (showApply) {
              btn.classList.remove('hidden-btn');
              btn.style.visibility = 'visible';
              btn.style.opacity = '1';
              btn.style.pointerEvents = 'auto';
          } else {
              btn.classList.add('hidden-btn');
              btn.style.visibility = 'hidden';
              btn.style.opacity = '0';
              btn.style.pointerEvents = 'none';
          }
      });
      noteButtons.forEach(btn => { 
          if (showNote) {
              btn.classList.remove('hidden-btn');
              btn.style.visibility = 'visible';
              btn.style.opacity = '1';
              btn.style.pointerEvents = 'auto';
          } else {
              btn.classList.add('hidden-btn');
              btn.style.visibility = 'hidden';
              btn.style.opacity = '0';
              btn.style.pointerEvents = 'none';
          }
      });
    }

    checkboxes.forEach(cb => {
      cb.addEventListener('change', updateActions);
    });

    // Safety net: recompute UI on any click within the listings area
    const listingsRoot = document;
    listingsRoot.addEventListener('click', () => {
      try { toggleActionsVisibility(); updateButtonStates(); } catch(e) {}
    });

    // Delegated change listener to catch any checkbox state changes reliably
    document.addEventListener('change', (e) => {
      const target = e.target;
      if (!target) return;
      if (target.classList && target.classList.contains('job-checkbox')) {
        // Enforce single selection
        if (target.checked) {
          // Get all checkboxes (including split view ones)
          const allCheckboxes = document.querySelectorAll('.job-checkbox');
          const otherChecked = Array.from(allCheckboxes).find(cb => cb !== target && cb.checked);
          if (otherChecked) {
            // Prevent this checkbox from being checked and show alert
            target.checked = false;
              showWarningAlert('Multiple Selection', 'You cannot select multiple values');
            return;
          }
        }
        try { toggleActionsVisibility(); updateButtonStates(); } catch (e) {}
      }
    });

    // Ensure notes panel is closed by default
    try { closeNotesPanel && closeNotesPanel(); } catch (e) {}

    // Change blue NEW badge to green
    function changeNewBadgeToGreen() {
        // Find all elements that might contain "NEW" text
        const allElements = document.querySelectorAll('span, div, .badge, [class*="badge"]');
        allElements.forEach(element => {
            const text = element.textContent.trim().toUpperCase();
            if (text === 'NEW') {
                // Check if it has a blue background
                const style = window.getComputedStyle(element);
                const bgColor = style.backgroundColor;
                // Check for blue colors (common blue hex codes)
                if (bgColor.includes('rgb(13, 110, 253)') || 
                    bgColor.includes('rgb(0, 123, 255)') || 
                    bgColor.includes('rgb(6, 182, 212)') ||
                    element.style.backgroundColor === '#0d6efd' ||
                    element.style.backgroundColor === '#007bff' ||
                    element.style.backgroundColor === '#06b6d4' ||
                    element.style.backgroundColor.includes('#0d6efd') ||
                    element.style.backgroundColor.includes('#007bff') ||
                    element.style.backgroundColor.includes('#06b6d4')) {
                    element.style.backgroundColor = '#85BB65';
                    element.style.color = '#fff';
                }
            }
        });
    }
    
    // Run on page load
    changeNewBadgeToGreen();
    
    // Also run after a short delay to catch dynamically added badges
    setTimeout(changeNewBadgeToGreen, 500);
    setTimeout(changeNewBadgeToGreen, 1000);

    // Set up note auto-save functionality
    setupNoteAutoSave();
    
    // Apply button handler
    if (applyBtn) {
        applyBtn.addEventListener('click', () => {
            const selectedCheckboxes = Array.from(document.querySelectorAll('.job-checkbox:checked'));
            const selectedIds = selectedCheckboxes.map(cb => cb.dataset.jobId);
            
            if (selectedIds.length === 0) {
                showToast('Please select at least one job to apply to.', 'warning');
                return;
            }
            
            if (selectedIds.length === 1) {
                // Single job: redirect to apply page
                const jobId = selectedIds[0];
                window.location.href = `/provider/jobs/${jobId}/apply?redirect_route=app_provider_jobs_saved`;
            } else {
                // Multiple jobs: use batch apply
                if (confirm(`Are you sure you want to apply to ${selectedIds.length} jobs?`)) {
                    // Use fetch API with JSON format (preferred method)
                    fetch('{{ path("app_provider_saved_jobs_apply") }}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        body: JSON.stringify({
                            jobIds: selectedIds
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showToast(`Successfully applied to ${data.appliedCount || selectedIds.length} job(s)!`, 'success');
                            // Remove applied jobs from UI
                            selectedCheckboxes.forEach(cb => {
                                const row = cb.closest('.job-lists');
                                if (row) row.remove();
                                const card = cb.closest('.split-job-card');
                                if (card) card.remove();
                            });
                            // Uncheck all checkboxes
                            document.querySelectorAll('.job-checkbox').forEach(cb => cb.checked = false);
                            toggleActionsVisibility();
                            updateButtonStates();
                            // Refresh page after a delay
                            setTimeout(() => {
                                window.location.reload();
                            }, 1500);
                        } else {
                            showToast('Error: ' + (data.message || 'Failed to apply to jobs'), 'error');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showToast('Network error. Please try again.', 'error');
                    });
                }
            }
        });
    }

    // Note: save-btn click is now handled by notify hire functionality below

    // Delete button handler
    if (deleteBtn) {
        deleteBtn.addEventListener('click', () => {
            const selectedCheckboxes = Array.from(document.querySelectorAll('.job-checkbox:checked'));
            const selectedIds = selectedCheckboxes.map(cb => cb.dataset.jobId);
            
            if (selectedIds.length === 0) {
                showToast('Please select at least one job to delete.', 'warning');
                return;
            }
            
            // Show confirmation modal
            const modal = document.getElementById('deleteConfirmModal');
            if (modal) {
                const bsModal = new bootstrap.Modal(modal);
                bsModal.show();
                
                // Handle confirm delete
                const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
                if (confirmDeleteBtn) {
                    const handleConfirm = () => {
                        // Set the bookmark IDs in the form
                        const bookmarkIdsInput = document.getElementById('bookmark-ids-input');
                        if (bookmarkIdsInput) {
                            bookmarkIdsInput.value = selectedIds.join(',');
                        }
                        
                        // Submit the form
                        const deleteForm = document.getElementById('delete-bookmarks-form');
                        if (deleteForm) {
                            deleteForm.submit();
                        } else {
                            // Fallback: use fetch API
                            fetch('{{ path("app_provider_bookmarks_delete") }}', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/x-www-form-urlencoded',
                                    'X-Requested-With': 'XMLHttpRequest'
                                },
                                body: new URLSearchParams({
                                    '_token': '{{ csrf_token("delete_bookmarks") }}',
                                    'bookmark_ids': selectedIds.join(',')
                                })
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    showToast('Jobs deleted successfully!', 'success');
                                    // Remove deleted jobs from UI
                                    selectedCheckboxes.forEach(cb => {
                                        const row = cb.closest('.job-lists');
                                        if (row) row.remove();
                                        const card = cb.closest('.split-job-card');
                                        if (card) card.remove();
                                    });
                                    // Uncheck all checkboxes
                                    document.querySelectorAll('.job-checkbox').forEach(cb => cb.checked = false);
                                    toggleActionsVisibility();
                                    updateButtonStates();
                                } else {
                                    showToast('Error: ' + (data.message || 'Failed to delete jobs'), 'error');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                showToast('Network error. Please try again.', 'error');
                            });
                        }
                        
                        bsModal.hide();
                        confirmDeleteBtn.removeEventListener('click', handleConfirm);
                    };
                    
                    confirmDeleteBtn.addEventListener('click', handleConfirm, { once: true });
                }
            } else {
                // Fallback: direct confirmation
                if (confirm('Are you sure you want to delete the selected jobs? This action cannot be undone.')) {
                    const bookmarkIdsInput = document.getElementById('bookmark-ids-input');
                    const deleteForm = document.getElementById('delete-bookmarks-form');
                    if (bookmarkIdsInput && deleteForm) {
                        bookmarkIdsInput.value = selectedIds.join(',');
                        deleteForm.submit();
                    }
                }
            }
        });
    }
    
    // Archive button handler - Using exact same implementation as applications page
    const archiveBtn = document.getElementById('archive-btn');
    if (archiveBtn) {
        archiveBtn.addEventListener('click', async function () {
            // 1 Collect selected bookmark IDs
            const selectedIds = Array.from(document.querySelectorAll(".job-check.job-checkbox:checked, .job-checkbox:checked"))
                                     .map(cb => cb.dataset.bookmarkId || cb.dataset.jobId)
                                     .filter(id => id); // Filter out undefined values
            
            if (selectedIds.length === 0) {
                showWarningAlert('No Selection', 'Please select at least one job to archive.');
                return;
            }
            
            showConfirmAlert(
                'Archive Jobs',
                `Are you sure you want to archive ${selectedIds.length} job(s)?`,
                'Archive',
                'Cancel',
                async function(confirmed) {
                    if (!confirmed) return;
                    
                    try {
                        // 2 Send archive request
                        const response = await fetch('{{ path("app_provider_bookmarks_archive") }}', {
                            method: "POST",
                    headers: {
                                "Content-Type": "application/json",
                                "X-Requested-With": "XMLHttpRequest"
                            },
                            body: JSON.stringify({ bookmark_ids: selectedIds })
                        });

                        const result = await response.json();

                        if (result.success) {
                            showSuccessAlert('Success', result.message);

                            // 3 Remove archived rows from DOM
                            selectedIds.forEach(id => {
                                // Try to find by bookmark-id first, then by job-id
                                let checkbox = document.querySelector(`.job-check.job-checkbox[data-bookmark-id="${id}"]`);
                                if (!checkbox) {
                                    checkbox = document.querySelector(`.job-checkbox[data-bookmark-id="${id}"]`);
                                }
                                if (!checkbox) {
                                    checkbox = document.querySelector(`.job-check.job-checkbox[data-job-id="${id}"]`);
                                }
                                if (!checkbox) {
                                    checkbox = document.querySelector(`.job-checkbox[data-job-id="${id}"]`);
                                }
                                
                                if (checkbox) {
                                    // Remove the entire job-lists container (parent of job-row)
                                    const jobList = checkbox.closest(".job-lists");
                                    if (jobList) {
                                        jobList.remove();
                                    } else {
                                        // Fallback: remove just the job-row or split-job-card
                                        const row = checkbox.closest(".job-row");
                            if (row) row.remove();
                                        const card = checkbox.closest(".split-job-card");
                            if (card) card.remove();
                                    }
                                }
                            });
                            
                            // Update UI after removal
                            const remainingRows = document.querySelectorAll('.job-lists');
                            if (remainingRows.length === 0) {
                                const container = document.querySelector('.job-list-container');
                                if (container) {
                                    container.innerHTML = '<p class="mb-0">Saved jobs not found.</p>';
                                }
                            }
                            
                            // Uncheck all checkboxes and update button states
                        document.querySelectorAll('.job-checkbox').forEach(cb => cb.checked = false);
                            if (typeof toggleActionsVisibility === 'function') {
                        toggleActionsVisibility();
                            }
                            if (typeof updateButtonStates === 'function') {
                        updateButtonStates();
                            }

                    } else {
                            showErrorAlert('Error', result.message || "Something went wrong.");
                        }
                    } catch (error) {
                        console.error("Error archiving jobs:", error);
                        showErrorAlert('Error', 'An error occurred while archiving jobs.');
                    }
                }
            );
        });
    }
  });
</script>
<script>
  // Split View Functionality
  document.addEventListener('DOMContentLoaded', function () {
  const gridViewBtn = document.getElementById('grid-view-btn');
  const listViewContainer = document.querySelector('.job-list-container');
  const splitViewContainer = document.getElementById('split-view-container');
  const splitJobList = document.getElementById('split-job-list');
  const splitJobDetails = document.getElementById('split-job-details');
  const jobDetailContent = document.getElementById('job-detail-content');
  const noJobSelected = document.querySelector('.no-job-selected');
  const detailNoteBtn = document.getElementById('detail-note-btn');
  
  let selectedJobId = null;
  
  if (gridViewBtn && listViewContainer && splitViewContainer) {
    gridViewBtn.addEventListener('click', function () {
        const isSplitView = splitViewContainer.style.display === 'grid';
        
        const actionsContainer = document.querySelector('.actions-container');
        
        if (isSplitView) {
            // Switch to list view
            splitViewContainer.style.display = 'none';
            listViewContainer.style.display = 'block';
            gridViewBtn.classList.remove('active');
            gridViewBtn.innerHTML = `
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 3H10V10H3V3Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 3H21V10H14V3Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 14H10V21H3V14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 14H21V21H14V14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Grid View
            `;
            // Remove scrollable class for list view
            if (actionsContainer) {
                actionsContainer.classList.remove('scrollable');
            }
            window.selectedJobId = null;
            try { closeNotesPanel && closeNotesPanel(); } catch (e) {}
            try { toggleActionsVisibility && toggleActionsVisibility(); } catch (e) {}
            if (detailNoteBtn) { detailNoteBtn.style.display = 'none'; }
        } else {
            // Switch to split view
            splitViewContainer.style.display = 'grid';
            listViewContainer.style.display = 'none';
            gridViewBtn.classList.add('active');
            gridViewBtn.innerHTML = `
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 6H21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M3 11H21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M3 16H21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                List View
            `;
            // Add scrollable class for split view
            if (actionsContainer) {
                actionsContainer.classList.add('scrollable');
            }
            // Auto-select the first job card
            const firstJobCard = splitJobList.querySelector('.split-job-card');
            if (firstJobCard) {
                selectJobCard(firstJobCard);
            } else {
                selectedJobId = null;
                window.selectedJobId = null;
            }
            // Ensure Note button visibility is updated
            try { closeNotesPanel && closeNotesPanel(); toggleActionsVisibility && toggleActionsVisibility(); updateButtonStates && updateButtonStates(); } catch (e) {}
        }
    });
  }
  
  // Job card selection
  splitJobList.addEventListener('click', function (e) {
      const jobCard = e.target.closest('.split-job-card');
      if (jobCard && !e.target.classList.contains('job-checkbox')) {
          selectJobCard(jobCard);
      }
  });
  
  function selectJobCard(jobCard) {
      // Remove active class from all cards
      document.querySelectorAll('.split-job-card').forEach(card => {
          card.classList.remove('active');
      });
      
      // Uncheck all checkboxes in split view
      splitJobList.querySelectorAll('.job-checkbox').forEach(checkbox => {
          checkbox.checked = false;
      });
      
      // Add active class to selected card
      jobCard.classList.add('active');
      
      // Check the checkbox for the selected job
      const checkbox = jobCard.querySelector('.job-checkbox');
      if (checkbox) {
          checkbox.checked = true;
          // Trigger change event to update button states
          checkbox.dispatchEvent(new Event('change', { bubbles: true }));
      }
      
      // Get job ID and load details
      selectedJobId = jobCard.dataset.jobId;
      window.selectedJobId = selectedJobId;
      try { toggleActionsVisibility && toggleActionsVisibility(); updateButtonStates && updateButtonStates(); } catch (e) {}
      // If notes panel is open, load notes for the newly selected job
      const notesPanel = document.getElementById('notes-panel');
      if (notesPanel && notesPanel.classList.contains('open')) {
          openNotesPanel(selectedJobId);
      }
      loadJobDetails(selectedJobId);
  }

  function loadJobDetails(jobId) {
      // Show loading state
      noJobSelected.style.display = 'none';
      jobDetailContent.style.display = 'block';
      jobDetailContent.innerHTML = `
          <div class="text-center py-5">
              <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-2">Loading job details...</p>
          </div>
      `;
      
      // Simulate AJAX call to fetch job details
      // In a real application, you would make an API call here
      setTimeout(() => {
          renderJobDetails(jobId);
      }, 500);
  }
  
  function renderJobDetails(jobId) {
    console.log('Loading job details for ID:', jobId);
    
    const jobDetailContent = document.getElementById('job-detail-content');
    const noJobSelected = document.querySelector('.no-job-selected');
    
    // Show loading state
    jobDetailContent.innerHTML = `
        <div class="text-center py-5">
            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h5 class="text-muted">Loading Job Details</h5>
        </div>
    `;
    
    const url = `/provider/jobs/${jobId}/detail-content`;
    
    fetch(url)
        .then(response => response.text().then(text => {
            console.log('Raw response:', text);
            
            if (!response.ok) {
                // Show the actual server error message
                throw new Error(`Server returned: ${text}`);
            }
            return text;
        }))
        .then(html => {
            jobDetailContent.innerHTML = html;
            jobDetailContent.style.display = 'block';
            if (noJobSelected) noJobSelected.style.display = 'none';
            if (detailNoteBtn) { detailNoteBtn.style.display = 'flex'; }
            // Update toggle button position after content loads
            setTimeout(() => {
                if (typeof updateToggleButtonPosition === 'function') {
                    updateToggleButtonPosition();
                }
            }, 100);
        })
        .catch(error => {
            console.error('Full error:', error);
            jobDetailContent.innerHTML = `
                <div class="alert alert-danger">
                    <h4>Error Loading Job Details</h4>
                    <div>${error.message}</div>
                    <div class="mt-3">
                        <button class="action-btn" onclick="loadJobDetails('${jobId}')">Try Again</button>
                        <a href="/provider/jobs/${jobId}" class="action-btn">View Full Page</a>
                    </div>
                </div>
            `;
            jobDetailContent.style.display = 'block';
            if (noJobSelected) noJobSelected.style.display = 'none';
        });
}

function loadJobDetails(jobId) {
    renderJobDetails(jobId);
}

function applyToJob(jobId) {
    if (confirm('Are you sure you want to apply to this job?')) {
        // Show loading state on button
        const applyBtn = document.querySelector('.btn-apply');
        if (applyBtn) {
            const originalText = applyBtn.innerHTML;
            applyBtn.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Applying...';
            applyBtn.disabled = true;
        }
        
        window.location.href = `/provider/jobs/${jobId}/apply?redirect_route=app_provider_jobs_saved`;
    }
}

function saveJob(jobId) {
    const saveBtn = document.querySelector('.btn-save');
    const originalText = saveBtn.innerHTML;
    
    // Show loading state
    saveBtn.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Saving...';
    saveBtn.disabled = true;

    fetch(`/provider/jobs/${jobId}/save`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('Job saved successfully!', 'success');
            saveBtn.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
                </svg>
                Saved
            `;
            saveBtn.classList.add('btn-applied');
            saveBtn.onclick = null;
        } else {
            showToast('Error: ' + data.error, 'error');
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        }
    })
    .catch(error => {
        console.error('Error saving job:', error);
        showToast('Error saving job. Please try again.', 'error');
        saveBtn.innerHTML = originalText;
        saveBtn.disabled = false;
    });
}
function openNotesPanel(jobId) {
    const panel = document.getElementById('notes-panel');
    const textarea = document.getElementById('notes-textarea');
    const jobDetails = document.getElementById('split-job-details');
    if (!panel || !textarea) return;
    panel.dataset.jobId = jobId;
    const saved = localStorage.getItem('provider_job_notes_' + jobId) || '';
    textarea.value = saved;
    panel.classList.add('open');
    panel.setAttribute('aria-hidden', 'false');
    // Add class to job details container to adjust layout
    if (jobDetails) {
        jobDetails.classList.add('notes-open');
    }
    textarea.focus();
}
function closeNotesPanel() {
    const panel = document.getElementById('notes-panel');
    const jobDetails = document.getElementById('split-job-details');
    if (!panel) return;
    panel.classList.remove('open');
    panel.setAttribute('aria-hidden', 'true');
    // Remove class from job details container to restore layout
    if (jobDetails) {
        jobDetails.classList.remove('notes-open');
    }
}
function handleNoteClick() {
    // Prefer selected card in split view; fallback to a single checked checkbox
    const splitViewContainer = document.getElementById('split-view-container');
    const isSplitActive = splitViewContainer && splitViewContainer.style.display === 'grid';
    let jobId = null;
    if (isSplitActive) {
        jobId = window.selectedJobId || null;
        if (!jobId) {
            const activeCard = document.querySelector('.split-job-card.active');
            if (activeCard) jobId = activeCard.dataset.jobId;
        }
    }
    if (!jobId) {
        const single = Array.from(document.querySelectorAll('.job-checkbox')).filter(cb => cb.checked);
        if (single.length === 1) jobId = single[0].dataset.jobId;
    }
    if (jobId) {
        openNotesPanel(jobId);
    }
}

// Inline note panel on each split job card
function openInlineNote(jobId, btn) {
  const card = btn.closest('.split-job-card');
  if (!card) return;
  const panel = card.querySelector('.card-note-panel');
  const textarea = panel.querySelector('.card-note-textarea');
  // Load saved note
  const key = 'provider_job_notes_' + jobId;
  textarea.value = localStorage.getItem(key) || '';
  panel.classList.toggle('open');
  textarea.addEventListener('input', () => {
    localStorage.setItem(key, textarea.value);
  }, { once: true });
}
    
  // Checkbox syncing is now handled by the delegated change listener above
  // No need for separate event listeners here
});


</script>
<script>
// Global utility functions
function updateButtonStates() {
  const listCheckboxes = document.querySelectorAll('.job-list-container .job-checkbox');
  const splitCheckboxes = document.querySelectorAll('#split-job-list .job-checkbox');
  const allCheckboxes = [...listCheckboxes, ...splitCheckboxes];
  
  let checkedCount = Array.from(allCheckboxes).filter(cb => cb.checked).length;
  const showApply = checkedCount === 1;
  const showNote = checkedCount === 1;

  // Show/hide and enable/disable Apply and Note buttons
  const applyButtons = document.querySelectorAll('#apply-btn');
  const noteButtons = document.querySelectorAll('#note-btn');
  
  applyButtons.forEach(btn => { 
    btn.disabled = !showApply;
    if (showApply) {
        btn.classList.remove('hidden-btn');
        btn.style.visibility = 'visible';
        btn.style.opacity = '1';
        btn.style.pointerEvents = 'auto';
    } else {
        btn.classList.add('hidden-btn');
        btn.style.visibility = 'hidden';
        btn.style.opacity = '0';
        btn.style.pointerEvents = 'none';
    }
  });
  
  noteButtons.forEach(btn => { 
    if (showNote) { 
        btn.classList.remove('hidden-btn', 'd-none');
        btn.classList.add('d-flex');
        btn.style.visibility = 'visible';
        btn.style.opacity = '1';
        btn.style.pointerEvents = 'auto';
    } else { 
        btn.classList.add('hidden-btn', 'd-none');
        btn.classList.remove('d-flex');
        btn.style.visibility = 'hidden';
        btn.style.opacity = '0';
        btn.style.pointerEvents = 'none';
    }
  });
}

function toggleActionsVisibility() {
  const listCheckboxes = document.querySelectorAll('.job-list-container .job-checkbox');
  const splitCheckboxes = document.querySelectorAll('#split-job-list .job-checkbox');
  const allCheckboxes = [...listCheckboxes, ...splitCheckboxes];
  let checkedCount = Array.from(allCheckboxes).filter(cb => cb.checked).length;
  const anyChecked = checkedCount > 0;
  const splitViewContainer = document.getElementById('split-view-container');
  const isSplitActive = splitViewContainer && splitViewContainer.style.display === 'grid';
  
  // Show/hide based strictly on selections, regardless of split view
  
  const actionsDivs = document.querySelectorAll('.hidden-buttons');
  actionsDivs.forEach(div => {
    if (isSplitActive) {
      // Hide duplicate compact buttons in split view
      div.style.display = 'none';
    } else {
      div.style.display = 'flex';
      div.style.visibility = anyChecked ? 'visible' : 'hidden';
    }
  });
  
  // Show/hide Apply and Note buttons
  updateButtonStates();
}

function openNotesPanel(jobId) {
  const panel = document.getElementById('notes-panel');
  const textarea = document.getElementById('notes-textarea');
  const jobDetails = document.getElementById('split-job-details');
  if (!panel || !textarea) return;
  
  panel.dataset.jobId = jobId;
  const saved = localStorage.getItem('provider_job_notes_' + jobId) || '';
  textarea.value = saved;
  panel.classList.add('open');
  panel.setAttribute('aria-hidden', 'false');
  // Add class to job details container to adjust layout
  if (jobDetails) {
    jobDetails.classList.add('notes-open');
  }
  textarea.focus();
}

function closeNotesPanel() {
  const panel = document.getElementById('notes-panel');
  const jobDetails = document.getElementById('split-job-details');
  if (!panel) return;
  panel.classList.remove('open');
  panel.setAttribute('aria-hidden', 'true');
  panel.dataset.jobId = '';
  // Remove class from job details container to restore layout
  if (jobDetails) {
    jobDetails.classList.remove('notes-open');
  }
}

// Add Note button event handler
document.addEventListener('DOMContentLoaded', function() {
  const noteBtn = document.getElementById('note-btn');
  if (noteBtn) {
    noteBtn.addEventListener('click', function() {
      let jobId = null;
      const single = Array.from(document.querySelectorAll('.job-checkbox')).filter(cb => cb.checked);
      if (single.length === 1) jobId = single[0].dataset.jobId;
      if (!jobId) {
        jobId = window.selectedJobId || null;
        if (!jobId) {
          const activeCard = document.querySelector('.split-job-card.active');
          if (activeCard) jobId = activeCard.dataset.jobId;
        }
      }
      if (jobId) { openNotesPanel(jobId); }
    });
  }
  const detailNoteBtn = document.getElementById('detail-note-btn');
  if (detailNoteBtn) {
    detailNoteBtn.addEventListener('click', function() {
      // Collapse the list when note button is clicked
      const container = document.getElementById('split-view-container');
      if (container && !container.classList.contains('list-collapsed')) {
        container.classList.add('list-collapsed');
        const splitJobList = document.getElementById('split-job-list');
        const splitJobDetails = document.getElementById('split-job-details');
        if (splitJobList) {
          splitJobList.style.display = 'none';
          splitJobList.style.width = '0';
          splitJobList.style.minWidth = '0';
          splitJobList.style.maxWidth = '0';
          splitJobList.style.padding = '0';
          splitJobList.style.margin = '0';
          splitJobList.style.visibility = 'hidden';
        }
        if (splitJobDetails) {
          splitJobDetails.style.gridColumn = '1 / -1';
          splitJobDetails.style.width = '100%';
          splitJobDetails.style.maxWidth = '100%';
        }
        // Update toggle button position if it exists
        const toggleBtn = document.getElementById('list-toggle-btn');
        if (toggleBtn && typeof updateToggleButtonPosition === 'function') {
          updateToggleButtonPosition();
        }
      }
      const jobId = window.selectedJobId;
      if (jobId) { openNotesPanel(jobId); }
    });
  }
});

document.addEventListener('DOMContentLoaded', function () {
  const headers = document.querySelectorAll('.sortable');
  let currentSort = { key: null, direction: 'asc' };

  headers.forEach(header => {
    header.addEventListener('click', () => {
      const key = header.dataset.sort;
      const direction = (currentSort.key === key && currentSort.direction === 'asc') ? 'desc' : 'asc';
      currentSort = { key, direction };

      // Reset all arrows to inactive
      document.querySelectorAll('.sort-toggle .arrow').forEach(a => a.classList.remove('active'));
      // Activate the appropriate arrow on current header
      const up = header.querySelector('.sort-toggle .sort-up');
      const down = header.querySelector('.sort-toggle .sort-down');
      if (direction === 'asc' && up) up.classList.add('active');
      if (direction === 'desc' && down) down.classList.add('active');

      sortJobs(key, direction);
    });
  });

  function sortJobs(key, direction) {
    const rows = Array.from(document.querySelectorAll('.job-row')).map(row => ({
      element: row,
      job: {
        job: row.querySelector('.job-title')?.textContent.trim().toLowerCase(),
        location: row.querySelector('.col-start:nth-child(3)')?.textContent.trim().toLowerCase(),
        posted: row.querySelector('.col-start:nth-child(4)')?.textContent.trim(),
        expires: row.querySelector('.col-expiry')?.textContent.trim(),
        salary: parseFloat(row.querySelector('.col-start:nth-child(6)')?.textContent.trim()) || 0,
        category: (() => {
          const cells = Array.from(row.querySelectorAll('.col-start.col-center'));
          // Category is the one that comes after salary and before rank
          // Find the cell that contains category text (Locums, Parttime, Full time)
          const categoryCell = cells.find(cell => {
            const text = cell.textContent.trim().toLowerCase();
            return text === 'locums' || text === 'parttime' || text === 'full time';
          });
          return categoryCell?.textContent.trim().toLowerCase() || '';
        })(),
        rank: parseInt(row.querySelector('.col-rank')?.textContent.trim()) || 0
      }
    }));

    rows.sort((a, b) => {
      const valA = a.job[key];
      const valB = b.job[key];
      if (typeof valA === 'string') {
        return direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
      } else {
        return direction === 'asc' ? valA - valB : valB - valA;
      }
    });

    const container = document.querySelector('.job-list-container');
    rows.forEach(row => container.appendChild(row.element.parentElement));
  }
});
</script>

<script>
// Filter functionality
document.addEventListener('DOMContentLoaded', function() {
  const filterBtn = document.getElementById('filter-btn');
  const filterPanel = document.getElementById('filter-panel');
  const applyBtn = document.getElementById('apply-filter-btn');
  const clearBtn = document.getElementById('clear-filter-btn');
  const container = document.querySelector('.job-list-container');
  
  if (!filterBtn || !filterPanel) return;
  
  // Toggle filter panel - ONLY toggle, don't apply filters
  filterBtn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    // Toggle the hidden class to show/hide the overlay
    const isHidden = filterPanel.classList.contains('hidden');
    if (isHidden) {
      filterPanel.classList.remove('hidden');
      filterPanel.style.display = 'block';
    } else {
      filterPanel.classList.add('hidden');
      filterPanel.style.display = 'none';
    }
  });
  
  // Close filter panel when clicking outside
  document.addEventListener('click', function(e) {
    if (filterPanel && filterBtn && !filterPanel.contains(e.target) && !filterBtn.contains(e.target)) {
      filterPanel.classList.add('hidden');
      filterPanel.style.display = 'none';
    }
  });
  
  // Apply filters - only when Apply button is clicked
  if (applyBtn) {
    applyBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      try {
        applyFilters();
        if (filterPanel) filterPanel.classList.add('hidden');
        if (filterPanel) filterPanel.style.display = 'none';
      } catch (error) {
        console.error('Error applying filters:', error);
        if (container) {
          container.innerHTML = `<p class="text-danger p-4">Failed to load filtered jobs.</p>`;
        }
      }
    });
  }
  
  // Clear filters
  if (clearBtn) {
    clearBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      // Clear all filter inputs
      ['filter-location','filter-salary-min','filter-salary-max','filter-category','filter-date-posted']
        .forEach(id => {
          const el = document.getElementById(id);
          if (el) el.value = '';
        });
      // Reload page without filters
      window.location.href = "{{ path('app_provider_jobs_saved') }}";
    });
  }
  
  // Apply filters via AJAX
  function applyFilters() {
    const locationInput = document.getElementById('filter-location');
    const salaryMinInput = document.getElementById('filter-salary-min');
    const salaryMaxInput = document.getElementById('filter-salary-max');
    const categoryInput = document.getElementById('filter-category');
    const datePostedInput = document.getElementById('filter-date-posted');
    
    if (!container) {
      console.error('Container not found');
        return;
      }
      
    // Build filter parameters
    const params = new URLSearchParams();
    if (locationInput?.value) params.append('location', locationInput.value);
    if (salaryMinInput?.value) params.append('salaryMin', salaryMinInput.value);
    if (salaryMaxInput?.value) params.append('salaryMax', salaryMaxInput.value);
    if (categoryInput?.value) params.append('category', categoryInput.value);
    if (datePostedInput?.value) params.append('days', datePostedInput.value);
    
    // Show loading spinner
    const listContainer = document.querySelector('.job-list-container');
    if (listContainer) {
      listContainer.innerHTML = `
        <div class="text-center p-4">
          <div class="spinner-border text-success mb-3" role="status"></div>
          <p>Filtering jobs...</p>
        </div>
      `;
    }
    
    // Use Symfony route dynamically
    const savedUrl = "{{ path('app_provider_jobs_saved') }}";
    
    // Make AJAX request
    fetch(`${savedUrl}?${params.toString()}`, {
      headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
      .then(res => {
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        return res.json();
      })
      .then(data => {
        console.log('Filter response received:', data);
        if (!data || !data.html) {
          throw new Error('Invalid response format');
        }
        
        if (listContainer) {
          // The response is already just the job-list-container, so replace it directly
          listContainer.outerHTML = data.html;
          // Re-initialize todo popups after AJAX update
          if (typeof initializeTodoPopups === 'function') {
            initializeTodoPopups();
          }
        } else if (container) {
          // Find where to insert the new content
          const oldContainer = container.querySelector('.job-list-container');
          if (oldContainer) {
            oldContainer.outerHTML = data.html;
          } else {
            // Insert before actions-container or at end
            const actionsContainer = container.querySelector('.actions-container');
            if (actionsContainer) {
              actionsContainer.insertAdjacentHTML('beforebegin', data.html);
            } else {
              container.insertAdjacentHTML('beforeend', data.html);
            }
          }
        }
        if (filterPanel) {
          filterPanel.classList.add('hidden');
          filterPanel.style.display = 'none';
        }
      })
      .catch(err => {
        console.error('Filter error:', err);
        if (listContainer) {
          listContainer.innerHTML = `<p class="text-danger p-4">Failed to load filtered jobs. Error: ${err.message}</p>`;
        }
      });
  }

});
</script>

<script>
// Handle list collapse functionality
function setupListCollapse() {
    const container = document.getElementById('split-view-container');
    const toggleBtn = document.getElementById('list-toggle-btn');
    const noteBtn = document.getElementById('note-btn');
    
    if (!container || !toggleBtn || !noteBtn) return;

    // Function to update toggle button position and visibility (made globally accessible)
    window.updateToggleButtonPosition = function() {
        if (container.style.display !== 'grid') {
            toggleBtn.style.display = 'none';
            return;
        }
        
        const isCollapsed = container.classList.contains('list-collapsed');
        const splitJobList = document.getElementById('split-job-list');
        const splitJobDetails = document.getElementById('split-job-details');
        
        // Only show toggle button when list is collapsed
        if (isCollapsed) {
            toggleBtn.style.display = 'flex';
            // Position at the absolute left edge of the details container
            if (splitJobDetails) {
                const detailsRect = splitJobDetails.getBoundingClientRect();
                const buttonWidth = 36; // Width of the toggle button
                toggleBtn.style.position = 'fixed';
                // Position at the absolute left edge (button's center at the left edge, so half width to the left)
                toggleBtn.style.left = (detailsRect.left - (buttonWidth / 2)) + 'px';
                // Position at the top left, with some offset from the top edge
                toggleBtn.style.top = (detailsRect.top + 20) + 'px';
                toggleBtn.style.transform = 'none';
            }
        } else {
            // Hide toggle button when list is visible (default state)
            toggleBtn.style.display = 'none';
        }
    };
    
    // Observe container changes to update toggle button visibility
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.type === 'attributes' && (mutation.attributeName === 'style' || mutation.attributeName === 'class')) {
                updateToggleButtonPosition();
            }
        });
    });
    
    observer.observe(container, { attributes: true, attributeFilter: ['style', 'class'] });
    
    // Update position on resize and scroll (only when visible)
    window.addEventListener('resize', updateToggleButtonPosition);
    window.addEventListener('scroll', updateToggleButtonPosition, true);
    
    // Initialize: Hide toggle button by default
    updateToggleButtonPosition();

    // Helper function to collapse the list
    function collapseList() {
        if (!container.classList.contains('list-collapsed')) {
            container.classList.add('list-collapsed');
            const splitJobList = document.getElementById('split-job-list');
            const splitJobDetails = document.getElementById('split-job-details');
            if (splitJobList) {
                splitJobList.style.display = 'none';
                splitJobList.style.width = '0';
                splitJobList.style.minWidth = '0';
                splitJobList.style.maxWidth = '0';
                splitJobList.style.padding = '0';
                splitJobList.style.margin = '0';
                splitJobList.style.visibility = 'hidden';
            }
            if (splitJobDetails) {
                splitJobDetails.style.gridColumn = '1 / -1';
                splitJobDetails.style.width = '100%';
                splitJobDetails.style.maxWidth = '100%';
            }
            updateToggleButtonPosition();
        }
    }

    // Helper function to expand the list
    function expandList() {
        if (container.classList.contains('list-collapsed')) {
            container.classList.remove('list-collapsed');
            const splitJobList = document.getElementById('split-job-list');
            const splitJobDetails = document.getElementById('split-job-details');
            if (splitJobList) {
                splitJobList.style.display = 'block';
                splitJobList.style.width = '';
                splitJobList.style.minWidth = '';
                splitJobList.style.maxWidth = '';
                splitJobList.style.padding = '';
                splitJobList.style.margin = '';
                splitJobList.style.visibility = 'visible';
            }
            if (splitJobDetails) {
                splitJobDetails.style.gridColumn = '';
                splitJobDetails.style.width = '';
                splitJobDetails.style.maxWidth = '';
            }
            // Hide toggle button when list is expanded
            updateToggleButtonPosition();
        }
    }

    // Toggle list collapse - completely hide/show the left sidebar
    toggleBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const isCollapsed = container.classList.contains('list-collapsed');
        
        if (isCollapsed) {
            expandList();
        } else {
            collapseList();
        }
        
        // Update button position after toggle
        setTimeout(updateToggleButtonPosition, 100);
    });

    // Collapse list when note button is clicked
    noteBtn.addEventListener('click', () => {
        collapseList();
        if (typeof handleNoteClick === 'function') {
        handleNoteClick();
        }
    });
    
    // Collapse list when detail note button is clicked
    const detailNoteBtn = document.getElementById('detail-note-btn');
    if (detailNoteBtn) {
        detailNoteBtn.addEventListener('click', () => {
            collapseList();
        });
    }
}

// Note auto-save functionality
function setupNoteAutoSave() {
  const textarea = document.getElementById('notes-textarea');
  if (!textarea) return;

  let saveTimeout;
  textarea.addEventListener('input', () => {
    const panel = document.getElementById('notes-panel');
    const lastSavedDiv = document.querySelector('.last-saved');
    const timeSpan = document.querySelector('.last-saved-time');
    
    if (!panel || !panel.dataset.jobId) return;
    
    // Clear previous timeout if it exists
    if (saveTimeout) clearTimeout(saveTimeout);
    
    // Set new timeout for 500ms after last input
    saveTimeout = setTimeout(() => {
      localStorage.setItem('provider_job_notes_' + panel.dataset.jobId, textarea.value);
      
      // Show last saved message
      lastSavedDiv.style.display = 'block';
      const now = new Date();
      timeSpan.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      // Hide message after 3 seconds
      setTimeout(() => {
        lastSavedDiv.style.display = 'none';
      }, 3000);
    }, 500);
  });
}

document.addEventListener('DOMContentLoaded', function () {
  setupListCollapse();
  const rankDisplays = document.querySelectorAll('.rank-display');
  const rankInputs = document.querySelectorAll('.rank-input');

  function saveRank(input) {
    let value = parseFloat(input.value);
    const jobId = input.dataset.jobId;
    const wrapper = input.closest('.rank-input-wrapper');
    const display = wrapper ? wrapper.previousElementSibling : input.previousElementSibling;

    //  Validate and auto-correct range
    if (isNaN(value)) {
      showErrorAlert('Invalid Score', 'Score must be a number between 1 and 10.');
      input.value = input.dataset.originalValue || '';
      return;
    }

    if (value < 1) value = 1;
    if (value > 10) value = 10;

    //  Round to nearest 0.5 step
    value = Math.round(value * 2) / 2;

    //  Skip update if no change
    if (
      input.dataset.originalValue !== undefined &&
      input.dataset.originalValue !== '' &&
      value === parseFloat(input.dataset.originalValue)
    ) {
      if (wrapper) {
        wrapper.classList.add('hidden');
      } else {
      input.classList.add('hidden');
      }
      if (display) display.classList.remove('hidden');
      return;
    }

    //  Send to Symfony backend
    fetch('{{ path("app_update_rank") }}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      },
      body: JSON.stringify({ jobId, rank: value })
    })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          //  Update UI
          if (display) {
          display.textContent = value + '/10';
            display.classList.remove('hidden');
          }
          input.value = value;
          input.dataset.originalValue = value;
          if (wrapper) {
            wrapper.classList.add('hidden');
          } else {
          input.classList.add('hidden');
          }

          //  Show success toast
          let msg = document.getElementById('rank-success-msg');
          if (!msg) {
            msg = document.createElement('div');
            msg.id = 'rank-success-msg';
            msg.style.position = 'fixed';
            msg.style.top = '20px';
            msg.style.right = '20px';
            msg.style.backgroundColor = '#4CAF50';
            msg.style.color = 'white';
            msg.style.padding = '10px 15px';
            msg.style.borderRadius = '5px';
            msg.style.zIndex = '9999';
            document.body.appendChild(msg);
          }
          msg.textContent = 'Score updated successfully!';
          msg.style.display = 'block';
          setTimeout(() => { msg.style.display = 'none'; }, 2000);
        } else {
          showErrorAlert('Update Failed', 'Failed to update score: ' + (data.error || 'Unknown error'));
          input.value = input.dataset.originalValue || '';
        }
      })
      .catch(err => {
        console.error('Fetch error:', err);
        showErrorAlert('Server Error', 'Server error while updating score.');
        input.value = input.dataset.originalValue || '';
      });
  }

  //  Initialize original values
  rankInputs.forEach(input => {
    input.dataset.originalValue = input.value || '';
  });

  //  Click to edit
  rankDisplays.forEach(display => {
    display.addEventListener('click', function () {
      const wrapper = this.nextElementSibling;
      if (wrapper && wrapper.classList.contains('rank-input-wrapper')) {
        const input = wrapper.querySelector('.rank-input');
        wrapper.classList.remove('hidden');
      this.classList.add('hidden');
        if (input) {
      input.focus();
      input.select();
        }
      }
    });
  });

  // Tick button click handlers
  document.querySelectorAll('.rank-save-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.stopPropagation();
      const jobId = this.dataset.jobId;
      const wrapper = this.closest('.rank-input-wrapper');
      const input = wrapper ? wrapper.querySelector('.rank-input') : null;
      if (input && input.dataset.jobId === jobId) {
        saveRank(input);
      }
    });
  });

  //  Handle key events (no blur save - only tick button or Enter)
  rankInputs.forEach(input => {
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        saveRank(input);
      }
      if (e.key === 'Escape') {
        const wrapper = input.closest('.rank-input-wrapper');
        const display = wrapper ? wrapper.previousElementSibling : input.previousElementSibling;
        input.value = input.dataset.originalValue || '';
        if (wrapper) {
          wrapper.classList.add('hidden');
        } else {
        input.classList.add('hidden');
        }
        if (display) display.classList.remove('hidden');
      }
    });
  });
});
</script>

<script>
// Email templates: modal logic and population
function openEmailModal(templateId) {
  const overlay = document.getElementById('email-modal-overlay');
  const modal = document.getElementById(`email-template-${templateId}-modal`);
  if (!overlay || !modal) return;

  // Build dynamic context from selected job (best effort)
  const titleEl = document.querySelector('#job-detail-content .job-detail-title');
  const companyEl = document.querySelector('#job-detail-content .job-detail-company');
  const jobTitle = (titleEl && titleEl.textContent.trim()) || 'the role';
  const company = (companyEl && companyEl.textContent.trim()) || 'your company';

  const subjectEl = document.getElementById(`email-t${templateId}-subject`);
  const messageEl = document.getElementById(`email-t${templateId}-message`);
  if (!subjectEl || !messageEl) return;

  if (templateId === 1) {
    subjectEl.value = `Introduction and interest in ${jobTitle}`;
    messageEl.value = `Hi there,\n\nI hope youre doing well. I came across ${jobTitle} at ${company} and it looks like a strong match for my background. Id welcome the chance to connect and share how I can help.\n\nIve attached my resume for your review. Below is a short paragraph you can paste for introductions if helpful.\n\n[INSERT BRIEF PARAGRAPH IN THE 3RD PERSON HERE.]\n\nThanks in advance for your help  Id love to catch up soon.\n\nBest,\n[YOUR NAME]`;
  } else {
    subjectEl.value = `Following up on ${jobTitle}`;
    messageEl.value = `Hi there,\n\nI wanted to follow up on ${jobTitle} at ${company}. I remain very interested and would be happy to provide any additional details.\n\nThanks again for your time and consideration.\n\nBest,\n[YOUR NAME]`;
  }

  overlay.style.display = 'block';
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden', 'false');
  
  // Reset modal position to center
  modal.style.top = '50%';
  modal.style.left = '50%';
  modal.style.right = 'auto';
  modal.style.bottom = 'auto';
  modal.style.transform = 'translate(-50%, -50%)';
  
  // Ensure modal is visible in viewport - scroll into view smoothly
  setTimeout(() => {
    modal.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
    
    // After scrolling, check if modal needs position adjustment
    setTimeout(() => {
      const rect = modal.getBoundingClientRect();
      const viewportHeight = window.innerHeight;
      const viewportWidth = window.innerWidth;
      const padding = 20;
      
      // Adjust vertical position if needed
      if (rect.top < padding) {
        modal.style.top = padding + 'px';
        modal.style.transform = 'translate(-50%, 0)';
      } else if (rect.bottom > viewportHeight - padding) {
        modal.style.top = 'auto';
        modal.style.bottom = padding + 'px';
        modal.style.transform = 'translate(-50%, 0)';
      }
      
      // Adjust horizontal position if needed
      if (rect.left < padding) {
        modal.style.left = padding + 'px';
        modal.style.transform = modal.style.transform.replace('translate(-50%', 'translate(0');
      } else if (rect.right > viewportWidth - padding) {
        modal.style.right = padding + 'px';
        modal.style.left = 'auto';
        modal.style.transform = modal.style.transform.replace('translate(-50%', 'translate(0');
      }
    }, 300); // Wait for scroll animation to complete
  }, 10);
}

function closeAllEmailModals() {
  const overlay = document.getElementById('email-modal-overlay');
  const modals = document.querySelectorAll('.email-modal');
  modals.forEach(m => { m.style.display = 'none'; m.setAttribute('aria-hidden', 'true'); });
  if (overlay) overlay.style.display = 'none';
}

document.addEventListener('DOMContentLoaded', function () {
  const overlay = document.getElementById('email-modal-overlay');
  if (overlay) overlay.addEventListener('click', closeAllEmailModals);

  document.querySelectorAll('.email-modal [data-close]').forEach(btn => {
    btn.addEventListener('click', closeAllEmailModals);
  });

  // Copy handlers
  document.querySelectorAll('[data-copy-subject]').forEach(btn => {
    btn.addEventListener('click', () => {
      const sel = btn.getAttribute('data-copy-subject');
      const input = document.querySelector(sel);
      if (!input) return;
      navigator.clipboard.writeText(input.value || '').then(() => showToast && showToast('Subject copied', 'success')).catch(()=>{});
    });
  });
  document.querySelectorAll('[data-copy-message]').forEach(btn => {
    btn.addEventListener('click', () => {
      const sel = btn.getAttribute('data-copy-message');
      const input = document.querySelector(sel);
      if (!input) return;
      navigator.clipboard.writeText(input.value || '').then(() => showToast && showToast('Message copied', 'success')).catch(()=>{});
    });
  });

  // Open in Gmail
  document.querySelectorAll('[data-open-gmail]').forEach(btn => {
    btn.addEventListener('click', () => {
      const subSel = btn.getAttribute('data-sub');
      const bodySel = btn.getAttribute('data-body');
      const subEl = document.querySelector(subSel);
      const bodyEl = document.querySelector(bodySel);
      const su = encodeURIComponent(subEl ? subEl.value : '');
      const body = encodeURIComponent(bodyEl ? bodyEl.value : '');
      const url = `https://mail.google.com/mail/?view=cm&fs=1&su=${su}&body=${body}`;
      window.open(url, '_blank');
    });
  });
});
</script>
<script>
  document.getElementById('float-view-btn').addEventListener('click', function() {
      const url = window.location.href;

      // Open in a new window with size and features
      window.open(
          url,
          '_blank',
          'width=1200,height=800,top=100,left=100,resizable=yes,scrollbars=yes'
      );
  });
</script>


<!-- Notify Hire JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    const saveBtn = document.getElementById('save-btn');
    const saveBtnBottom = document.querySelector('#save-btn-bottom') || document.querySelector('.hidden-buttons #save-btn');
    const applyBtn = document.getElementById('apply-btn');
    
    if (saveBtn) {
        saveBtn.addEventListener('click', handleNotifyHireFromSaved);
    }
    
    if (saveBtnBottom) {
        saveBtnBottom.addEventListener('click', handleNotifyHireFromSaved);
    }
    
    // Enable/disable buttons based on selection
    function updateActionButtons() {
        const selectedCheckboxes = Array.from(document.querySelectorAll('.job-checkbox:checked'));
        const hasSelection = selectedCheckboxes.length > 0;
        const actionsContainer = document.querySelector('.actions-container');
        
        // Show/hide notify of hire button
        if (saveBtn) {
            if (hasSelection) {
                saveBtn.style.display = 'flex';
                saveBtn.disabled = false;
            } else {
                saveBtn.style.display = 'none';
                saveBtn.disabled = true;
            }
        }
        
        // Adjust grid layout dynamically based on button visibility
        if (actionsContainer) {
            if (hasSelection && saveBtn && saveBtn.style.display !== 'none') {
                // When notify of hire is visible, adjust grid to prevent line breaking
                actionsContainer.style.gridTemplateColumns = 'auto auto 1fr';
                actionsContainer.style.gap = '8px';
            } else {
                // Default layout when notify of hire is hidden
                actionsContainer.style.gridTemplateColumns = '1fr auto 1fr';
                actionsContainer.style.gap = '16px';
            }
        }
        
        if (applyBtn) {
            applyBtn.disabled = !hasSelection;
        }
        if (saveBtnBottom) {
            saveBtnBottom.disabled = !hasSelection;
        }
        
        // Update tooltips
        if (hasSelection) {
            if (saveBtn) saveBtn.title = "Notify Hire for Selected Jobs";
            if (saveBtnBottom) saveBtnBottom.title = "Notify Hire for Selected Jobs";
            if (applyBtn) applyBtn.title = "Apply to selected jobs";
        } else {
            if (saveBtn) saveBtn.title = "Notify of Hire";
            if (saveBtnBottom) saveBtnBottom.title = "Notify of Hire";
            if (applyBtn) applyBtn.title = "Apply";
        }
    }
    
    // Update buttons when checkboxes change
    document.querySelectorAll('.job-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', updateActionButtons);
    });
    
    // Initial update
    updateActionButtons();
});

function handleNotifyHireFromSaved() {
    const selectedCheckboxes = Array.from(document.querySelectorAll('.job-checkbox:checked'));
    
    if (selectedCheckboxes.length === 0) {
        showToast('Please select at least one job to notify hire.', 'warning');
        return;
    }
    
    const selectedJobIds = selectedCheckboxes.map(cb => cb.dataset.jobId);
    
    // Show confirmation modal
    showNotifyHireModal(selectedJobIds);
}

function showNotifyHireModal(jobIds) {
    const modalHtml = `
        <div class="modal fade" id="notifyHireModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Notify Hire for Selected Jobs</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>This action will:</p>
                        <ul>
                            <li>Mark providers as hired for jobs you've applied to</li>
                            <li>Move successfully processed jobs to "Accepted" status</li>
                            <li>Remove them from your saved jobs</li>
                            <li>Notify the admin about the hire</li>
                        </ul>
                        <div class="alert alert-warning">
                            <strong>Note:</strong> Only jobs you have already applied to can be processed. 
                            Jobs without applications will be skipped.
                        </div>
                        <p>Are you sure you want to proceed?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-success" id="confirm-notify-hire-btn">
                            Yes, Notify Hire
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if any
    const existingModal = document.getElementById('notifyHireModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add modal to DOM
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    const modal = new bootstrap.Modal(document.getElementById('notifyHireModal'));
    modal.show();
    
    // Handle confirm button
    document.getElementById('confirm-notify-hire-btn').addEventListener('click', function() {
        modal.hide();
        processNotifyHire(jobIds);
    });
}

function processNotifyHire(jobIds) {
    // Show loading state
    const saveBtn = document.getElementById('save-btn');
    const saveBtnBottom = document.querySelector('#save-btn-bottom') || document.querySelector('.hidden-buttons #save-btn');
    const originalHtml = saveBtn ? saveBtn.innerHTML : '';
    
    if (saveBtn) {
    saveBtn.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Processing...';
    saveBtn.disabled = true;
    }
    if (saveBtnBottom) {
        saveBtnBottom.innerHTML = '<div class="spinner-border spinner-border-sm"></div>';
        saveBtnBottom.disabled = true;
    }
    
    fetch('{{ path("app_provider_saved_jobs_notify_hire") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify({ jobIds: jobIds })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showResultsModal(data.results);
            // Remove successful jobs from the UI
            removeSuccessfulJobsFromUI(data.results.successful);
            // Uncheck all checkboxes
            uncheckAllCheckboxes();
        } else {
            showToast('Error: ' + (data.message || 'Unknown error'), 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Network error. Please try again.', 'error');
    })
    .finally(() => {
        // Reset button
        if (saveBtn) {
        saveBtn.innerHTML = originalHtml;
        saveBtn.disabled = false;
        }
        if (saveBtnBottom) {
            saveBtnBottom.innerHTML = '<svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 10.5V12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2H13.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/><circle cx="19" cy="5" r="3" stroke="#1C274C" stroke-width="1.5"/><path d="M7 14H16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/><path d="M7 17.5H13" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/></svg>';
            saveBtnBottom.disabled = false;
        }
    });
}

function showResultsModal(results) {
    const successfulCount = results.successful ? results.successful.length : 0;
    const notAppliedCount = results.notApplied ? results.notApplied.length : 0;
    const failedCount = results.failed ? results.failed.length : 0;
    
    let resultsHtml = `
        <div class="modal fade" id="resultsModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Hire Notification Results</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
    `;
    
    // Successful results
    if (successfulCount > 0) {
        resultsHtml += `
            <div class="alert alert-success">
                <h6> Successfully Hired (${successfulCount})</h6>
                <small>The following jobs have been moved to "Accepted" and removed from saved:</small>
                <ul class="mb-0 mt-2">
        `;
        results.successful.forEach(job => {
            resultsHtml += `<li>${job.jobTitle || job.title || 'Job #' + job.jobId}</li>`;
        });
        resultsHtml += `</ul></div>`;
    }
    
    // Not applied jobs
    if (notAppliedCount > 0) {
        resultsHtml += `
            <div class="alert alert-warning">
                <h6> Not Applied (${notAppliedCount})</h6>
                <small>These jobs need to be applied to first:</small>
                <ul class="mb-0 mt-2">
        `;
        results.notApplied.forEach(job => {
            resultsHtml += `<li>${job.jobTitle || job.title || 'Job #' + job.jobId}</li>`;
        });
        resultsHtml += `</ul></div>`;
    }
    
    // Failed jobs
    if (failedCount > 0) {
        resultsHtml += `
            <div class="alert alert-danger">
                <h6> Failed (${failedCount})</h6>
                <small>These jobs could not be processed:</small>
                <ul class="mb-0 mt-2">
        `;
        results.failed.forEach(job => {
            resultsHtml += `<li>${job.jobTitle || job.title || 'Job #' + job.jobId} - ${job.reason || 'Unknown error'}</li>`;
        });
        resultsHtml += `</ul></div>`;
    }
    
    resultsHtml += `
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Continue</button>
                        ${notAppliedCount > 0 ? 
                            '<button type="button" class="btn btn-success" id="apply-remaining-btn">Apply to Remaining Jobs</button>' : 
                            ''
                        }
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if any
    const existingModal = document.getElementById('resultsModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Add modal to DOM
    document.body.insertAdjacentHTML('beforeend', resultsHtml);
    
    const modal = new bootstrap.Modal(document.getElementById('resultsModal'));
    modal.show();
    
    // Handle apply remaining button
    if (notAppliedCount > 0) {
        document.getElementById('apply-remaining-btn').addEventListener('click', function() {
            modal.hide();
            // Apply to the not applied jobs
            const notAppliedJobIds = results.notApplied.map(job => job.jobId);
            applyToSelectedJobs(notAppliedJobIds);
        });
    }
}

function removeSuccessfulJobsFromUI(successfulJobs) {
    successfulJobs.forEach(job => {
        // Remove from list view
        const jobRow = document.querySelector(`.job-checkbox[data-job-id="${job.jobId}"]`)?.closest('.job-lists');
        if (jobRow) {
            jobRow.remove();
        }
        
        // Remove from split view
        const splitJobCard = document.querySelector(`.split-job-card[data-job-id="${job.jobId}"]`);
        if (splitJobCard) {
            splitJobCard.remove();
        }
    });
    
    // Update counters
    updateJobCounters();
}

function uncheckAllCheckboxes() {
    document.querySelectorAll('.job-checkbox').forEach(checkbox => {
        checkbox.checked = false;
    });
}

function updateJobCounters() {
    // Update the saved jobs count in the status cards
    const remainingBookmarks = document.querySelectorAll('.job-checkbox').length;
    const savedCountElement = document.querySelector('.is-card.is-saved .card-text');
    if (savedCountElement) {
        savedCountElement.textContent = remainingBookmarks;
    }
}

function applyToSelectedJobs(jobIds) {
    if (!jobIds || jobIds.length === 0) {
        showToast('No jobs to apply to.', 'warning');
        return;
    }
    
    // Show loading state
    const applyBtn = document.getElementById('apply-btn');
    const applyBtnBottom = document.getElementById('apply-btn-bottom');
    const originalHtml = applyBtn ? applyBtn.innerHTML : '';
    
    if (applyBtn) {
    applyBtn.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Applying...';
    applyBtn.disabled = true;
    }
    if (applyBtnBottom) {
        applyBtnBottom.innerHTML = '<div class="spinner-border spinner-border-sm"></div>';
        applyBtnBottom.disabled = true;
    }
    
    // Apply to each job
    const applyPromises = jobIds.map(jobId => {
        return applyToJob(jobId);
    });
    
    // Execute all apply operations
    Promise.allSettled(applyPromises).then(results => {
        const successful = results.filter(r => r.status === 'fulfilled').length;
        const failed = results.filter(r => r.status === 'rejected').length;
        
        // Reset button
        if (applyBtn) {
        applyBtn.innerHTML = originalHtml;
        applyBtn.disabled = false;
        }
        if (applyBtnBottom) {
            applyBtnBottom.innerHTML = '<svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g data-name="Layer 2"><g data-name="checkmark-circle"><rect width="24" height="24" opacity="0"/><path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/><path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/></g></g></svg>';
            applyBtnBottom.disabled = false;
        }
        
        // Show results
        if (failed === 0) {
            showToast(`Successfully applied to ${successful} job(s)!`, 'success');
        } else {
            showToast(`Applied to ${successful} job(s), ${failed} failed.`, 'warning');
        }
        
        // Refresh the page to update the UI
        setTimeout(() => {
            window.location.reload();
        }, 2000);
    });
}

function applyToJob(jobId) {
    return new Promise((resolve, reject) => {
        fetch(`/provider/jobs/apply/${jobId}?redirect_route=app_provider_jobs_saved`, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => {
            if (response.ok) {
                resolve();
            } else {
                reject(new Error('Apply failed'));
            }
        })
        .catch(error => reject(error));
    });
}

// Toast notification function (if not already defined)
if (typeof showToast === 'undefined') {
function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toast-container') || createToastContainer();
    
    const toastId = 'toast-' + Date.now();
    const bgClass = type === 'success' ? 'text-bg-success' : 
                   type === 'error' ? 'text-bg-danger' : 
                   type === 'warning' ? 'text-bg-warning' : 'text-bg-info';
    
    const toastHtml = `
        <div id="${toastId}" class="toast align-items-center ${bgClass} border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML('beforeend', toastHtml);
    
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement);
    toast.show();
    
    // Remove toast from DOM after it hides
    toastElement.addEventListener('hidden.bs.toast', () => {
        toastElement.remove();
    });
}

function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toast-container';
    container.className = 'toast-container position-fixed top-0 end-0 p-3';
    container.style.zIndex = '9999';
    document.body.appendChild(container);
    return container;
}
}

// Error and Warning Alert functions
if (typeof showErrorAlert === 'undefined') {
function showErrorAlert(title, message) {
    const alertHtml = `
        <div class="alert alert-danger alert-dismissible fade show" role="alert" style="position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 500px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
            <strong>${title}</strong><br>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', alertHtml);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        const alert = document.querySelector('.alert-danger:last-of-type');
        if (alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        }
    }, 5000);
}
}

if (typeof showWarningAlert === 'undefined') {
function showWarningAlert(title, message) {
    const alertHtml = `
        <div class="alert alert-warning alert-dismissible fade show" role="alert" style="position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px; max-width: 500px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
            <strong>${title}</strong><br>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', alertHtml);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        const alert = document.querySelector('.alert-warning:last-of-type');
        if (alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        }
    }, 5000);
}
}

// Quick Tour Functionality
function startSavedJobsTour() {
    // Wait a bit to ensure all elements are rendered
    setTimeout(() => {
        introJs().setOptions({
            steps: [
                {
                    intro: "<h3>Welcome to Saved Jobs!</h3><p>Let's take a quick tour to help you navigate this page effectively.</p>"
                },
                {
                    element: document.querySelector('.application'),
                    intro: "<h4>Application Status Cards</h4><p>These cards show the count of jobs in different stages: All, Saved, Applied, Interview, Negotiating, Accepted, and Completed. Click any card to filter jobs by that status.</p>",
                    position: 'bottom'
                },
                {
                    element: document.querySelector('#filter-btn'),
                    intro: "<h4>Filter Button</h4><p>Click here to open the filter panel. You can filter jobs by location, salary range, category, and date posted to find exactly what you're looking for.</p>",
                    position: 'bottom'
                },
                {
                    element: document.querySelector('#email-btn') || document.querySelector('.job-actions-left'),
                    intro: "<h4>Action Buttons</h4><p>These buttons allow you to perform actions on selected jobs: <strong>Notify of hire</strong> to mark jobs as hired, <strong>Email</strong> to send job details via email, and <strong>Apply</strong> to submit applications to selected jobs.</p>",
                    position: 'bottom'
                },
                {
                    element: document.querySelector('#archive-btn'),
                    intro: "<h4>Archive & Delete</h4><p>Use <strong>Archive</strong> to move jobs to your archived list, or <strong>Delete</strong> to permanently remove jobs from your saved list.</p>",
                    position: 'bottom'
                },
                {
                    element: document.querySelector('#grid-view-btn'),
                    intro: "<h4>View Options</h4><p><strong>Split View</strong> opens a side-by-side view, <strong>New Window</strong> opens the job in a popup window, and <strong>Note</strong> lets you add personal notes to jobs.</p>",
                    position: 'bottom'
                },
                {
                    element: document.querySelector('.menu-dropdown'),
                    intro: "<h4>Menu Dropdown</h4><p>Access additional options like Quick Tour, Archived Jobs, Export Report, and Download Data from this menu.</p>",
                    position: 'left'
                },
                {
                    element: document.querySelector('.job-header'),
                    intro: "<h4>Job Listings Table</h4><p>This table displays all your saved jobs with columns for Job title, Location, Posted date, Expiry date, Salary, Category, and Score. Click column headers to sort.</p>",
                    position: 'bottom'
                },
                {
                    element: document.querySelector('.job-checkbox'),
                    intro: "<h4>Job Selection</h4><p>Use the checkboxes to select individual jobs for bulk actions. You can select multiple jobs and apply filters or actions to all of them at once.</p>",
                    position: 'right'
                },
                {
                    intro: "<h3>You're All Set!</h3><p>You now know how to navigate the Saved Jobs page. Start exploring and managing your job applications efficiently!</p>"
                }
            ],
            showProgress: false,
            showBullets: false,
            exitOnOverlayClick: true,
            exitOnEsc: true,
            nextLabel: 'Next',
            prevLabel: '',
            skipLabel: 'End Tour',
            doneLabel: 'Got it!'
        }).start();
    }, 300);
}

// Initialize todo popup functionality - runs immediately and on DOM ready
(function() {
    // Create popup element if it doesn't exist
    function createTodoPopup() {
        if (!window.todoPopup) {
            window.todoPopup = document.getElementById('todo-popup');
        }
        if (!window.todoPopup) {
            window.todoPopup = document.createElement('div');
            window.todoPopup.id = 'todo-popup';
            window.todoPopup.className = 'todo-popup';
            window.todoPopup.innerHTML = `
                <div class="todo-popup-header">
                    <div class="todo-popup-title">To Do Action</div>
                    <button class="todo-popup-close" type="button">&times;</button>
                </div>
                <div class="todo-popup-content"></div>
            `;
            if (document.body) {
                document.body.appendChild(window.todoPopup);
            } else {
                document.addEventListener('DOMContentLoaded', function() {
                    document.body.appendChild(window.todoPopup);
                });
            }
            
            // Close button handler
            const closeBtn = window.todoPopup.querySelector('.todo-popup-close');
            if (closeBtn) {
                closeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    window.todoPopup.classList.remove('show');
                });
            }
        }
    }
    
    // Initialize popup click handler using event delegation
    function initTodoPopupHandler() {
        if (window.todoPopupHandlerInitialized) {
            return;
        }
        
        // Use event delegation on document to catch all clicks
        document.addEventListener('click', function(e) {
            // Check if click is on todo icon or its children
            const todoIcon = e.target.closest('.todo-icon');
            if (todoIcon) {
                e.stopPropagation();
                e.preventDefault();
                
                // Ensure popup exists
                if (!window.todoPopup) {
                    createTodoPopup();
                }
                
                const action = todoIcon.dataset.todoAction;
                if (action && window.todoPopup) {
                    const content = window.todoPopup.querySelector('.todo-popup-content');
                    if (content) {
                        content.textContent = action;
                        
                        // Position popup near the icon
                        const rect = todoIcon.getBoundingClientRect();
                        const popupWidth = 250;
                        const popupHeight = 100;
                        let left = rect.left + (rect.width / 2) - (popupWidth / 2);
                        let top = rect.top - popupHeight - 10;
                        
                        // Adjust if popup goes off screen
                        if (left < 10) left = 10;
                        if (left + popupWidth > window.innerWidth - 10) {
                            left = window.innerWidth - popupWidth - 10;
                        }
                        if (top < 10) {
                            top = rect.bottom + 10;
                        }
                        
                        window.todoPopup.style.left = left + 'px';
                        window.todoPopup.style.top = top + 'px';
                        window.todoPopup.classList.add('show');
                    }
                }
                return;
            }
            
            // Close popup if clicking outside
            if (window.todoPopup && window.todoPopup.classList.contains('show') && 
                !window.todoPopup.contains(e.target) && 
                !e.target.closest('.todo-icon')) {
                window.todoPopup.classList.remove('show');
            }
        });
        
        window.todoPopupHandlerInitialized = true;
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            createTodoPopup();
            initTodoPopupHandler();
        });
    } else {
        createTodoPopup();
        initTodoPopupHandler();
    }
})();

// Initialize tour when Quick Tour button is clicked
document.addEventListener('DOMContentLoaded', function() {
    const quickTourBtn = document.getElementById('start-page-tour');
    if (quickTourBtn) {
        quickTourBtn.addEventListener('click', function(e) {
            e.preventDefault();
            startSavedJobsTour();
        });
    }
    
    // Also add click handler to Quick Tour in menu dropdown
    const menuItems = document.querySelectorAll('.menu-item');
    menuItems.forEach(item => {
        if (item.textContent.trim().includes('Quick Tour')) {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                startSavedJobsTour();
                // Close the dropdown if it's open
                const dropdown = item.closest('.menu-dropdown');
                if (dropdown) {
                    const dropdownPanel = dropdown.querySelector('.dropdown-panel');
                    if (dropdownPanel) {
                        dropdownPanel.classList.add('hidden');
                    }
                }
            });
        }
    });
});
</script>

{# Tour styles are now in base.html.twig - using dark grey modal style #}

{% endblock %}
