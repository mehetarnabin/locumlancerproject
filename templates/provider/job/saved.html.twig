{% extends 'provider/base.html.twig' %}

{% block title %}Saved Jobs{% endblock %}

{% block provider_body %}
<style>
/* ALL YOUR EXISTING CSS STYLES REMAIN EXACTLY THE SAME */
.job-header, .job-row {
    display: flex;
    align-items: center;
    min-width: 0;
    overflow: hidden;
}

.col-job,
.col-location,
.col-schedule,
.col-expiry,
.col-start,
.col-action {
    flex: 1;
    min-width: 130px;
}
.col-job {
    flex: 2;
}
.job-header {
    padding-left: 10px;
    padding-right: 10px;
    color: #121C0C;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    border: 1px solid #e6eef6;
    height: 40px;
    margin-bottom: 2px;
    font-size: 13px;
}
.job-row {
    border: none;
    padding: 10px 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 2px 0;
    font-size: 13px;
    border-radius: 10px;
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
}
.truncate-text {
    display: inline-block;
    max-width: 180px; /* Adjust as needed */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
}
.job-section {
    background-color: #fff;
}
.job-check {
    margin-right: 8px;
    transform: scale(1.2);
}
#toggleActions {
    padding: 6px 16px;
    border-radius: 18px;
    border: 1px solid #ddd;
    font-size: 16px;
    color: #fff;
}
.job-meta {
    margin-top: 1px;
}
.ml-15-px {
    margin-left: 15px;
}
.mr-15-px {
    margin-right: 15px;
}
.action-btn {
    background: transparent;
    border: none;
    padding: 0 4px;
}

.custom-dropdown {
  position: absolute;
  top: 110%;
  left: 0;
  background: #fff;
  padding: 10px;
  min-width: 150px;
  z-index: 1000;
  border: 1px solid #e6eef6;
  box-shadow: 0 2px 6px rgba(11,22,40,0.03);
  border-radius: 10px;
}

.hidden {
  display: none;
}

.columns-panel label {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
  cursor: pointer;
  font-weight: 400;
  color: #121C0C;
}

.menu-panel .menu-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 0;
  cursor: pointer;
  color: #121C0C;
}

.menu-panel svg {
  width: 16px;
  height: 16px;
}

.dropdown-cstm {
    background: #F4F9F1;
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    padding: 4px 12px;
}

.menu-panel {
    min-width: 160px;
}

.columns-panel input[type="checkbox"] {
  appearance: none;
  width: 16px;
  height: 16px;
  border: 1px solid #cfd9e3;
  border-radius: 4px;
  background-color: #fff;
  cursor: pointer;
  position: relative;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.columns-panel input[type="checkbox"]:hover {
  border-color: #85BB65;
}

.columns-panel input[type="checkbox"]:checked {
  background-color: #85BB65;
  border-color: #85BB65;
}

.columns-panel input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 5px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.col-check input[type="checkbox"] {
  appearance: none;
  width: 16px;
  height: 16px;
  border: 1px solid #cfd9e3;
  border-radius: 4px;
  background-color: #fff;
  cursor: pointer;
  position: relative;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

.col-check input[type="checkbox"]:hover {
  border-color: #85BB65;
}

.col-check input[type="checkbox"]:checked {
  background-color: #85BB65;
  border-color: #85BB65;
}

.col-check input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 5px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

/* Consistent rounded rectangle style for all job list checkboxes */
.job-list-container input[type="checkbox"].job-check,
.split-job-list input[type="checkbox"].job-checkbox,
#select-all-checkbox {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  border: 1px solid #cfd9e3;
  border-radius: 4px;
  background: #fff;
  cursor: pointer;
  position: relative;
  display: inline-block;
  vertical-align: middle;
  margin: 0;
  transition: background-color 0.3s ease, border-color 0.3s ease;
}

/* Hover state - green border */
.job-list-container input[type="checkbox"].job-check:hover,
.split-job-list input[type="checkbox"].job-checkbox:hover,
#select-all-checkbox:hover {
  border-color: #85BB65;
}

/* Checked state - green filled with white checkmark */
.job-list-container input[type="checkbox"].job-check:checked,
.split-job-list input[type="checkbox"].job-checkbox:checked,
#select-all-checkbox:checked {
  background-color: #85BB65;
  border-color: #85BB65;
}

.job-list-container input[type="checkbox"].job-check:checked::after,
.split-job-list input[type="checkbox"].job-checkbox:checked::after,
#select-all-checkbox:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 6px;
  width: 4px;
  height: 8px;
  border: solid #fff;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

/* Remove previous scale that distorted shape */
.job-check { transform: none; margin-right: 8px; }

.job-title {
    color: #121C0C;
    font-size: 18px;
}

.action-btn {
    border: 1px solid #e6eef6;
    box-shadow: 0 2px 6px rgba(11,22,40,0.03);
    border-radius: 10px;
    padding: 4px 12px;
    display: flex;
    gap: 6px;
    align-items: center;
}
.action-btn, .dropdown-cstm {
    transition: all 0.2s ease;
}
.action-btn:hover, .dropdown-cstm:hover {
    color: #85BB65;
    border: 1px solid #85BB65;
    transition: all 0.2s ease;
}
.action-btn:hover svg {
    color: #85BB65;
}
#delete-btn:hover, #delete-btn-bottom:hover {
    color: #BA1824;
    border: 1px solid #BA1824;
    transition: all 0.2s ease; 
}
#delete-btn:hover svg, #delete-btn-bottom:hover svg {
    color: #BA1824;
}
.col-center {
    text-align: center;
}
.col-rank {
    min-width: 55px;
    max-width: 55px;
}
.application {
    padding-left: 16px;
}
.application .card {
  clip-path: polygon(0% 0%,calc(100% - 15px) 0%,100% 50%,calc(100% - 15px) 100%,0% 100%,15px 50%,0% 0%);
  display: flex;
  justify-content: center;
  align-items: center;
  margin-left: -15px;
  margin-bottom: 0 !important;
  cursor: pointer;
  height: 100%;
  width: 100%;
  flex: 1;
}

/* First card: no left cutout */
.application .col:first-child {
    max-width: 80px;
    display: flex;
}

.application .col:first-child > a {
    display: flex;
    width: 100%;
    flex: 1;
}

.application .col:first-child .card {
    clip-path:none;
    margin-left: 0;
    margin-bottom: 0 !important;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    flex: 1;
}
.application .row .col {
    display: flex;
}

.application .row .col > a {
    display: flex;
    width: 100%;
    flex: 1;
}

.application .col .card-body {
    justify-content: center;
    flex-direction: column-reverse;
    text-align: center;
    align-items: center;
    display: flex;
    height: 100%;
    min-height: 100%;
    padding: 0.5rem 1rem;
}
.application .col .card-body .card-title {
    font-size: 16px;
}
.is-card.is-applied:hover *, .is-card.is-review:hover *, .is-card.is-interview:hover *, .is-card.is-rejected:hover *, .is-card.is-hired:hover *, .is-card.is-offered:hover *, .is-card.is-completed:hover *, .is-card.is-applied.active *, .is-card.is-review.active *, .is-card.is-interview.active *, .is-card.is-rejected.active *, .is-card.is-hired.active *, .is-card.is-offered.active *, .is-card.is-completed.active *, .is-card .card-body p, .is-card .card-body:hover, .application .col .card-body .card-title:hover, .is-card:hover {
    color: rgb(33, 37, 41);
}
.application .col .card-body p {
    font-size: 16px;
    color: #121C0C;
}
.application .col:first-child .card .card-body {
    align-items: center;
}
.application .col:nth-child(2) .card {
  clip-path: polygon(0% 0%,calc(100% - 15px) 0%,100% 50%,calc(100% - 15px) 100%,0% 100%,0% 0%);
  margin-left: 0;
}
.application .col:last-child .card {
    clip-path: polygon(0% 0%,100% 0%,100% 100%,0% 100%,15px 50%,0% 0%);
}
.application .col:first-child .card-body p {
    display: none;
}
.application .col:first-child .card-body .card-title {
    font-size: 16px;
}
.col:nth-child(1) .is-card {
  background-color: #D2E6C6;
}
.col:nth-child(2) .is-card {
  background-color: #C7E0B8;
}
.col:nth-child(3) .is-card {
  background-color: #BBDAAA;
}
.col:nth-child(4) .is-card {
  background-color: #AFD39C;
}
.col:nth-child(5) .is-card {
  background-color: #A4CC8E;
}
.col:nth-child(6) .is-card {
  background-color: #99C680;
}
.col:nth-child(7) .is-card {
  background-color: #8DC072;
}
.col:nth-child(8) .is-card {
  background-color: #82B964;
}

.col:nth-child(1) .is-card:hover {
  background-color: #B9F2FF;
}
.col:nth-child(2) .is-card:hover {
  background-color: #ADF0FF;
}
.col:nth-child(3) .is-card:hover {
  background-color: #99ECFF;
}
.col:nth-child(4) .is-card:hover {
  background-color: #85E9FF;
}
.col:nth-child(5) .is-card:hover {
  background-color: #70E5FF;
}
.col:nth-child(6) .is-card:hover {
  background-color: #5CE1FF;
}
.col:nth-child(7) .is-card:hover {
  background-color: #47DDFF;
}
.col:nth-child(8) .is-card:hover {
  background-color: #33DAFF;
}
.col .is-card.is-saved.active {
    background-color: #ADF0FF;
}
.sort-toggle {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  line-height: 1;
  gap: 2px;
  margin-left: 6px;
  vertical-align: middle;
  position: relative;
  top: 1px; /* nudges to visually center with text */
}
.sort-toggle svg { width: 10px; height: 10px; }
.sort-toggle .arrow { opacity: 0.35; transition: opacity 0.15s ease; }
.sort-toggle .arrow.active { opacity: 1; }

.actions-container {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: 16px;
  margin-top: 20px;
  margin-bottom: 12px;
}

/* Enhanced table alignment and typography */
.job-header {
  font-size: 13px;
  font-weight: 600;
  color: #121C0C;
  letter-spacing: 0.01em;
  line-height: 1.5;
  background: #F8FAF9;
  border-bottom: 2px solid #e6eef6;
}

.job-row {
  font-size: 13px;
  font-weight: 400;
  color: #1a1a1a;
  line-height: 1.5;
  transition: background-color 0.2s ease;
}

.job-row:hover {
  background-color: #F8FAF9;
}

/* Perfect alignment between headers and rows */
.job-header > div,
.job-row > div {
  display: flex;
  align-items: center;
  box-sizing: border-box;
  padding: 12px 8px;
  min-width: 0;
  overflow: hidden;
  height: 48px;
}

/* Ensure consistent vertical alignment */
.job-header {
  min-height: 48px;
  height: 48px;
}

/* Center content for numeric/text columns */
.job-header .col-start.col-center,
.job-row .col-start.col-center {
  justify-content: center;
  text-align: center;
}

/* Job column specific styling */
.col-job {
  font-weight: 500;
}

/* Improve text truncation */
.job-title {
  font-size: 13px;
  font-weight: 500;
  color: #121C0C;
  line-height: 1.4;
}

/* Consistent cell content styling */
.job-row > div {
  font-size: 13px;
  color: #1a1a1a;
}

/* Status and badge styling */
.job-row .badge {
  font-size: 11px;
  font-weight: 500;
  padding: 4px 8px;
  border-radius: 6px;
}

.job-actions-left {
  justify-self: start;
}

.job-actions-middle {
  justify-self: center;
}

.col-dropdowns {
  justify-self: end;
}

.table-responsive-wrapper {
  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
}

.table-responsive-wrapper::-webkit-scrollbar {
  height: 8px;
}

.table-responsive-wrapper::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.table-responsive-wrapper::-webkit-scrollbar-thumb {
  background: #85BB65;
  border-radius: 10px;
}

.table-responsive-wrapper::-webkit-scrollbar-thumb:hover {
  background: #6fa852;
}

/* Toast notifications */
.toast-container {
    z-index: 9999;
}

.toast {
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
}

/* Button states */
.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.action-btn:disabled:hover {
    color: inherit;
    border-color: #e6eef6;
}

/* Modal enhancements */
.modal-content {
    border-radius: 12px;
    border: none;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.modal-header {
    background: #F4F9F1;
    border-bottom: 1px solid #e6eef6;
    border-radius: 12px 12px 0 0;
}

.modal-footer {
    border-top: 1px solid #e6eef6;
    border-radius: 0 0 12px 12px;
}

/* Split View Apply Button Styles */
.split-job-details-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #e6eef6;
}

#split-apply-btn {
    background: #85BB65;
    color: white;
    border: 1px solid #85BB65;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.2s ease;
    display: none;
}

#split-apply-btn:hover {
    background: #6fa852;
    border-color: #6fa852;
    transform: translateY(-1px);
}

#split-apply-btn:disabled {
    background: #a8d18d;
    border-color: #a8d18d;
    cursor: not-allowed;
    transform: none;
}

.job-detail-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
    padding-top: 16px;
    border-top: 1px solid #e6eef6;
}

.btn-apply {
    background: #85BB65;
    border-color: #85BB65;
    color: white;
    padding: 10px 20px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-apply:hover {
    background: #6fa852;
    border-color: #6fa852;
    color: white;
}
</style>

<!-- Hidden form for delete action -->
<form id="delete-bookmarks-form" method="POST" action="{{ path('app_provider_bookmarks_delete') }}" style="display: none;">
    <input type="hidden" name="_token" value="{{ csrf_token('delete_bookmarks') }}">
    <input type="hidden" name="bookmark_ids" id="bookmark-ids-input">
</form>

<!-- Apply Jobs Form -->
<form id="apply-jobs-form" method="POST" action="{{ path('app_provider_saved_jobs_apply') }}" style="display: none;">
    <input type="hidden" name="_token" value="{{ csrf_token('apply_jobs') }}">
    <input type="hidden" name="job_ids" id="job-ids-input">
    <input type="hidden" name="_redirect" value="{{ path('app_provider_jobs_saved') }}">
</form>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the selected saved jobs? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Apply Confirmation Modal -->
<div class="modal fade" id="applyConfirmModal" tabindex="-1" aria-labelledby="applyConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="applyConfirmModalLabel">Apply to Jobs</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to apply to the selected jobs? This will:
                <ul>
                    <li>Submit applications for the selected jobs</li>
                    <li>Remove them from your saved jobs</li>
                    <li>Move them to your applications</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="confirm-apply-btn">Apply to Jobs</button>
            </div>
        </div>
    </div>
</div>

    {% set statusColors = {
        'saved': 'saved',
        'applied': 'applied',
        'interview': 'interview',
        'negotiating': 'offered',
        'accepted' : 'hired',
        'completed': 'completed',
    } %}

    {% set allStatuses = ['saved', 'applied', 'interview', 'negotiating', 'accepted', 'completed'] %}

<div class="container-xl">
    <div class="job-section shadow-lg p-3 rounded-3">

        <div class="application">
            <div class="row g-2">
                <div class="col">
                    <a href="{{ path('app_provider_jobs_applications') }}">
                        <div class="card is-card mb-3 is-applied {% if app.request.get('status') and app.request.get('status') == '' %}active{% endif %}">
                            <div class="card-body">
                                <h6 class="card-title">All</h6>
                                <p class="card-text">{{ totalApplications|number_format }}</p>
                            </div>
                </div>
            </a>
                </div>

            {% for status in allStatuses %}
                {% set count = 0 %}
                {% for item in statusCounts %}
                    {% if item.status == status %}
                        {% set count = item.count %}
                    {% endif %}
                {% endfor %}
                    <div class="col">
                        <a href="{% if status == 'saved' %}{{ path('app_provider_jobs_saved') }}{% else %}{{ path('app_provider_jobs_applications', {'status': status}) }}{% endif %}">
                        <div class="card is-card mb-3 is-{{ statusColors[status] }} {% if app.request.get('status') == status or (status == 'saved' and app.request.get('_route') == 'app_provider_jobs_saved') %}active{% endif %}">
                            <div class="card-body">
                                <h6 class="card-title">{{ status | replace({'_': ' '}) | title }}</h6>
                                <p class="card-text">{{ count }}</p>
                            </div>
                    </div>
                </a>
                    </div>
            {% endfor %}
            </div>
        </div>

        <div class="actions-container ml-15-px mr-15-px">
            <!-- Left Group: Filter, Notify of hire, Email, Apply -->
            <div class="job-actions-left" style="display: flex; gap: 8px; align-items: center;">
              <div class="position-relative" style="flex-shrink: 0;">
                <button id="filter-btn" class="action-btn" title="Filter">
                  <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 7H21M7 12H17M10 17H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Filter
                </button>
                <div id="filter-panel" class="filter-panel custom-dropdown hidden" style="position: absolute; top: 100%; left: 0; margin-top: 8px; min-width: 280px; z-index: 1000;">
                  <div style="padding: 16px;">
                    <h6 style="margin-bottom: 12px; font-weight: 600; color: #121C0C;">Filter Jobs</h6>
                    
                    <!-- Location Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Location</label>
                      <input type="text" id="filter-location" class="form-control" placeholder="Enter location" style="font-size: 13px; padding: 6px 10px;">
                    </div>
                    
                    <!-- Salary Range Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Salary Range</label>
                      <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" id="filter-salary-min" class="form-control" placeholder="Min" style="font-size: 13px; padding: 6px 10px; flex: 1;">
                        <span style="color: #6b7280;">-</span>
                        <input type="number" id="filter-salary-max" class="form-control" placeholder="Max" style="font-size: 13px; padding: 6px 10px; flex: 1;">
                      </div>
                    </div>
                    
                    <!-- Category Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Category</label>
                      <select id="filter-category" class="form-control" style="font-size: 13px; padding: 6px 10px;">
                        <option value="">All Categories</option>
                        <option value="locums">Locums</option>
                        <option value="parttime">Parttime</option>
                        <option value="fulltime">Full time</option>
                      </select>
                    </div>
                    
                    <!-- Date Posted Filter -->
                    <div style="margin-bottom: 16px;">
                      <label style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: #121C0C;">Posted Within</label>
                      <select id="filter-date-posted" class="form-control" style="font-size: 13px; padding: 6px 10px;">
                        <option value="">Any time</option>
                        <option value="1">Last 24 hours</option>
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                        <option value="90">Last 3 months</option>
                      </select>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 8px; margin-top: 16px;">
                      <button id="apply-filter-btn" class="action-btn" style="flex: 1; padding: 8px 12px; font-size: 13px;">Apply</button>
                      <button id="clear-filter-btn" class="action-btn" style="flex: 1; padding: 8px 12px; font-size: 13px; background: #f3f4f6; color: #6b7280;">Clear</button>
                    </div>
                  </div>
                </div>
              </div>
              <button id="save-btn" class="action-btn" title="Notify Hire - Mark selected jobs as hired and move to accepted" data-bs-toggle="tooltip" data-bs-placement="top">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 10.5V12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2H13.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <circle cx="19" cy="5" r="3" stroke="#1C274C" stroke-width="1.5"/>
                <path d="M7 14H16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M7 17.5H13" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                </svg> Notify of hire
              </button>
              <button id="email-btn" class="action-btn" title="Email" style="margin-left: 8px;">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="style=stroke">
                <g id="email">
                <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="currentColor"></path>
                <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="currentcolor"></path>
                </g>
                </g>
                <use xlink:href="#icon-email"/>
                </svg> Email
              </button>
              
              <!-- Apply button -->
              <button id="apply-btn" class="action-btn" title="Apply to selected jobs">
                <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <g data-name="Layer 2">
                <g data-name="checkmark-circle">
                <rect width="24" height="24" opacity="0"/>
                <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                </g>
                </g>
                <use xlink:href="#icon-apply"/>
                </svg> Apply
              </button>
            </div>
            
            <!-- Middle Group: Archive, Delete -->
            <div class="job-actions-middle" style="display: flex; gap: 8px; align-items: center;">
              <button id="archive-btn" class="action-btn" title="Archive">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21L12 12M12 12L15 15.3333M12 12L9 15.3333" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20.5 7V13C20.5 16.7712 20.5 18.6569 19.3284 19.8284C18.1569 21 16.2712 21 12.5 21H11.5C7.72876 21 5.84315 21 4.67157 19.8284C3.5 18.6569 3.5 16.7712 3.5 13V7" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M2 5C2 4.05719 2 3.58579 2.29289 3.29289C2.58579 3 3.05719 3 4 3H20C20.9428 3 21.4142 3 21.7071 3.29289C22 3.58579 22 4.05719 22 5C22 5.94281 22 6.41421 21.7071 6.70711C21.4142 7 20.9428 7 20 7H4C3.05719 7 2.58579 7 2.29289 6.70711C2 6.41421 2 5.94281 2 5Z" stroke="currentcolor" stroke-width="1.5"/>
                <use xlink:href="#icon-archive"/>
                </svg> Archive
              </button>
              <button id="delete-btn" class="action-btn" title="Delete">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.17065 4C9.58249 2.83481 10.6937 2 11.9999 2C13.3062 2 14.4174 2.83481 14.8292 4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M20.5 6H3.49988" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5M18.8334 8.5L18.6334 11.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M9.5 11L10 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M14.5 11L14 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <use xlink:href="#icon-delete"/>
                </svg> Delete
              </button>
            </div>
            
            <!-- Right Group: Note, Grid View, New Window, Menu -->
            <div class="col-dropdowns d-flex gap-2">
              <button id="note-btn" class="action-btn d-none" title="Add Note" onclick="handleNoteClick()" style="display: none;">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <!-- Sticky note with pencil icon -->
                  <path d="M8 3H14C16.7614 3 19 5.23858 19 8V14.5C19 15.0523 18.5523 15.5 18 15.5H14C12.3431 15.5 11 16.8431 11 18.5V20C11 20.5523 10.5523 21 10 21H8C5.23858 21 3 18.7614 3 16V8C3 5.23858 5.23858 3 8 3Z" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M21 7L15 13L14 16L17 15L23 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Note
              </button>
              <button id="grid-view-btn" class="action-btn" title="Split View">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 3H10V10H3V3Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 3H21V10H14V3Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 14H10V21H3V14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 14H21V21H14V14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Split View
              </button>
              <button id="float-view-btn" class="action-btn" title="Open in New Window">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13 3H21V11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M13 21H3V3H21V11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M13 11L21 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                New Window
              </button>
              <!-- Columns Dropdown -->
              <div class="columns-dropdown position-relative" style = "display: none;">
                <button type="button" class="columns-dropdown-btn dropdown-cstm"><span>Columns</span></button>
                <div class="dropdown-panel columns-panel custom-dropdown hidden">
                  <label><input type="checkbox" value="salary"> Salary</label>
                  <label><input type="checkbox" value="location"> Location</label>
                  <label><input type="checkbox" value="date-posted"> Date Posted</label>
                  <label><input type="checkbox" value="deadline"> Deadline</label>
                  <label><input type="checkbox" value="date-applied"> Date Applied</label>
                  <label><input type="checkbox" value="excitement"> Score</label>
                </div>
              </div>

              <!-- Menu Dropdown -->
              <div class="menu-dropdown position-relative">
                <button type="button" class="menu-dropdown-btn dropdown-cstm"><span>Menu</span></button>
                <div class="dropdown-panel menu-panel custom-dropdown hidden">
                  <div class="menu-item"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g id="Warning / Info">
                    <path id="Vector" d="M12 11V16M12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21ZM12.0498 8V8.1L11.9502 8.1002V8H12.0498Z" stroke="#121C0C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </g>
                    </svg> Quick Tour</div>
                  <a href="{{ path('app_provider_jobs_archived') }}" class="menu-item" style="text-decoration: none; color: inherit;"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path opacity="0.5" d="M20.5 7V13C20.5 16.7712 20.5 18.6569 19.3284 19.8284C18.1569 21 16.2712 21 12.5 21H11.5C7.72876 21 5.84315 21 4.67157 19.8284C3.5 18.6569 3.5 16.7712 3.5 13V7" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M2 5C2 4.05719 2 3.58579 2.29289 3.29289C2.58579 3 3.05719 3 4 3H20C20.9428 3 21.4142 3 21.7071 3.29289C22 3.58579 22 4.05719 22 5C22 5.94281 22 6.41421 21.7071 6.70711C21.4142 7 20.9428 7 20 7H4C3.05719 7 2.58579 7 2.29289 6.70711C2 6.41421 2 5.94281 2 5Z" stroke="#121C0C" stroke-width="1.5"/>
                    <path d="M12 7L12 16M12 16L15 12.6667M12 16L9 12.6667" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg> Archived Jobs</a>
                  <div class="menu-item"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16.44 8.8999C20.04 9.2099 21.51 11.0599 21.51 15.1099V15.2399C21.51 19.7099 19.72 21.4999 15.25 21.4999H8.73998C4.26998 21.4999 2.47998 19.7099 2.47998 15.2399V15.1099C2.47998 11.0899 3.92998 9.2399 7.46998 8.9099" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 15.0001V3.62012" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15.35 5.85L12 2.5L8.65002 5.85" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg> Export Report</div>
                  <div class="menu-item" id="download-data-btn" style="cursor: pointer;"><svg width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16.44 8.8999C20.04 9.2099 21.51 11.0599 21.51 15.1099V15.2399C21.51 19.7099 19.72 21.4999 15.25 21.4999H8.73998C4.26998 21.4999 2.47998 19.7099 2.47998 15.2399V15.1099C2.47998 11.0899 3.92998 9.2399 7.46998 8.9099" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 15.0001V3.62012" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15.35 5.85L12 2.5L8.65002 5.85" stroke="#121C0C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg> Download Data</div>
                </div>
              </div>
            </div>
        </div>

        {% if bookmarks|length > 0 %}
        <div class="job-list-container bg-light p-3 rounded-3">
          <div class="table-responsive-wrapper" style="overflow-x: auto; width: 100%;">
          <div class="d-flex align-items-center job-lists">
            <div class="d-flex align-items-center flex-grow-1" style="width: 100%; min-width: 0;">
              <div class="job-header d-flex align-items-center fw-semibold py-2 flex-grow-1" style="width: 100%; min-width: 0; gap: 0;">
                <div class="col-job sortable" data-sort="job" style="width: 200px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: flex-start; gap: 4px;">Job<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
                <div class="col-start col-center sortable" data-sort="location" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Location<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
                <div class="col-start col-center sortable" data-sort="posted" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Posted on<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
                <div class="col-expiry col-center sortable" data-sort="expires" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Expires on<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
                <div class="col-start col-center sortable" data-sort="salary" style="width: 80px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Salary(Hourly)<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
                <div class="col-start col-center sortable" data-sort="category" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">Category<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
                <div class="col-start col-center col-rank sortable" data-sort="rank" style="width: 70px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; gap: 4px;"><span style="font-size: 13px; font-weight: bold; line-height: 1.2;">Score</span><span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                </div>
              </div>
            </div>
          </div>

          {% for bookmark in bookmarks %}
            {% set job = bookmark.job %}
            <div class="d-flex align-items-center job-lists">
              <div class="job-row d-flex align-items-center flex-grow-1" style="width: 100%; min-width: 0; gap: 0;">
                <div class="col-check" style="width: 30px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center;">
                  <input type="checkbox" class="job-check job-checkbox" data-bookmark-id="{{ bookmark.id }}" data-job-id="{{ job.id }}" />
                </div>
                <div class="col-job d-flex align-items-center gap-2" style="width: 200px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box;">
                  <img src="{{ job.companyLogo|default(asset('assets/icons/job.png')) }}"
                    alt="Logo"
                    style="width: 40px; height: 40px; border-radius: 8px; flex-shrink: 0;" />
                  <div style="min-width: 0; overflow: hidden;">
                    <a class="job-title truncate-text d-block fw-semibold text-decoration-none"
                      href="{{ path('app_provider_jobs_detail', {'id': job.id}) }}"
                      style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px;">
                        {{ job.title }}
                    </a>
                  </div>
                  </div>
                  <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.state }}</div>
                  <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.startDate ? job.startDate|date('m/d/Y') : '—' }}</div>
                  <div class="col-expiry col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.expirationDate ? job.expirationDate|date('m/d/Y') : '—' }}</div>
                  <div class="col-start col-center" style="width: 80px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.formattedSalary }}</div>
                  <div class="col-start col-center" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center;">
                    <select class="category-select" style="width: 100%; padding: 4px 8px; border: 1px solid #e6eef6; border-radius: 6px; background-color: #fff; cursor: pointer; font-size: 11px; color: #121C0C;">
                      <option value="locums">Locums</option>
                      <option value="parttime">Parttime</option>
                      <option value="fulltime">Full time</option>
                    </select>
                  </div>
                  <div class="col-start col-center col-rank" style="width: 70px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
                    <span class="rank-display" data-job-id="{{ job.id }}" style="font-size: 13px;">
                      {{ bookmark.rank is not null ? bookmark.rank ~ '/10' : '—' }}
                    </span>
                    <input
                      type="number"
                      class="rank-input hidden"
                      value="{{ bookmark.rank is not null ? bookmark.rank : '' }}"
                      min="1"
                      max="10"
                      step="0.5"
                      data-job-id="{{ job.id }}"
                      data-original-value="{{ bookmark.rank is not null ? bookmark.rank : '' }}"
                      style="width: 60px; text-align:center; border: 1px solid #ccc; border-radius: 6px; padding: 2px 4px; font-size: 13px;"
                      oninput="if (this.value > 10) this.value = 10; if (this.value < 1) this.value = 1;"
                    />
                  </div>
                </div>
            </div>
          {% endfor %}
          </div>
        </div>
        {% else %}
            <p class="mb-0">Saved jobs not found.</p>
        {% endif %}
        <div class="job-actions hidden-buttons ml-15-px" style="margin-bottom: 20px; display: flex; gap: 8px; align-items: center; visibility: hidden;">
          <button id="save-btn-bottom" class="action-btn" title="Notify Hire - Mark selected jobs as hired and move to accepted" data-bs-toggle="tooltip" data-bs-placement="top">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22 10.5V12C22 16.714 22 19.0711 20.5355 20.5355C19.0711 22 16.714 22 12 22C7.28595 22 4.92893 22 3.46447 20.5355C2 19.0711 2 16.714 2 12C2 7.28595 2 4.92893 3.46447 3.46447C4.92893 2 7.28595 2 12 2H13.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <circle cx="19" cy="5" r="3" stroke="#1C274C" stroke-width="1.5"/>
                <path d="M7 14H16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M7 17.5H13" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </button>
              <!-- Bottom Apply button -->
              <button id="apply-btn-bottom" class="action-btn" title="Apply to selected jobs">
                <svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <g data-name="Layer 2">
                <g data-name="checkmark-circle">
                <rect width="24" height="24" opacity="0"/>
                <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                </g>
                </g>
                <use xlink:href="#icon-apply"/>
                </svg>
              </button>
              <button id="email-btn-bottom" class="action-btn" title="Email">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="style=stroke">
                <g id="email">
                <path id="vector (Stroke)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88534 5.2371C3.20538 5.86848 2.75 6.89295 2.75 8.5V15.5C2.75 17.107 3.20538 18.1315 3.88534 18.7629C4.57535 19.4036 5.61497 19.75 7 19.75H17C18.385 19.75 19.4246 19.4036 20.1147 18.7629C20.7946 18.1315 21.25 17.107 21.25 15.5V8.5C21.25 6.89295 20.7946 5.86848 20.1147 5.2371C19.4246 4.59637 18.385 4.25 17 4.25H7C5.61497 4.25 4.57535 4.59637 3.88534 5.2371ZM2.86466 4.1379C3.92465 3.15363 5.38503 2.75 7 2.75H17C18.615 2.75 20.0754 3.15363 21.1353 4.1379C22.2054 5.13152 22.75 6.60705 22.75 8.5V15.5C22.75 17.393 22.2054 18.8685 21.1353 19.8621C20.0754 20.8464 18.615 21.25 17 21.25H7C5.38503 21.25 3.92465 20.8464 2.86466 19.8621C1.79462 18.8685 1.25 17.393 1.25 15.5V8.5C1.25 6.60705 1.79462 5.13152 2.86466 4.1379Z" fill="currentColor"></path>
                <path id="vector (Stroke)_2" fill-rule="evenodd" clip-rule="evenodd" d="M19.3633 7.31026C19.6166 7.63802 19.5562 8.10904 19.2285 8.3623L13.6814 12.6486C12.691 13.4138 11.3089 13.4138 10.3185 12.6486L4.77144 8.3623C4.44367 8.10904 4.38328 7.63802 4.63655 7.31026C4.88982 6.98249 5.36083 6.9221 5.6886 7.17537L11.2356 11.4616C11.6858 11.8095 12.3141 11.8095 12.7642 11.4616L18.3113 7.17537C18.6391 6.9221 19.1101 6.98249 19.3633 7.31026Z" fill="currentcolor"></path>
                </g>
                </g>
                <use xlink:href="#icon-email"/>
                </svg>
              </button>
              
              <button id="delete-btn-bottom" class="action-btn" title="Delete">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.17065 4C9.58249 2.83481 10.6937 2 11.9999 2C13.3062 2 14.4174 2.83481 14.8292 4" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M20.5 6H3.49988" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M18.3735 15.3991C18.1965 18.054 18.108 19.3815 17.243 20.1907C16.378 21 15.0476 21 12.3868 21H11.6134C8.9526 21 7.6222 21 6.75719 20.1907C5.89218 19.3815 5.80368 18.054 5.62669 15.3991L5.16675 8.5M18.8334 8.5L18.6334 11.5" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M9.5 11L10 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M14.5 11L14 16" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <use xlink:href="#icon-delete"/>
                </svg>
              </button>
              <button id="archive-btn-bottom" class="action-btn" title="Archive">
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 21L12 12M12 12L15 15.3333M12 12L9 15.3333" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M20.5 7V13C20.5 16.7712 20.5 18.6569 19.3284 19.8284C18.1569 21 16.2712 21 12.5 21H11.5C7.72876 21 5.84315 21 4.67157 19.8284C3.5 18.6569 3.5 16.7712 3.5 13V7" stroke="currentcolor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M2 5C2 4.05719 2 3.58579 2.29289 3.29289C2.58579 3 3.05719 3 4 3H20C20.9428 3 21.4142 3 21.7071 3.29289C22 3.58579 22 4.05719 22 5C22 5.94281 22 6.41421 21.7071 6.70711C21.4142 7 20.9428 7 20 7H4C3.05719 7 2.58579 7 2.29289 6.70711C2 6.41421 2 5.94281 2 5Z" stroke="currentcolor" stroke-width="1.5"/>
                <use xlink:href="#icon-archive"/>
                </svg> Archive
              </button>
        </div>

        <!-- Split View Container -->
        <div class="split-view-container" id="split-view-container">
            <button class="list-toggle-btn" id="list-toggle-btn" style="display: none;" title="Toggle job list">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 6L9 12L15 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <!-- Left Side: Job List -->
            <div class="split-job-list" id="split-job-list">
                <button id="list-collapse-btn" class="list-collapse-toggle" title="Collapse/Expand Job List">
                    <svg class="collapse-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 6L15 12L9 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                {% for bookmark in bookmarks %}
                    {% set job = bookmark.job %}
                    <div class="split-job-card" data-job-id="{{ job.id }}">
                        <div class="split-job-card-header">
                            <input type="checkbox" class="job-checkbox" data-bookmark-id="{{ bookmark.id }}" data-job-id="{{ job.id }}" style="margin-top: 2px;">
                            <img src="{{ job.companyLogo|default(asset('assets/icons/job.png')) }}" 
                                alt="Logo" class="split-job-card-logo">
                            <div class="flex-grow-1">
                                <div class="split-job-card-title">{{ job.title }}</div>
                                <div class="split-job-card-company">{{ job.companyName|default('Company') }}</div>
                            </div>
                        </div>
                        <div class="split-job-summary">
                            <div class="split-job-summary-item">
                                <span class="split-job-meta-label">Match:</span>
                                <span class="split-job-meta-value">50%</span>
                            </div>
                            <div class="split-job-summary-item">
                                <span class="split-job-meta-label">Score:</span>
                                <span class="split-job-meta-value">{{ bookmark.rank is not null ? bookmark.rank : loop.index }}</span>
                            </div>
                        </div>
                        
                        <div class="split-job-card-meta">
                            {# Category removed from left card per request #}
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Right Side: Job Details -->
            <div class="split-job-details" id="split-job-details">
                <div class="split-job-details-header">
                    <h4 style="margin: 0;">Job Details</h4>
                    <button id="split-apply-btn" class="action-btn" title="Apply to this job">
                        <svg class="icon-image" fill="currentcolor" width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <g data-name="Layer 2">
                                <g data-name="checkmark-circle">
                                    <rect width="24" height="24" opacity="0"/>
                                    <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                                    <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                                </g>
                            </g>
                        </svg>
                        Apply
                    </button>
                </div>
                
                <button id="detail-note-btn" class="action-btn" title="Add Note" style="position: absolute; top: 10px; right: 10px; display: none; cursor: pointer;">
                  <svg class="icon-image" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 3H14C16.7614 3 19 5.23858 19 8V14.5C19 15.0523 18.5523 15.5 18 15.5H14C12.3431 15.5 11 16.8431 11 18.5V20C11 20.5523 10.5523 21 10 21H8C5.23858 21 3 18.7614 3 16V8C3 5.23858 5.23858 3 8 3Z" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M21 7L15 13L14 16L17 15L23 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  Note
                </button>
                <div class="no-job-selected">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H16M8 16H16M8 8H12M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <h4>Select a job to view details</h4>
                    <p>Click on any job from the list to see its full details here.</p>
                </div>
                
                <!-- Job details will be dynamically loaded here -->
                <div id="job-detail-content" style="display: none;"></div>
                
                <!-- Notes Drawer -->
                <aside id="notes-panel" class="notes-panel" aria-hidden="true">
                  <div class="notes-panel-header">
                    <span>Notes</span>
                    <button type="button" class="notes-panel-close" onclick="closeNotesPanel()">×</button>
                  </div>
                  <div class="notes-panel-body">
                    <div class="notes-title">
                      <h6>Add notes for this job</h6>
                      <p class="text-muted">Your notes are saved automatically and only visible to you.</p>
                    </div>
                    <textarea id="notes-textarea" class="notes-textarea" placeholder="Write your notes here..."></textarea>
                    <div class="notes-footer">
                      <div class="last-saved" style="display: none;">
                        Last saved <span class="last-saved-time"></span>
                      </div>
                    </div>
                  </div>
                </aside>
            </div>
        </div>
    </div>
  </div>
  
  <!-- Email Template Modals -->
  <div id="email-modal-overlay" class="email-modal-overlay" style="display:none;"></div>
  <div id="email-template-1-modal" class="email-modal" aria-hidden="true" style="display:none;">
    <div class="email-modal-header">
      <h5>Email Template: Intro/Referral</h5>
      <button class="email-modal-close" data-close>&times;</button>
    </div>
    <div class="email-modal-body">
      <label>Subject</label>
      <input id="email-t1-subject" type="text" readonly>
      <label>Message</label>
      <textarea id="email-t1-message" readonly></textarea>
    </div>
    <div class="email-modal-footer">
      <button class="dropdown-cstm" data-copy-subject="#email-t1-subject">Copy Subject</button>
      <button class="dropdown-cstm" data-copy-message="#email-t1-message">Copy Message</button>
      <button class="action-btn" data-open-gmail data-sub="#email-t1-subject" data-body="#email-t1-message">Open in Gmail</button>
    </div>
  </div>
  <div id="email-template-2-modal" class="email-modal" aria-hidden="true" style="display:none;">
    <div class="email-modal-header">
      <h5>Email Template: Follow-up</h5>
      <button class="email-modal-close" data-close>&times;</button>
    </div>
    <div class="email-modal-body">
      <label>Subject</label>
      <input id="email-t2-subject" type="text" readonly>
      <label>Message</label>
      <textarea id="email-t2-message" readonly></textarea>
    </div>
    <div class="email-modal-footer">
      <button class="dropdown-cstm" data-copy-subject="#email-t2-subject">Copy Subject</button>
      <button class="dropdown-cstm" data-copy-message="#email-t2-message">Copy Message</button>
      <button class="action-btn" data-open-gmail data-sub="#email-t2-subject" data-body="#email-t2-message">Open in Gmail</button>
    </div>
  </div>
  <style>
  /* Split View Styles */
  .split-view-container {
      display: none;
      grid-template-columns: minmax(350px, 1fr) 1.5fr;
      gap: 20px;
      margin-top: 20px;
      height: 70vh;
      position: relative;
  }

  .split-view-container.list-collapsed {
      grid-template-columns: 50px 1fr !important;
  }

  .split-view-container.list-collapsed .split-job-list {
      width: 50px;
      min-width: 50px;
      overflow: hidden;
      opacity: 0;
      transition: all 0.3s ease;
  }

  .split-view-container .split-job-list {
      width: 100%;
      opacity: 1;
      transition: all 0.3s ease;
      position: relative;
  }

  .list-toggle-btn {
      display: none;
      position: absolute;
      right: -15px;
      top: 50%;
      transform: translateY(-50%);
      background: #fff;
      border: 1px solid #e6eef6;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      padding: 0;
      cursor: pointer;
      z-index: 10;
      box-shadow: 0 2px 6px rgba(11,22,40,0.1);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
  }

  .list-toggle-btn:hover {
      background: #F4F9F1;
      border-color: #85BB65;
      transform: translateY(-50%) scale(1.1);
  }

  .list-toggle-btn svg {
      width: 16px;
      height: 16px;
      transition: transform 0.3s ease;
  }

  .split-view-container.list-collapsed .list-toggle-btn {
      right: -45px;
  }

  .split-view-container.list-collapsed .list-toggle-btn svg {
      transform: rotate(180deg);
  }

  .split-job-list {
      background: #F4F9F1;
      border: 1px solid #e6eef6;
      border-radius: 10px;
      padding: 16px;
      overflow-y: auto;
      box-shadow: 0 2px 6px rgba(11,22,40,0.03);
      position: relative; /* for collapse arrow positioning */
  }
  
  .split-job-list.collapsed {
      overflow: hidden;
  }
  
  .split-job-list.collapsed .split-job-card {
      display: none;
  }
  
  .list-collapse-toggle {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #fff;
      border: 1px solid #e6eef6;
      border-radius: 6px;
      padding: 6px 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(11,22,40,0.08);
      transition: all 0.2s ease;
  }
  
  .list-collapse-toggle:hover {
      background: #F4F9F1;
      border-color: #85BB65;
  }
  
  .list-collapse-toggle .collapse-icon {
      transition: transform 0.2s ease;
  }
  
  .split-job-list.collapsed .list-collapse-toggle .collapse-icon {
      transform: rotate(180deg);
  }

  .split-job-details {
      background: #fff;
      border: 1px solid #e6eef6;
      border-radius: 10px;
      padding: 20px;
      overflow-y: auto;
      overflow-x: hidden;
      box-shadow: 0 2px 6px rgba(11,22,40,0.03);
      position: relative; /* anchor absolute buttons inside the details box */
  }
  
  /* Ensure job details content remains visible when notes panel is open */
  .split-job-details {
      transition: padding-right 0.2s ease;
      position: relative;
  }
  
  .split-job-details.notes-open {
      padding-right: 380px;
  }
  
  /* Ensure content inside job details is visible */
  .split-job-details #job-detail-content,
  .split-job-details .no-job-selected {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
  }
  
  /* When notes are open, content should be visible on the left side */
  .split-job-details.notes-open #job-detail-content,
  .split-job-details.notes-open .no-job-selected {
      overflow: visible;
  }

  .split-job-card {
      background: white;
      border: 1px solid #e6eef6;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
  }

  .split-job-card:hover {
      border-color: #85BB65;
      transform: translateX(2px);
  }

  .split-job-card.active {
      border-color: #85BB65;
      background-color: #F4F9F1;
  }

  .split-job-card-header {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 8px;
      position: relative;
  }

  .split-job-card-logo {
      width: 40px;
      height: 40px;
      border-radius: 6px;
      flex-shrink: 0;
  }

  .split-job-card-title {
      font-weight: 600;
      color: #121C0C;
      font-size: 16px;
      margin-bottom: 2px;
  }

  .split-job-card-company {
      color: #666;
      font-size: 13px;
  }

  .split-job-card-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
      font-size: 13px;
  }

  .split-job-summary {
      display: flex;
      align-items: center;
      gap: 14px;
      margin: 6px 0 4px 56px; /* indent to align under logo/title */
      font-size: 13px;
  }
  .split-job-summary-item {
      display: flex;
      gap: 6px;
  }

  .split-job-meta-item {
      display: flex;
      justify-content: space-between;
  }

  .split-job-meta-label {
      color: #666;
  }

  .split-job-meta-value {
      color: #121C0C;
      font-weight: 500;
  }

  /* Job Details Styles */
  .job-detail-header {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e6eef6;
  }

  .job-detail-logo {
      width: 60px;
      height: 60px;
      border-radius: 8px;
  }

  .job-detail-title {
      font-size: 24px;
      font-weight: 700;
      color: #121C0C;
      margin-bottom: 4px;
  }

  .job-detail-company {
      font-size: 16px;
      color: #666;
      margin-bottom: 8px;
  }

  .job-detail-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
  }

  .job-detail-meta-item {
      background: #F4F9F1;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #e6eef6;
  }

  .job-detail-meta-label {
      font-size: 13px;
      color: #666;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 4px;
  }

  .job-detail-meta-value {
      font-size: 16px;
      color: #121C0C;
      font-weight: 600;
  }

  .job-detail-section {
      margin-bottom: 24px;
  }

  .job-detail-section-title {
      font-size: 16px;
      font-weight: 600;
      color: #121C0C;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid #85BB65;
  }

  .job-detail-description {
      line-height: 1.6;
      color: #333;
  }

  .job-detail-requirements {
      list-style: none;
      padding: 0;
  }

  .job-detail-requirements li {
      padding: 4px 0;
      padding-left: 20px;
      position: relative;
  }

  .job-detail-requirements li:before {
      content: "•";
      color: #47ddff;
      font-weight: bold;
      position: absolute;
      left: 0;
  }

  .job-detail-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid #e6eef6;
  }

  /* Active state for grid view button */
  #grid-view-btn.active {
      border-color: #85BB65;
  }

  .no-job-selected {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #666;
      text-align: center;
  }

  .no-job-selected svg {
      margin-bottom: 16px;
      opacity: 0.5;
  }

  #float-view-btn.active {
    background-color: #85BB65 !important;
    color: white !important;
    border-color: #85BB65 !important;
}

#float-view-btn.active:hover {
    background-color: #85BB65 !important;
    border-color: #85BB65 !important;
}

  /* Note button styles removed */

  /* Notes side panel */
  .notes-panel {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    width: 360px;
    max-width: 90vw;
    background: #fff;
    border-left: 1px solid #e6eef6;
    box-shadow: -2px 0 8px rgba(11,22,40,0.06);
    transform: translateX(100%);
    transition: transform 0.2s ease;
    display: flex;
    flex-direction: column;
    z-index: 10;
    visibility: hidden;
    overflow-y: auto;
    pointer-events: none;
  }
  .notes-panel.open { 
    transform: translateX(0); 
    visibility: visible;
    pointer-events: auto;
  }
  
  .notes-panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 14px;
    border-bottom: 1px solid #e6eef6;
    font-weight: 600;
  }
  .notes-panel-close { 
    background: transparent; 
    border: none; 
    font-size: 22px; 
    cursor: pointer;
    color: #666;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
  }
  .notes-panel-close:hover {
    background: #f5f5f5;
    color: #333;
  }
  .notes-panel-body { 
    padding: 16px; 
    display: flex; 
    flex-direction: column; 
    height: 100%; 
  }
  .notes-title {
    margin-bottom: 16px;
  }
  .notes-title h6 {
    font-size: 14px;
    font-weight: 600;
    color: #333;
    margin-bottom: 4px;
  }
  .notes-title p {
    font-size: 12px;
    margin: 0;
  }
  .notes-textarea {
    width: 100%;
    flex: 1;
    resize: none;
    border: 1px solid #e6eef6;
    border-radius: 8px;
    padding: 12px;
    outline: none;
    font-size: 14px;
    line-height: 1.5;
    min-height: 200px;
  }
  .notes-textarea:focus {
    border-color: #85BB65;
    box-shadow: 0 0 0 2px rgba(133, 187, 101, 0.1);
  }
  .notes-footer {
    margin-top: 12px;
    color: #666;
    font-size: 12px;
  }
  .notes-footer .last-saved {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .notes-footer .last-saved::before {
    content: "✓";
    color: #85BB65;
  }
  
  /* Email modal styles */
  .email-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.3);
    z-index: 999;
  }
  .email-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: min(700px, 95vw);
    max-height: 80vh;
    background: #fff;
    border: 1px solid #e6eef6;
    border-radius: 10px;
    box-shadow: 0 6px 18px rgba(11,22,40,0.15);
    display: flex;
    flex-direction: column;
    z-index: 1000;
  }
  .email-modal-header { 
    display: flex; justify-content: space-between; align-items: center; 
    padding: 12px 14px; border-bottom: 1px solid #e6eef6; 
  }
  .email-modal-body { padding: 14px; display: flex; flex-direction: column; gap: 8px; }
  .email-modal-body input, .email-modal-body textarea {
    width: 100%; border: 1px solid #e6eef6; border-radius: 8px; padding: 10px; outline: none;
  }
  .email-modal-body textarea { min-height: 180px; resize: vertical; }
  .email-modal-footer { display: flex; gap: 8px; padding: 12px 14px; border-top: 1px solid #e6eef6; }
  .email-modal-close { background: transparent; border: none; font-size: 22px; cursor: pointer; color: #666; }
  </style>
{% endblock %}

{% block footer_scripts %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
  document.addEventListener('DOMContentLoaded', function () {
    // Initialize ALL checkboxes including those in split view
    function initializeCheckboxes() {
      const listCheckboxes = document.querySelectorAll('.job-list-container .job-checkbox');
      const splitCheckboxes = document.querySelectorAll('#split-job-list .job-checkbox');
      return [...listCheckboxes, ...splitCheckboxes];
    }

    let checkboxes = initializeCheckboxes();
    const deleteBtn = document.getElementById('delete-btn');
    const deleteBtnBottom = document.getElementById('delete-btn-bottom');
    const applyBtn = document.getElementById('apply-btn');
    const applyBtnBottom = document.getElementById('apply-btn-bottom');
    const splitApplyBtn = document.getElementById('split-apply-btn');
    const actionsDivs = document.querySelectorAll('.hidden-buttons');
    const menuBtn = document.querySelector('.menu-dropdown-btn');
    const menuPanel = document.querySelector('.menu-panel');
    const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
    const confirmApplyBtn = document.getElementById('confirm-apply-btn');
    const deleteForm = document.getElementById('delete-bookmarks-form');
    const applyForm = document.getElementById('apply-jobs-form');
    const bookmarkIdsInput = document.getElementById('bookmark-ids-input');
    const jobIdsInput = document.getElementById('job-ids-input');

    // Reinitialize checkboxes when split view is toggled
    function reinitializeCheckboxes() {
      checkboxes = initializeCheckboxes();
      console.log('Checkboxes reinitialized. Total:', checkboxes.length);
    }

    function toggleDropdown(panel, btn) {
        const isOpen = !panel.classList.contains('hidden');
        closeAllDropdowns();
        if (!isOpen) panel.classList.remove('hidden');
    }

    function closeAllDropdowns() {
        menuPanel.classList.add('hidden');
    }

    menuBtn.addEventListener('click', e => {
        e.stopPropagation();
        toggleDropdown(menuPanel, menuBtn);
    });

    document.addEventListener('click', e => {
        if (!menuPanel.contains(e.target) && !menuBtn.contains(e.target)) {
            closeAllDropdowns();
        }
    });

    // Fixed delete functionality
    function handleDelete() {
        // Reinitialize checkboxes to ensure we have all current ones
        reinitializeCheckboxes();
        
        const selectedBookmarks = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.dataset.bookmarkId)
            .filter(id => id !== undefined); // Filter out any undefined IDs

        console.log('Selected bookmarks for deletion:', selectedBookmarks);

        if (selectedBookmarks.length === 0) {
            alert('Please select at least one saved job to delete.');
            return;
        }

        // Store the selected IDs and show confirmation modal
        bookmarkIdsInput.value = JSON.stringify(selectedBookmarks);
        console.log('Sending to server:', bookmarkIdsInput.value);
        
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
        deleteModal.show();
    }

    function handleApply() {
    // Reinitialize checkboxes to ensure we have all current ones
    reinitializeCheckboxes();
    
    const selectedJobs = Array.from(checkboxes)
        .filter(cb => {
            console.log('Checkbox:', cb);
            console.log('Checked:', cb.checked);
            console.log('Job ID:', cb.dataset.jobId);
            console.log('Bookmark ID:', cb.dataset.bookmarkId);
            return cb.checked;
        })
        .map(cb => {
            const jobId = cb.dataset.jobId;
            console.log('Mapping job ID:', jobId);
            return jobId;
        })
        .filter(id => {
            console.log('Filtering ID:', id, 'is valid:', id !== undefined && id !== null && id !== '');
            return id !== undefined && id !== null && id !== '';
        });

    console.log('Final selected jobs for application:', selectedJobs);
    console.log('Selected jobs type:', typeof selectedJobs);
    console.log('Selected jobs length:', selectedJobs.length);

    if (selectedJobs.length === 0) {
        alert('Please select at least one job to apply to.');
        return;
    }

    // Store the selected job IDs and show confirmation modal
    jobIdsInput.value = JSON.stringify(selectedJobs);
    console.log('Sending to server (stringified):', jobIdsInput.value);
    
    const applyModal = new bootstrap.Modal(document.getElementById('applyConfirmModal'));
    applyModal.show();
}

function processApplyRequest(jobIds) {
    console.log('Applying to job IDs:', jobIds);
    
    // Show loading state
    const applyBtn = document.getElementById('apply-btn');
    const applyBtnBottom = document.getElementById('apply-btn-bottom');
    const splitApplyBtn = document.getElementById('split-apply-btn');
    const originalHtml = applyBtn.innerHTML;
    applyBtn.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Applying...';
    applyBtn.disabled = true;
    if (applyBtnBottom) {
        applyBtnBottom.innerHTML = '<div class="spinner-border spinner-border-sm"></div>';
        applyBtnBottom.disabled = true;
    }
    if (splitApplyBtn) {
        splitApplyBtn.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Applying...';
        splitApplyBtn.disabled = true;
    }

    // Close the modal
    const applyModal = bootstrap.Modal.getInstance(document.getElementById('applyConfirmModal'));
    applyModal.hide();

    // Send as JSON instead of form data
    const requestData = { 
        jobIds: jobIds
    };
    
    console.log('Request data:', requestData);

    // Send AJAX request with JSON
    fetch('{{ path("app_provider_saved_jobs_apply") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
        },
        body: JSON.stringify(requestData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok: ' . response.status);
        }
        return response.json();
    })
    .then(data => {
        console.log('Response data:', data);
        if (data.success) {
            showToast(data.message, 'success');
            
            // Remove ALL processed jobs from UI (both newly applied and already applied)
            const allProcessedJobIds = [
                ...(data.appliedJobIds || []),
                ...(data.alreadyAppliedJobIds || [])
            ];
            
            if (allProcessedJobIds.length > 0) {
                allProcessedJobIds.forEach(jobId => {
                    // Remove from list view
                    const jobRow = document.querySelector(`.job-checkbox[data-job-id="${jobId}"]`)?.closest('.job-lists');
                    if (jobRow) {
                        jobRow.remove();
                    }
                    
                    // Remove from split view
                    const splitJobCard = document.querySelector(`.split-job-card[data-job-id="${jobId}"]`);
                    if (splitJobCard) {
                        splitJobCard.remove();
                    }
                });
                
                // Update counters
                updateJobCounters();
                
                // Uncheck all checkboxes
                uncheckAllCheckboxes();
                
                // Clear split view selection
                window.selectedJobId = null;
                const splitApplyBtn = document.getElementById('split-apply-btn');
                if (splitApplyBtn) splitApplyBtn.style.display = 'none';
                const jobDetailContent = document.getElementById('job-detail-content');
                const noJobSelected = document.querySelector('.no-job-selected');
                if (jobDetailContent) jobDetailContent.style.display = 'none';
                if (noJobSelected) noJobSelected.style.display = 'flex';
                
                // ✅ ADD THIS: Redirect to applications page after a short delay
                setTimeout(() => {
                    window.location.href = '{{ path("app_provider_jobs_applications") }}';
                }, 1500); // 1.5 second delay to show the success message
                
            } else {
                // No jobs were processed
                showToast(data.message, 'info');
                uncheckAllCheckboxes();
                toggleActionsVisibility();
            }
        } else {
            showToast('Error: ' + data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Network error. Please try again.', 'error');
    })
    .finally(() => {
        // Reset button
        applyBtn.innerHTML = originalHtml;
        applyBtn.disabled = false;
        if (applyBtnBottom) {
            applyBtnBottom.innerHTML = '<svg class="icon-image" fill="currentcolor" width="25" height="25" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g data-name="Layer 2"><g data-name="checkmark-circle"><rect width="24" height="24" opacity="0"/><path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/><path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/></g></g></svg>';
            applyBtnBottom.disabled = false;
        }
        if (splitApplyBtn) {
            splitApplyBtn.innerHTML = '<svg class="icon-image" fill="currentcolor" width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g data-name="Layer 2"><g data-name="checkmark-circle"><rect width="24" height="24" opacity="0"/><path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/><path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/></g></g></svg> Apply';
            splitApplyBtn.disabled = false;
        }
        toggleActionsVisibility();
    });
}
   
    // Delete button click handlers
    deleteBtn.addEventListener('click', handleDelete);
    deleteBtnBottom.addEventListener('click', handleDelete);

    // Apply button click handlers
    applyBtn.addEventListener('click', handleApply);
    applyBtnBottom.addEventListener('click', handleApply);

    // Split view apply button handler
    if (splitApplyBtn) {
        splitApplyBtn.addEventListener('click', function() {
            const jobId = window.selectedJobId;
            if (jobId) {
                handleApplyToSingleJob(jobId);
            }
        });
    }

    // Confirm delete button in modal
    confirmDeleteBtn.addEventListener('click', () => {
        // Submit the form
        deleteForm.submit();
    });

   
  confirmApplyBtn.addEventListener('click', () => {
      // Get the job IDs from the form input
      const jobIdsJson = jobIdsInput.value;
      const jobIds = JSON.parse(jobIdsJson);
      
      // Process the apply request using AJAX instead of form submission
      processApplyRequest(jobIds);
  });

    function toggleActionsVisibility() {
      const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
      actionsDivs.forEach(div => {
        div.style.visibility = anyChecked ? 'visible' : 'hidden';
      });
      
      // Enable/disable logic for apply buttons
      const applyButtons = [applyBtn, applyBtnBottom];
      applyButtons.forEach(btn => {
        if (btn) {
          btn.disabled = !anyChecked;
        }
      });
    }

    // Add event listeners to all checkboxes
    function attachCheckboxListeners() {
      checkboxes.forEach(cb => {
        // Remove existing listener to avoid duplicates
        cb.removeEventListener('change', toggleActionsVisibility);
        // Add new listener
        cb.addEventListener('change', toggleActionsVisibility);
      });
    }

    // Initial setup
    attachCheckboxListeners();
    toggleActionsVisibility();

    // Reattach listeners when split view changes
    const gridViewBtn = document.getElementById('grid-view-btn');
    if (gridViewBtn) {
      gridViewBtn.addEventListener('click', function() {
        setTimeout(() => {
          reinitializeCheckboxes();
          attachCheckboxListeners();
          toggleActionsVisibility();
        }, 100);
      });
    }
  });

  // Function to handle single job application from split view
  function handleApplyToSingleJob(jobId) {
    if (!jobId) {
        showToast('Please select a job to apply to.', 'warning');
        return;
    }
    
    if (confirm('Are you sure you want to apply to this job?')) {
        const splitApplyBtn = document.getElementById('split-apply-btn');
        const originalHtml = splitApplyBtn.innerHTML;
        
        // Show loading state
        splitApplyBtn.innerHTML = '<div class="spinner-border spinner-border-sm"></div> Applying...';
        splitApplyBtn.disabled = true;
        
        // Send apply request for single job
        fetch('{{ path("app_provider_saved_jobs_apply") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({ jobIds: [jobId] })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast('Application submitted successfully!', 'success');
                
                // Remove job from UI
                removeJobFromUI(jobId);
                
                // Clear selection
                window.selectedJobId = null;
                document.querySelectorAll('.split-job-card.active').forEach(card => {
                    card.classList.remove('active');
                });
                
                // Hide job details and show "no job selected"
                const jobDetailContent = document.getElementById('job-detail-content');
                const noJobSelected = document.querySelector('.no-job-selected');
                if (jobDetailContent) jobDetailContent.style.display = 'none';
                if (noJobSelected) noJobSelected.style.display = 'flex';
                
                // Hide apply button
                const splitApplyBtn = document.getElementById('split-apply-btn');
                if (splitApplyBtn) splitApplyBtn.style.display = 'none';
                
                // Update counters
                updateJobCounters();
                
            } else {
                showToast('Error: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showToast('Network error. Please try again.', 'error');
        })
        .finally(() => {
            // Reset button
            splitApplyBtn.innerHTML = originalHtml;
            splitApplyBtn.disabled = false;
        });
    }
  }

  // Function to remove job from UI
  function removeJobFromUI(jobId) {
    // Remove from list view
    const jobRow = document.querySelector(`.job-checkbox[data-job-id="${jobId}"]`)?.closest('.job-lists');
    if (jobRow) {
        jobRow.remove();
    }
    
    // Remove from split view
    const splitJobCard = document.querySelector(`.split-job-card[data-job-id="${jobId}"]`);
    if (splitJobCard) {
        splitJobCard.remove();
    }
  }

  // Function to update job counters
  function updateJobCounters() {
    // Update the saved jobs count in the status cards
    const remainingBookmarks = document.querySelectorAll('.job-checkbox').length;
    const savedCountElement = document.querySelector('.is-card.is-saved .card-text');
    if (savedCountElement) {
        savedCountElement.textContent = remainingBookmarks;
    }
    
    // Also update the "All" count if needed
    const allCountElement = document.querySelector('.is-card.is-applied .card-text');
    if (allCountElement) {
        // You might want to make an AJAX call to get the updated total count
        // For now, we'll just decrement it by the number of removed items
        const currentAllCount = parseInt(allCountElement.textContent) || 0;
        allCountElement.textContent = currentAllCount;
    }
  }

  // Function to uncheck all checkboxes
  function uncheckAllCheckboxes() {
    document.querySelectorAll('.job-checkbox').forEach(checkbox => {
        checkbox.checked = false;
    });
  }

  // Toast notification function
  function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toast-container') || createToastContainer();
    
    const toastId = 'toast-' + Date.now();
    const bgClass = type === 'success' ? 'text-bg-success' : 
                   type === 'error' ? 'text-bg-danger' : 
                   type === 'warning' ? 'text-bg-warning' : 'text-bg-info';
    
    const toastHtml = `
        <div id="${toastId}" class="toast align-items-center ${bgClass} border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML('beforeend', toastHtml);
    
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement);
    toast.show();
    
    // Remove toast from DOM after it hides
    toastElement.addEventListener('hidden.bs.toast', () => {
        toastElement.remove();
    });
  }

  function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toast-container';
    container.className = 'toast-container position-fixed top-0 end-0 p-3';
    container.style.zIndex = '9999';
    document.body.appendChild(container);
    return container;
  }
</script>

<script>
  // Split View Functionality with Apply Button Integration
  document.addEventListener('DOMContentLoaded', function () {
  const gridViewBtn = document.getElementById('grid-view-btn');
  const listViewContainer = document.querySelector('.job-list-container');
  const splitViewContainer = document.getElementById('split-view-container');
  const splitJobList = document.getElementById('split-job-list');
  const splitJobDetails = document.getElementById('split-job-details');
  const jobDetailContent = document.getElementById('job-detail-content');
  const noJobSelected = document.querySelector('.no-job-selected');
  const detailNoteBtn = document.getElementById('detail-note-btn');
  const splitApplyBtn = document.getElementById('split-apply-btn');
  
  let selectedJobId = null;
  
  if (gridViewBtn && listViewContainer && splitViewContainer) {
    gridViewBtn.addEventListener('click', function () {
        const isSplitView = splitViewContainer.style.display === 'grid';
        
        if (isSplitView) {
            // Switch to list view
            splitViewContainer.style.display = 'none';
            listViewContainer.style.display = 'block';
            gridViewBtn.classList.remove('active');
            gridViewBtn.innerHTML = `
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 3H10V10H3V3Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 3H21V10H14V3Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 14H10V21H3V14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14 14H21V21H14V14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Split View
            `;
            window.selectedJobId = null;
            try { closeNotesPanel && closeNotesPanel(); } catch (e) {}
            try { toggleActionsVisibility && toggleActionsVisibility(); } catch (e) {}
            if (detailNoteBtn) { detailNoteBtn.style.display = 'none'; }
            if (splitApplyBtn) { splitApplyBtn.style.display = 'none'; }
        } else {
            // Switch to split view
            splitViewContainer.style.display = 'grid';
            listViewContainer.style.display = 'none';
            gridViewBtn.classList.add('active');
            gridViewBtn.innerHTML = `
                <svg class="icon-image" width="25" height="25" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 6H21V8H3V6Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 10H21V12H3V10Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 14H21V16H3V14Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 18H21V20H3V18Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                List View
            `;
            // Do NOT auto-select any job; wait for user selection
            selectedJobId = null;
            window.selectedJobId = null;
            // Ensure Note button and Apply button stay hidden until a card is selected
            try { closeNotesPanel && closeNotesPanel(); toggleActionsVisibility && toggleActionsVisibility(); updateButtonStates && updateButtonStates(); } catch (e) {}
            if (detailNoteBtn) { detailNoteBtn.style.display = 'none'; }
            if (splitApplyBtn) { splitApplyBtn.style.display = 'none'; }
        }
    });
  }
  
  // List collapse/expand functionality
  const listCollapseBtn = document.getElementById('list-collapse-btn');
  if (listCollapseBtn) {
    listCollapseBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      splitJobList.classList.toggle('collapsed');
    });
  }
  
  // Job card selection
  splitJobList.addEventListener('click', function (e) {
      const jobCard = e.target.closest('.split-job-card');
      if (jobCard && !e.target.classList.contains('job-checkbox') && !e.target.closest('.list-collapse-toggle')) {
          selectJobCard(jobCard);
      }
  });
  
  function selectJobCard(jobCard) {
      // Remove active class from all cards
      document.querySelectorAll('.split-job-card').forEach(card => {
          card.classList.remove('active');
      });
      
      // Add active class to selected card
      jobCard.classList.add('active');
      
      // Get job ID and load details
      selectedJobId = jobCard.dataset.jobId;
      window.selectedJobId = selectedJobId;
      
      // Show apply button in split view
      if (splitApplyBtn) {
          splitApplyBtn.style.display = 'flex';
      }
      
      try { toggleActionsVisibility && toggleActionsVisibility(); updateButtonStates && updateButtonStates(); } catch (e) {}
      // If notes panel is open, load notes for the newly selected job
      const notesPanel = document.getElementById('notes-panel');
      if (notesPanel && notesPanel.classList.contains('open')) {
          openNotesPanel(selectedJobId);
      }
      loadJobDetails(selectedJobId);
  }

  function loadJobDetails(jobId) {
      // Show loading state
      noJobSelected.style.display = 'none';
      jobDetailContent.style.display = 'block';
      jobDetailContent.innerHTML = `
          <div class="text-center py-5">
              <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
              </div>
              <p class="mt-2">Loading job details...</p>
          </div>
      `;
      
      // Simulate AJAX call to fetch job details
      // In a real application, you would make an API call here
      setTimeout(() => {
          renderJobDetails(jobId);
      }, 500);
  }
  
  function renderJobDetails(jobId) {
    console.log('Loading job details for ID:', jobId);
    
    const jobDetailContent = document.getElementById('job-detail-content');
    const noJobSelected = document.querySelector('.no-job-selected');
    
    // Show loading state
    jobDetailContent.innerHTML = `
        <div class="text-center py-5">
            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h5 class="text-muted">Loading Job Details</h5>
        </div>
    `;
    
    const url = `/provider/jobs/${jobId}/detail-content`;
    
    fetch(url)
        .then(response => response.text().then(text => {
            console.log('Raw response:', text);
            
            if (!response.ok) {
                // Show the actual server error message
                throw new Error(`Server returned: ${text}`);
            }
            return text;
        }))
        .then(html => {
            jobDetailContent.innerHTML = html;
            jobDetailContent.style.display = 'block';
            if (noJobSelected) noJobSelected.style.display = 'none';
            if (detailNoteBtn) { detailNoteBtn.style.display = 'flex'; }
            
            // Add apply button to the job details content
            addApplyButtonToJobDetails(jobId);
        })
        .catch(error => {
            console.error('Full error:', error);
            jobDetailContent.innerHTML = `
                <div class="alert alert-danger">
                    <h4>Error Loading Job Details</h4>
                    <div>${error.message}</div>
                    <div class="mt-3">
                        <button class="action-btn" onclick="loadJobDetails('${jobId}')">Try Again</button>
                        <a href="/provider/jobs/${jobId}" class="action-btn">View Full Page</a>
                    </div>
                </div>
            `;
            jobDetailContent.style.display = 'block';
            if (noJobSelected) noJobSelected.style.display = 'none';
        });
}

// Function to add apply button to job details
function addApplyButtonToJobDetails(jobId) {
    const jobDetailContent = document.getElementById('job-detail-content');
    if (!jobDetailContent) return;
    
    // Look for existing apply button in the content
    let existingApplyBtn = jobDetailContent.querySelector('.btn-apply, .apply-button');
    
    if (!existingApplyBtn) {
        // Create and add apply button if it doesn't exist
        const applyBtnHtml = `
            <div class="job-detail-actions mt-4">
                <button class="btn btn-success btn-apply" onclick="handleApplyToSingleJob('${jobId}')">
                    <svg class="icon-image" fill="currentcolor" width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <g data-name="Layer 2">
                            <g data-name="checkmark-circle">
                                <rect width="24" height="24" opacity="0"/>
                                <path d="M9.71 11.29a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 16a1 1 0 0 0 .72-.34l7-8a1 1 0 0 0-1.5-1.32L12 13.54z"/>
                                <path d="M21 11a1 1 0 0 0-1 1 8 8 0 0 1-8 8A8 8 0 0 1 6.33 6.36 7.93 7.93 0 0 1 12 4a8.79 8.79 0 0 1 1.9.22 a1 1 0 1 0 .47-1.94A10.54 10.54 0 0 0 12 2a10 10 0 0 0-7 17.09A9.93 9.93 0 0 0 12 22a10 10 0 0 0 10-10 1 1 0 0 0-1-1z"/>
                            </g>
                        </g>
                    </svg>
                    Apply to this Job
                </button>
            </div>
        `;
        
        // Add apply button at the end of job details
        jobDetailContent.insertAdjacentHTML('beforeend', applyBtnHtml);
    }
}

function loadJobDetails(jobId) {
    renderJobDetails(jobId);
}

function openNotesPanel(jobId) {
    const panel = document.getElementById('notes-panel');
    const textarea = document.getElementById('notes-textarea');
    const jobDetails = document.getElementById('split-job-details');
    if (!panel || !textarea) return;
    panel.dataset.jobId = jobId;
    const saved = localStorage.getItem('provider_job_notes_' + jobId) || '';
    textarea.value = saved;
    panel.classList.add('open');
    panel.setAttribute('aria-hidden', 'false');
    // Add class to job details container to adjust layout
    if (jobDetails) {
        jobDetails.classList.add('notes-open');
    }
    textarea.focus();
}
function closeNotesPanel() {
    const panel = document.getElementById('notes-panel');
    const jobDetails = document.getElementById('split-job-details');
    if (!panel) return;
    panel.classList.remove('open');
    panel.setAttribute('aria-hidden', 'true');
    // Remove class from job details container to restore layout
    if (jobDetails) {
        jobDetails.classList.remove('notes-open');
    }
}
function handleNoteClick() {
    // Prefer selected card in split view; fallback to a single checked checkbox
    const splitViewContainer = document.getElementById('split-view-container');
    const isSplitActive = splitViewContainer && splitViewContainer.style.display === 'grid';
    let jobId = null;
    if (isSplitActive) {
        jobId = window.selectedJobId || null;
        if (!jobId) {
            const activeCard = document.querySelector('.split-job-card.active');
            if (activeCard) jobId = activeCard.dataset.jobId;
        }
    }
    if (!jobId) {
        const single = Array.from(document.querySelectorAll('.job-checkbox')).filter(cb => cb.checked);
        if (single.length === 1) jobId = single[0].dataset.jobId;
    }
    if (jobId) {
        openNotesPanel(jobId);
    }
}
    
  // Make split view checkboxes work with existing functionality
  const splitCheckboxes = document.querySelectorAll('#split-job-list .job-checkbox');
  splitCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', function() {
          // Sync with main checkboxes if they exist
          const mainCheckbox = document.querySelector(`.job-list-container .job-checkbox[data-job-id="${this.dataset.jobId}"]`);
          if (mainCheckbox) {
              mainCheckbox.checked = this.checked;
          }
          toggleActionsVisibility();
          updateButtonStates();
      });
  });
});

// Initialize tooltips
const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
});
</script>

<!-- ALL REMAINING JAVASCRIPT CODE STAYS EXACTLY THE SAME -->
<!-- The rest of your existing JavaScript functions remain unchanged -->
{% endblock %}