{% set applicationsList = applications is iterable ? applications : applications.currentPageResults %}
{% if applicationsList|length > 0 %}
<div class="job-list-container bg-light p-3 rounded-3">
<div class="table-responsive-wrapper" style="overflow-x: auto; width: 100%;">
<div class="d-flex align-items-center job-lists">
    <div class="d-flex align-items-center flex-grow-1" style="width: 100%; min-width: 0;">
        <div class="job-header d-flex align-items-center fw-semibold py-2 flex-grow-1" style="width: 100%; min-width: 0; gap: 0;">
            <div class="col-job sortable" data-sort="job" style="width: 200px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; cursor: pointer;">Job<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
            <div class="col-start col-center sortable" data-sort="location" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">Location<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
            <div class="col-start col-center sortable" data-sort="salary" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">Salary/Hour<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
            {% if status not in ['interview', 'hired', 'completed'] or status == 'archived' %}
            <div class="col-start col-center sortable" data-sort="applied" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">Applied on<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
            <div class="col-start col-center col-rank sortable" data-sort="rank" style="width: 100px; min-width: 100px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; padding: 0 8px; box-sizing: border-box; cursor: pointer; overflow: visible; position: relative;"><span style="font-size: 13px; font-weight: bold; line-height: 1.2;">Score</span><span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
            {% endif %}
            {% if status not in ['applied', 'hired', 'completed'] or status == 'archived' %}
            <div class="col-start col-center sortable" data-sort="todo" style="width: 80px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">To Do<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
            <div class="col-start col-center sortable" data-sort="interview" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; white-space: nowrap; cursor: pointer;">Interview date<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
          {% endif %}
            <div class="col-start col-center sortable" data-sort="status" style="width: 140px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; cursor: pointer;">Status<span class="sort-toggle"><svg class="arrow sort-up" width="12" height="12" viewBox="0 0 24 24" fill="none"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg class="arrow sort-down" width="12" height="12" viewBox="0 0 24 24" fill="none" style="transform: rotate(180deg);"><path d="M6 15L12 9L18 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span></div>
        </div>
    </div>
</div>

{% for application in applicationsList %}
{% set job = application.job %}
  <div class="d-flex align-items-center job-lists">
    <div class="job-row d-flex align-items-center flex-grow-1" style="gap: 0; min-width: 0; width: 100%;">
      <div class="col-check" style="width: 30px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center;">
          <input type="checkbox" class="job-check job-checkbox" data-job-id="{{ application.id }}" data-application-id="{{ application.id }}" data-status="{{ application.status }}" />
      </div>
      <div class="col-job d-flex align-items-center gap-2" style="width: 200px; flex-shrink: 0; padding: 0 4px; box-sizing: border-box; min-width: 0; overflow: hidden;">
          <img src="{{ job.companyLogo|default(asset('assets/icons/job.png')) }}"
              alt="Logo"
              style="width: 40px; height: 40px; border-radius: 8px;" />
          <div style="min-width: 0; overflow: hidden;">
              <a class="job-title truncate-text d-block fw-semibold text-decoration-none"
                href="{{ path('app_provider_jobs_application_detail', {'id': application.id}) }}"
                style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px;">
                {{ job.title }}
              </a>
          </div>
      </div>
      <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.state }}</div>
      <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; font-size: 13px;">{{ job.formattedHourlyRate }}</div>
      {% if status not in ['interview', 'hired', 'completed'] or status == 'archived' %}
      <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ application.createdAt|date('m/d/Y') }}</div>
          {% endif %}
      {% if status not in ['interview', 'hired', 'completed'] or status == 'archived' %}
      <div class="col-start col-center col-rank" style="width: 100px; min-width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; overflow: visible; position: relative;">
          {% if application.rank is not null %}
          <span class="rank-display" data-application-id="{{ application.id }}">
              {{ application.rank|number_format(1, '.', '') }}/10
          </span>
            <div class="rank-input-wrapper hidden">
              <input type="number"
                    class="rank-input"
                    value="{{ application.rank }}"
                    min="1"
                    max="10"
                    step="0.5"
                    data-application-id="{{ application.id }}"
                    data-original-value="{{ application.rank }}"
                    oninput="if(this.value>10) this.value=10; if(this.value<1)this.value=1;" />
              <button type="button" class="rank-save-btn" data-application-id="{{ application.id }}" title="Save">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          {% else %}
            <span class="rank-display" data-application-id="{{ application.id }}">—</span>
            <div class="rank-input-wrapper hidden">
          <input type="number"
                    class="rank-input"
                    value=""
                min="1"
                max="10"
                step="0.5"
                data-application-id="{{ application.id }}"
                    data-original-value=""
                oninput="if(this.value>10) this.value=10; if(this.value<1)this.value=1;" />
              <button type="button" class="rank-save-btn" data-application-id="{{ application.id }}" title="Save">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          {% endif %}
      </div>
          {% endif %}
      {% if status not in ['applied', 'hired', 'completed'] or status == 'archived' %}
      <div class="col-start col-center" style="width: 80px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
          {% if application.status == 'interview' %}
          <span class="badge badge-pill">
          To Do Actions
          </span>
              {% else %}
          —
              {% endif %}
      </div>
      <div class="col-start col-center" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
          {% if application.status == 'interview' %}
          06/14/2025
              {% else %}
          —
              {% endif %}
      </div>
            {% endif %}
      <div class="col-start col-center" style="width: 140px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
          <span class="badge badge-pill" style="background-color: {% if application.status == 'applied' %}#E3F2FD{% elseif application.status == 'interview' %}#FFF3E0{% elseif application.status == 'negotiating' %}#F3E5F5{% elseif application.status == 'accepted' %}#E8F5E9{% elseif application.status == 'completed' %}#F1F8E9{% else %}#FFEBEE{% endif %}; color: {% if application.status == 'applied' %}#1976D2{% elseif application.status == 'interview' %}#F57C00{% elseif application.status == 'negotiating' %}#7B1FA2{% elseif application.status == 'accepted' %}#388E3C{% elseif application.status == 'completed' %}#689F38{% else %}#C62828{% endif %};">
              {{ application.status|replace({'_': ' '})|title }}
          </span>
      </div>
    </div>
  </div>
        {% endfor %}
</div>
  </div>
{% else %}
<p class="mb-0">No applications found.</p>
{% endif %}
