{% if bookmarks is not empty %}
  {% for bookmark in bookmarks %}
    {% set job = bookmark.job %}
    <div class="d-flex align-items-center job-lists">
      <div class="job-row d-flex align-items-center flex-grow-1" style="width: 100%; min-width: 0; gap: 0;">
        <div class="col-check" style="width: 30px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center;">
          <input type="checkbox" class="job-check job-checkbox" data-job-id="{{ job.id }}" />
        </div>
        <div class="col-job d-flex align-items-center gap-2" style="width: 200px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box;">
          <img src="{{ job.companyLogo|default(asset('assets/icons/job.png')) }}"
            alt="Logo"
            style="width: 40px; height: 40px; border-radius: 8px; flex-shrink: 0;" />
          <div style="min-width: 0; overflow: hidden;">
            <a class="job-title truncate-text d-block fw-semibold text-decoration-none"
              href="{{ path('app_provider_jobs_detail', {'id': job.id}) }}"
              style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px;">
              {{ job.title }}
            </a>
          </div>
        </div>
        <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.state }}</div>
        <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.startDate ? job.startDate|date('m/d/Y') : '—' }}</div>
        <div class="col-expiry col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">{{ job.expirationDate ? job.expirationDate|date('m/d/Y') : '—' }}</div>
        <div class="col-start col-center" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; font-size: 13px;">{{ job.formattedHourlyRate }}</div>
        <div class="col-start col-center" style="width: 120px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; font-size: 13px; color: #121C0C;">
          {% if job.workType == 'locums' %}
              Locums
          {% elseif job.workType == 'parttime' or job.workType == 'part-time' %}
              Parttime
          {% elseif job.workType == 'fulltime' or job.workType == 'full-time' %}
              Full time
          {% else %}
              {{ job.workType|default('—')|replace({'_': ' '})|title }}
          {% endif %}
        </div>
        <div class="col-start col-center col-rank" style="width: 100px; min-width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; overflow: visible; position: relative;">
          <span class="rank-display" data-job-id="{{ job.id }}" style="font-size: 13px;">
            {{ bookmark.rank is not null ? bookmark.rank ~ '/10' : '—' }}
          </span>
          <div class="rank-input-wrapper hidden">
          <input
            type="number"
              class="rank-input"
            value="{{ bookmark.rank is not null ? bookmark.rank : '' }}"
            min="1"
            max="10"
            step="0.5"
            data-job-id="{{ job.id }}"
            data-original-value="{{ bookmark.rank is not null ? bookmark.rank : '' }}"
            oninput="if (this.value > 10) this.value = 10; if (this.value < 1) this.value = 1;"
          />
            <button type="button" class="rank-save-btn" data-job-id="{{ job.id }}" title="Save">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="col-action" style="width: 100px; flex-shrink: 0; padding: 0 8px; box-sizing: border-box; display: flex; align-items: center; justify-content: center;">
          <button type="button" class="btn btn-sm btn-outline-danger unsave-btn" data-bookmark-id="{{ bookmark.id }}" style="padding: 4px 12px; font-size: 12px; border: 1px solid #dc3545; color: #dc3545; background: transparent; border-radius: 4px; cursor: pointer;">
            Unsave
          </button>
        </div>
      </div>
    </div>
  {% endfor %}
{% else %}
  <p class="mb-0">Saved jobs not found.</p>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', () => {
  const unsaveButtons = document.querySelectorAll('.unsave-btn');
  
  unsaveButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      const bookmarkId = this.dataset.bookmarkId;
      if (!confirm('Remove this job from saved list?')) return;
      
      fetch(`/provider/jobs/unsave/${bookmarkId}`, {
        method: 'DELETE',
        headers: { 
          'X-Requested-With': 'XMLHttpRequest',
          'Content-Type': 'application/json'
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          this.closest('.job-lists').remove();
        } else {
          showErrorAlert('Remove Failed', 'Failed to remove job.');
        }
      })
      .catch(err => {
        console.error(err);
        showErrorAlert('Error', 'Error removing job.');
      });
    });
  });
});
</script>
